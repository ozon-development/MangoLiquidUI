-- MangoLiquidUI — Loadstring Bundle
-- Generated by build.sh — do not edit manually
-- Usage: local MangoUI = loadstring(game:HttpGet("raw_github_url"))()

local _modules = {}
local _loaded = {}
local function _require(name)
    if _loaded[name] then return _loaded[name] end
    if not _modules[name] then error("Module not found: " .. name) end
    _loaded[name] = _modules[name]()
    return _loaded[name]
end

_modules["Types"] = function()


export type ThemePreset = {
	-- Glass surface
	BackgroundColor3: Color3,
	BackgroundTransparency: number,

	-- Lens (saturation tint via CanvasGroup)
	LensGroupColor3: Color3,
	LensGroupTransparency: number,

	-- Inner glow
	InnerGlowColor: Color3,
	InnerGlowTransparency: number,
	InnerGlowHeight: number, -- 0-1 fraction of parent height

	-- Inner edge highlight (full-perimeter inner shadow)
	InnerEdgeColor: Color3?,
	InnerEdgeTopTransparency: number?,
	InnerEdgeMidTransparency: number?,
	InnerEdgeBottomTransparency: number?,

	-- Fresnel rim (directional UIStroke)
	StrokeColor: Color3,
	StrokeThickness: number,
	FresnelStartTransparency: number, -- top edge
	FresnelEndTransparency: number, -- bottom edge
	FresnelMidTransparency: number, -- center keypoint transparency (brighter = lower)
	FresnelMidPoint: number, -- position of center keypoint (0-1, default 0.35)
	FresnelAngle: number, -- rotation in degrees (90 = top-lit)

	-- Shadow
	ShadowColor: Color3,
	ShadowTransparency: number, -- controls overall shadow intensity (higher = more subtle)
	ShadowSpread: number, -- px spread for outermost layer
	ShadowOffsetX: number, -- px horizontal offset
	ShadowOffsetY: number, -- px vertical offset

	-- Refraction proxy
	GlassColor: Color3,
	GlassTransparency: number,
	GlassReflectance: number,

	-- Noise
	NoiseOpacity: number,

	-- Text
	PrimaryTextColor: Color3,
	SecondaryTextColor: Color3,

	-- Toggle
	ToggleOnTrackColor: Color3?,
	ToggleOffTrackColor: Color3?,
	ToggleKnobColor: Color3?,

	-- Slider
	SliderTrackColor: Color3?,
	SliderFillColor: Color3?,
	SliderThumbColor: Color3?,

	-- Slider (glass track)
	SliderTrackTransparency: number?,
	SliderFillTransparency: number?,

	-- Button
	ButtonPressScale: number?,
	ButtonBackgroundTransparency: number?,

	-- Parallax
	ParallaxIntensity: number?,

	-- Notification stacking
	NotificationStackGap: number?,
	NotificationMaxVisible: number?,

	-- Segmented control
	SegmentedBackgroundTransparency: number?,
	SegmentedSelectedTransparency: number?,
	SegmentedSelectedColor: Color3?,

	-- Dropdown
	DropdownBackgroundTransparency: number?,
	DropdownItemHoverColor: Color3?,
	DropdownItemHoverTransparency: number?,

	-- Tab bar
	TabBarBackgroundTransparency: number?,
	TabBarSelectedColor: Color3?,
	TabBarIconColor: Color3?,
	TabBarIconSelectedColor: Color3?,

	-- Search bar
	SearchBarBackgroundTransparency: number?,
	SearchBarPlaceholderColor: Color3?,

	-- Text field
	TextFieldBackgroundTransparency: number?,
	TextFieldBorderColor: Color3?,
	TextFieldFocusBorderColor: Color3?,

	-- Checkbox
	CheckboxOnColor: Color3?,
	CheckboxOffColor: Color3?,
	CheckboxCheckColor: Color3?,

	-- Progress bar
	ProgressBarTrackTransparency: number?,
	ProgressBarFillColor: Color3?,
	ProgressBarFillTransparency: number?,

	-- Dialog
	DialogOverlayTransparency: number?,
	DialogBackgroundTransparency: number?,
}

export type MangoGlassConfig = {
	Size: UDim2,
	Position: UDim2,
	AnchorPoint: Vector2?,
	CornerRadius: UDim?,
	BackgroundColor3: Color3?,
	BackgroundTransparency: number?,
	NoiseOpacity: number?,
	NoiseImageId: string?,
	FresnelStartTransparency: number?,
	FresnelEndTransparency: number?,
	FresnelMidTransparency: number?,
	FresnelMidPoint: number?,
	FresnelAngle: number?,
	StrokeThickness: number?,
	StrokeColor: Color3?,
	InnerGlowTransparency: number?,
	InnerGlowColor: Color3?,
	InnerGlowHeight: number?,
	InnerEdgeColor: Color3?,
	InnerEdgeTopTransparency: number?,
	InnerEdgeMidTransparency: number?,
	InnerEdgeBottomTransparency: number?,
	LensGroupColor3: Color3?,
	LensGroupTransparency: number?,
	ShadowColor: Color3?,
	ShadowTransparency: number?,
	ShadowSpread: number?,
	ShadowOffsetX: number?,
	ShadowOffsetY: number?,
	ShadowEnabled: boolean?,
	ShadowLayerCount: number?, -- Number of shadow layers (default 6, max 12)
	LightweightMode: boolean?, -- Skip CanvasGroups for small elements like buttons
	ParallaxEnabled: boolean?,
	ParallaxIntensity: number?,
	Theme: ThemePreset?,
	Parent: GuiObject?,
}

export type RefractionProxyConfig = {
	TargetGui: GuiObject,
	GlassTransparency: number?,
	GlassMaterial: Enum.Material?,
	GlassColor: Color3?,
	GlassReflectance: number?,
	GlassThickness: number?,
	OffsetDepth: number?,
	Enabled: boolean?,
	ViewportMode: boolean?,
	Theme: ThemePreset?,
}

export type LiquidFusionConfig = {
	Target: GuiObject,
	BulgeScale: number?,
	BulgeDuration: number?,
	RestoreDuration: number?,
	SpecularShiftOffset: UDim2?,
	UseUIScale: boolean?,
}

export type MangoToggleConfig = {
	Position: UDim2,
	AnchorPoint: Vector2?,
	Scale: number?,
	Theme: ThemePreset?,
	InitialState: boolean?,
	OnToggled: ((state: boolean) -> ())?,
	Parent: GuiObject?,
}

export type MangoSliderConfig = {
	Position: UDim2,
	Size: UDim2?,
	AnchorPoint: Vector2?,
	Theme: ThemePreset?,
	InitialValue: number?,
	Min: number?,
	Max: number?,
	Step: number?,
	OnChanged: ((value: number) -> ())?,
	Parent: GuiObject?,
}

export type MangoButtonConfig = {
	Position: UDim2,
	Size: UDim2?,
	AnchorPoint: Vector2?,
	Text: string,
	TextSize: number?,
	BackgroundTransparency: number?,
	Theme: ThemePreset?,
	OnActivated: (() -> ())?,
	Parent: GuiObject?,
}

export type MangoBillboardLabelConfig = {
	TargetPart: BasePart?,
	TargetCharacter: Model?,
	Text: string,
	TextSize: number?,
	Theme: ThemePreset?,
	MaxDistance: number?,
	StudsOffset: Vector3?,
	AlwaysOnTop: boolean?,
	Parent: Instance?,
}

export type MangoGlassFrame = {
	Container: Frame,
	Frame: Frame, -- alias for Container (backward compat)
	GlassSurface: Frame,
	ShadowLayers: {Frame},
	LensGroup: CanvasGroup?, -- nil in LightweightMode
	TextureGroup: CanvasGroup?, -- nil in LightweightMode
	NoiseLabel: ImageLabel?, -- nil in LightweightMode
	InnerHighlight: Frame?, -- nil in LightweightMode
	InnerEdgeFrame: Frame,
	InnerEdgeStroke: UIStroke,
	InnerEdgeGradient: UIGradient,
	SpecularFrame: Frame,
	SpecularStroke: UIStroke,
	SpecularGradient: UIGradient,
	SetLightDirection: (self: MangoGlassFrame, angle: number) -> (),
	SetParallaxEnabled: (self: MangoGlassFrame, enabled: boolean) -> (),
	Destroy: (self: MangoGlassFrame) -> (),
}

export type RefractionProxy = {
	GlassPart: Part,
	Enabled: boolean,
	SetEnabled: (self: RefractionProxy, enabled: boolean) -> (),
	UpdateTarget: (self: RefractionProxy, newGui: GuiObject) -> (),
	Destroy: (self: RefractionProxy) -> (),
}

export type LiquidFusionController = {
	Connect: (self: LiquidFusionController) -> (),
	Disconnect: (self: LiquidFusionController) -> (),
	TweenProperty: (self: LiquidFusionController, property: string, target: any, duration: number?) -> Tween,
	Destroy: (self: LiquidFusionController) -> (),
}

export type MangoToggle = {
	Container: Frame,
	SetState: (self: MangoToggle, state: boolean) -> (),
	GetState: (self: MangoToggle) -> boolean,
	Destroy: (self: MangoToggle) -> (),
}

export type MangoSlider = {
	Container: Frame,
	SetValue: (self: MangoSlider, value: number) -> (),
	GetValue: (self: MangoSlider) -> number,
	Destroy: (self: MangoSlider) -> (),
}

export type MangoButton = {
	Container: Frame,
	GlassSurface: Frame,
	TextLabel: TextLabel,
	SetText: (self: MangoButton, text: string) -> (),
	Destroy: (self: MangoButton) -> (),
}

export type MangoBillboardLabel = {
	BillboardGui: BillboardGui,
	GlassSurface: Frame,
	TextLabel: TextLabel,
	SetText: (self: MangoBillboardLabel, text: string) -> (),
	Destroy: (self: MangoBillboardLabel) -> (),
}

export type MangoNotificationConfig = {
	Title: string,
	Body: string?,
	Icon: string?,
	Duration: number?,
	Theme: ThemePreset?,
	OnDismissed: (() -> ())?,
	Parent: Instance?,
}

export type MangoNotification = {
	Container: Frame,
	Show: (self: MangoNotification) -> (),
	Dismiss: (self: MangoNotification) -> (),
	SetPosition: (self: MangoNotification, position: UDim2) -> (),
	GetHeight: (self: MangoNotification) -> number,
	Destroy: (self: MangoNotification) -> (),
}

export type MangoEnvironmentLightConfig = {
	UpdateAngleEveryFrame: boolean?, -- default true
	TintUpdateInterval: number?, -- seconds, default 0.5
	TintInfluence: number?, -- 0-1, default 0.22
	Enabled: boolean?, -- default true
}

export type MangoEnvironmentLight = {
	Enable: (self: MangoEnvironmentLight) -> (),
	Disable: (self: MangoEnvironmentLight) -> (),
	IsEnabled: (self: MangoEnvironmentLight) -> boolean,
	GetSunAngle: (self: MangoEnvironmentLight) -> number,
	GetEnvironmentTint: (self: MangoEnvironmentLight) -> Color3,
	RegisterGlassFrame: (self: MangoEnvironmentLight, frame: MangoGlassFrame) -> (),
	UnregisterGlassFrame: (self: MangoEnvironmentLight, frame: MangoGlassFrame) -> (),
	Destroy: (self: MangoEnvironmentLight) -> (),
}

-- Notification Stack
export type MangoNotificationStackConfig = {
	MaxVisible: number?,
	StackGap: number?,
	Theme: ThemePreset?,
	Parent: Instance?,
}

export type MangoNotificationStack = {
	Push: (self: MangoNotificationStack, config: MangoNotificationConfig) -> MangoNotification,
	DismissAll: (self: MangoNotificationStack) -> (),
	GetCount: (self: MangoNotificationStack) -> number,
	Destroy: (self: MangoNotificationStack) -> (),
}

-- Segmented Control
export type MangoSegmentedControlConfig = {
	Position: UDim2,
	AnchorPoint: Vector2?,
	Segments: {string},
	InitialIndex: number?,
	SegmentWidth: number?,
	Height: number?,
	Theme: ThemePreset?,
	OnChanged: ((index: number) -> ())?,
	Parent: GuiObject?,
}

export type MangoSegmentedControl = {
	Container: Frame,
	SetIndex: (self: MangoSegmentedControl, index: number) -> (),
	GetIndex: (self: MangoSegmentedControl) -> number,
	Destroy: (self: MangoSegmentedControl) -> (),
}

-- Dropdown
export type MangoDropdownConfig = {
	Position: UDim2,
	Size: UDim2?,
	AnchorPoint: Vector2?,
	Items: {string},
	InitialIndex: number?,
	Theme: ThemePreset?,
	OnChanged: ((index: number) -> ())?,
	Parent: GuiObject?,
}

export type MangoDropdown = {
	Container: Frame,
	SetSelectedIndex: (self: MangoDropdown, index: number) -> (),
	GetSelectedIndex: (self: MangoDropdown) -> number,
	SetItems: (self: MangoDropdown, items: {string}) -> (),
	Open: (self: MangoDropdown) -> (),
	Close: (self: MangoDropdown) -> (),
	Destroy: (self: MangoDropdown) -> (),
}

-- Tab Bar
export type MangoTabBarConfig = {
	Tabs: {{Icon: string?, Label: string}},
	InitialIndex: number?,
	Theme: ThemePreset?,
	OnChanged: ((index: number) -> ())?,
	Parent: GuiObject?,
}

export type MangoTabBar = {
	Container: Frame,
	SetIndex: (self: MangoTabBar, index: number) -> (),
	GetIndex: (self: MangoTabBar) -> number,
	Destroy: (self: MangoTabBar) -> (),
}

-- Search Bar
export type MangoSearchBarConfig = {
	Position: UDim2,
	Size: UDim2?,
	AnchorPoint: Vector2?,
	Placeholder: string?,
	Theme: ThemePreset?,
	OnTextChanged: ((text: string) -> ())?,
	OnSubmit: ((text: string) -> ())?,
	Parent: GuiObject?,
}

export type MangoSearchBar = {
	Container: Frame,
	GetText: (self: MangoSearchBar) -> string,
	SetText: (self: MangoSearchBar, text: string) -> (),
	Focus: (self: MangoSearchBar) -> (),
	Destroy: (self: MangoSearchBar) -> (),
}

-- Text Field
export type MangoTextFieldConfig = {
	Position: UDim2,
	Size: UDim2?,
	AnchorPoint: Vector2?,
	Placeholder: string?,
	InitialText: string?,
	Theme: ThemePreset?,
	OnTextChanged: ((text: string) -> ())?,
	OnFocusLost: ((text: string, enterPressed: boolean) -> ())?,
	Parent: GuiObject?,
}

export type MangoTextField = {
	Container: Frame,
	GetText: (self: MangoTextField) -> string,
	SetText: (self: MangoTextField, text: string) -> (),
	Focus: (self: MangoTextField) -> (),
	Destroy: (self: MangoTextField) -> (),
}

-- Checkbox
export type MangoCheckboxConfig = {
	Position: UDim2,
	AnchorPoint: Vector2?,
	Label: string?,
	InitialState: boolean?,
	Theme: ThemePreset?,
	OnToggled: ((state: boolean) -> ())?,
	Parent: GuiObject?,
}

export type MangoCheckbox = {
	Container: Frame,
	SetState: (self: MangoCheckbox, state: boolean) -> (),
	GetState: (self: MangoCheckbox) -> boolean,
	Destroy: (self: MangoCheckbox) -> (),
}

-- Progress Bar
export type MangoProgressBarConfig = {
	Position: UDim2,
	Size: UDim2?,
	AnchorPoint: Vector2?,
	InitialValue: number?,
	Theme: ThemePreset?,
	Parent: GuiObject?,
}

export type MangoProgressBar = {
	Container: Frame,
	SetValue: (self: MangoProgressBar, value: number) -> (),
	GetValue: (self: MangoProgressBar) -> number,
	Destroy: (self: MangoProgressBar) -> (),
}

-- Dialog
export type MangoDialogButtonConfig = {
	Text: string,
	Style: string?, -- "default" | "cancel" | "destructive"
	OnActivated: (() -> ())?,
}

export type MangoDialogConfig = {
	Title: string,
	Message: string?,
	Buttons: {MangoDialogButtonConfig}?,
	Theme: ThemePreset?,
	OnDismissed: (() -> ())?,
	Parent: Instance?,
}

export type MangoDialog = {
	Show: (self: MangoDialog) -> (),
	Dismiss: (self: MangoDialog) -> (),
	Destroy: (self: MangoDialog) -> (),
}

-- Action Sheet
export type MangoActionSheetActionConfig = {
	Text: string,
	Style: string?, -- "default" | "destructive"
	OnActivated: (() -> ())?,
}

export type MangoActionSheetConfig = {
	Title: string?,
	Message: string?,
	Actions: {MangoActionSheetActionConfig},
	CancelText: string?,
	Theme: ThemePreset?,
	OnDismissed: (() -> ())?,
	Parent: Instance?,
}

export type MangoActionSheet = {
	Show: (self: MangoActionSheet) -> (),
	Dismiss: (self: MangoActionSheet) -> (),
	Destroy: (self: MangoActionSheet) -> (),
}

return nil

end

_modules["Themes"] = function()


local Types = _require("Types")

local module = {}

--[[
	Resolves a config value with theme fallback and default.
	Needed because Luau's `or` operator treats `0` and `false` as falsy,
	so `config.X or theme.X or default` would skip valid zero/false values.
]]
function module.resolve(configVal: any?, themeVal: any?, default: any): any
	if configVal ~= nil then
		return configVal
	end
	if themeVal ~= nil then
		return themeVal
	end
	return default
end

module.Light = {
	-- Glass surface (Apple-level subtle transparency)
	BackgroundColor3 = Color3.fromRGB(255, 255, 255),
	BackgroundTransparency = 0.85,

	-- Lens (saturation tint via CanvasGroup — lighter for subtlety)
	LensGroupColor3 = Color3.fromRGB(252, 252, 255),
	LensGroupTransparency = 0.62,

	-- Inner glow (thin highlight strip — Apple's 1px inset at 80%)
	InnerGlowColor = Color3.fromRGB(255, 255, 255),
	InnerGlowTransparency = 0.82,
	InnerGlowHeight = 0.12,

	-- Inner edge highlight (barely perceptible boundary)
	InnerEdgeColor = Color3.fromRGB(255, 255, 255),
	InnerEdgeTopTransparency = 0.45,
	InnerEdgeMidTransparency = 0.78,
	InnerEdgeBottomTransparency = 0.94,

	-- Fresnel rim (directional UIStroke) — paper-thin specular
	StrokeColor = Color3.fromRGB(255, 255, 255),
	StrokeThickness = 1.5,
	FresnelStartTransparency = 0.35,
	FresnelEndTransparency = 0.95,
	FresnelMidTransparency = 0.65,
	FresnelMidPoint = 0.40,
	FresnelAngle = 90,

	-- Shadow (Apple-spec: 8px offset, 24px spread)
	ShadowColor = Color3.fromRGB(0, 0, 0),
	ShadowTransparency = 0.80,
	ShadowSpread = 20,
	ShadowOffsetX = 0,
	ShadowOffsetY = 5,

	-- Refraction proxy (per-panel glass distortion — visible refraction, slightly inset)
	GlassColor = Color3.fromRGB(235, 240, 250),
	GlassTransparency = 0.88,
	GlassReflectance = 0.08,

	-- Noise
	NoiseOpacity = 0.03,

	-- Text
	PrimaryTextColor = Color3.fromRGB(0, 0, 0),
	SecondaryTextColor = Color3.fromRGB(60, 60, 70),

	-- Toggle
	ToggleOnTrackColor = Color3.fromRGB(52, 199, 89),
	ToggleOffTrackColor = Color3.fromRGB(200, 200, 200),
	ToggleKnobColor = Color3.fromRGB(255, 255, 255),

	-- Slider
	SliderTrackColor = Color3.fromRGB(210, 212, 218),
	SliderFillColor = Color3.fromRGB(0, 122, 255),
	SliderThumbColor = Color3.fromRGB(255, 255, 255),
	SliderTrackTransparency = 0.40,
	SliderFillTransparency = 0.40,

	-- Button (matches panel subtlety)
	ButtonPressScale = 0.97,
	ButtonBackgroundTransparency = 0.78,

	-- Parallax
	ParallaxIntensity = 0.15,

	-- Notification stacking
	NotificationStackGap = 14,
	NotificationMaxVisible = 3,

	-- Segmented control
	SegmentedBackgroundTransparency = 0.88,
	SegmentedSelectedTransparency = 0.72,
	SegmentedSelectedColor = Color3.fromRGB(255, 255, 255),

	-- Dropdown
	DropdownBackgroundTransparency = 0.82,
	DropdownItemHoverColor = Color3.fromRGB(0, 122, 255),
	DropdownItemHoverTransparency = 0.85,

	-- Tab bar
	TabBarBackgroundTransparency = 0.82,
	TabBarSelectedColor = Color3.fromRGB(0, 122, 255),
	TabBarIconColor = Color3.fromRGB(140, 140, 150),
	TabBarIconSelectedColor = Color3.fromRGB(0, 122, 255),

	-- Search bar
	SearchBarBackgroundTransparency = 0.88,
	SearchBarPlaceholderColor = Color3.fromRGB(142, 142, 147),

	-- Text field
	TextFieldBackgroundTransparency = 0.92,
	TextFieldBorderColor = Color3.fromRGB(200, 200, 205),
	TextFieldFocusBorderColor = Color3.fromRGB(0, 122, 255),

	-- Checkbox
	CheckboxOnColor = Color3.fromRGB(0, 122, 255),
	CheckboxOffColor = Color3.fromRGB(200, 200, 205),
	CheckboxCheckColor = Color3.fromRGB(255, 255, 255),

	-- Progress bar
	ProgressBarTrackTransparency = 0.85,
	ProgressBarFillColor = Color3.fromRGB(0, 122, 255),
	ProgressBarFillTransparency = 0.30,

	-- Dialog
	DialogOverlayTransparency = 0.40,
	DialogBackgroundTransparency = 0.78,
} :: Types.ThemePreset

module.Mango = {
	-- Glass surface (warm amber-tinted glass, Apple-level subtle)
	BackgroundColor3 = Color3.fromRGB(255, 235, 200),
	BackgroundTransparency = 0.84,

	-- Lens (warm saturation tint — lighter)
	LensGroupColor3 = Color3.fromRGB(255, 240, 210),
	LensGroupTransparency = 0.60,

	-- Inner glow (thin highlight strip — Apple's 1px inset at 80%)
	InnerGlowColor = Color3.fromRGB(255, 245, 220),
	InnerGlowTransparency = 0.82,
	InnerGlowHeight = 0.12,

	-- Inner edge highlight (barely perceptible)
	InnerEdgeColor = Color3.fromRGB(255, 250, 235),
	InnerEdgeTopTransparency = 0.42,
	InnerEdgeMidTransparency = 0.76,
	InnerEdgeBottomTransparency = 0.94,

	-- Fresnel rim — paper-thin
	StrokeColor = Color3.fromRGB(255, 245, 220),
	StrokeThickness = 1.5,
	FresnelStartTransparency = 0.32,
	FresnelEndTransparency = 0.94,
	FresnelMidTransparency = 0.62,
	FresnelMidPoint = 0.40,
	FresnelAngle = 90,

	-- Shadow (Apple-spec: deeper, wider)
	ShadowColor = Color3.fromRGB(80, 50, 20),
	ShadowTransparency = 0.80,
	ShadowSpread = 20,
	ShadowOffsetX = 0,
	ShadowOffsetY = 5,

	-- Refraction proxy (per-panel glass distortion — visible refraction, slightly inset)
	GlassColor = Color3.fromRGB(250, 240, 220),
	GlassTransparency = 0.875,
	GlassReflectance = 0.085,

	-- Noise
	NoiseOpacity = 0.03,

	-- Text
	PrimaryTextColor = Color3.fromRGB(60, 35, 10),
	SecondaryTextColor = Color3.fromRGB(120, 80, 40),

	-- Toggle
	ToggleOnTrackColor = Color3.fromRGB(255, 149, 0),
	ToggleOffTrackColor = Color3.fromRGB(210, 195, 175),
	ToggleKnobColor = Color3.fromRGB(255, 255, 255),

	-- Slider
	SliderTrackColor = Color3.fromRGB(230, 210, 185),
	SliderFillColor = Color3.fromRGB(255, 149, 0),
	SliderThumbColor = Color3.fromRGB(255, 255, 255),
	SliderTrackTransparency = 0.45,
	SliderFillTransparency = 0.38,

	-- Button
	ButtonPressScale = 0.97,
	ButtonBackgroundTransparency = 0.76,

	-- Parallax
	ParallaxIntensity = 0.15,

	-- Notification stacking
	NotificationStackGap = 14,
	NotificationMaxVisible = 3,

	-- Segmented control (orange accent)
	SegmentedBackgroundTransparency = 0.87,
	SegmentedSelectedTransparency = 0.70,
	SegmentedSelectedColor = Color3.fromRGB(255, 245, 220),

	-- Dropdown
	DropdownBackgroundTransparency = 0.80,
	DropdownItemHoverColor = Color3.fromRGB(255, 149, 0),
	DropdownItemHoverTransparency = 0.84,

	-- Tab bar
	TabBarBackgroundTransparency = 0.80,
	TabBarSelectedColor = Color3.fromRGB(255, 149, 0),
	TabBarIconColor = Color3.fromRGB(160, 130, 90),
	TabBarIconSelectedColor = Color3.fromRGB(255, 149, 0),

	-- Search bar
	SearchBarBackgroundTransparency = 0.87,
	SearchBarPlaceholderColor = Color3.fromRGB(160, 130, 90),

	-- Text field
	TextFieldBackgroundTransparency = 0.90,
	TextFieldBorderColor = Color3.fromRGB(210, 190, 165),
	TextFieldFocusBorderColor = Color3.fromRGB(255, 149, 0),

	-- Checkbox (orange accent)
	CheckboxOnColor = Color3.fromRGB(255, 149, 0),
	CheckboxOffColor = Color3.fromRGB(210, 195, 175),
	CheckboxCheckColor = Color3.fromRGB(255, 255, 255),

	-- Progress bar
	ProgressBarTrackTransparency = 0.84,
	ProgressBarFillColor = Color3.fromRGB(255, 149, 0),
	ProgressBarFillTransparency = 0.28,

	-- Dialog
	DialogOverlayTransparency = 0.42,
	DialogBackgroundTransparency = 0.76,
} :: Types.ThemePreset

module.Dark = {
	-- Glass surface (rich dark glass — Apple-level subtle)
	BackgroundColor3 = Color3.fromRGB(28, 30, 38),
	BackgroundTransparency = 0.82,

	-- Lens (saturation tint via CanvasGroup — lighter)
	LensGroupColor3 = Color3.fromRGB(190, 200, 220),
	LensGroupTransparency = 0.64,

	-- Inner glow (thin highlight strip — Apple's 1px inset at 80%)
	InnerGlowColor = Color3.fromRGB(255, 255, 255),
	InnerGlowTransparency = 0.82,
	InnerGlowHeight = 0.12,

	-- Inner edge highlight (barely perceptible)
	InnerEdgeColor = Color3.fromRGB(255, 255, 255),
	InnerEdgeTopTransparency = 0.40,
	InnerEdgeMidTransparency = 0.74,
	InnerEdgeBottomTransparency = 0.93,

	-- Fresnel rim (directional UIStroke) — paper-thin specular
	StrokeColor = Color3.fromRGB(255, 255, 255),
	StrokeThickness = 1.5,
	FresnelStartTransparency = 0.30,
	FresnelEndTransparency = 0.93,
	FresnelMidTransparency = 0.58,
	FresnelMidPoint = 0.40,
	FresnelAngle = 90,

	-- Shadow (Apple-spec: deeper, wider)
	ShadowColor = Color3.fromRGB(0, 0, 0),
	ShadowTransparency = 0.75,
	ShadowSpread = 22,
	ShadowOffsetX = 0,
	ShadowOffsetY = 5,

	-- Refraction proxy (per-panel glass distortion — visible refraction, slightly inset)
	GlassColor = Color3.fromRGB(50, 55, 70),
	GlassTransparency = 0.87,
	GlassReflectance = 0.09,

	-- Noise
	NoiseOpacity = 0.03,

	-- Text
	PrimaryTextColor = Color3.fromRGB(255, 255, 255),
	SecondaryTextColor = Color3.fromRGB(170, 170, 185),

	-- Toggle
	ToggleOnTrackColor = Color3.fromRGB(48, 209, 88),
	ToggleOffTrackColor = Color3.fromRGB(80, 80, 85),
	ToggleKnobColor = Color3.fromRGB(255, 255, 255),

	-- Slider
	SliderTrackColor = Color3.fromRGB(55, 55, 65),
	SliderFillColor = Color3.fromRGB(10, 132, 255),
	SliderThumbColor = Color3.fromRGB(255, 255, 255),
	SliderTrackTransparency = 0.38,
	SliderFillTransparency = 0.35,

	-- Button (matches panel subtlety)
	ButtonPressScale = 0.97,
	ButtonBackgroundTransparency = 0.75,

	-- Parallax
	ParallaxIntensity = 0.15,

	-- Notification stacking
	NotificationStackGap = 14,
	NotificationMaxVisible = 3,

	-- Segmented control (blue accent)
	SegmentedBackgroundTransparency = 0.85,
	SegmentedSelectedTransparency = 0.68,
	SegmentedSelectedColor = Color3.fromRGB(50, 55, 70),

	-- Dropdown
	DropdownBackgroundTransparency = 0.78,
	DropdownItemHoverColor = Color3.fromRGB(10, 132, 255),
	DropdownItemHoverTransparency = 0.82,

	-- Tab bar
	TabBarBackgroundTransparency = 0.78,
	TabBarSelectedColor = Color3.fromRGB(10, 132, 255),
	TabBarIconColor = Color3.fromRGB(120, 120, 135),
	TabBarIconSelectedColor = Color3.fromRGB(10, 132, 255),

	-- Search bar
	SearchBarBackgroundTransparency = 0.85,
	SearchBarPlaceholderColor = Color3.fromRGB(120, 120, 135),

	-- Text field
	TextFieldBackgroundTransparency = 0.88,
	TextFieldBorderColor = Color3.fromRGB(70, 70, 80),
	TextFieldFocusBorderColor = Color3.fromRGB(10, 132, 255),

	-- Checkbox (blue accent)
	CheckboxOnColor = Color3.fromRGB(10, 132, 255),
	CheckboxOffColor = Color3.fromRGB(80, 80, 85),
	CheckboxCheckColor = Color3.fromRGB(255, 255, 255),

	-- Progress bar
	ProgressBarTrackTransparency = 0.82,
	ProgressBarFillColor = Color3.fromRGB(10, 132, 255),
	ProgressBarFillTransparency = 0.25,

	-- Dialog
	DialogOverlayTransparency = 0.35,
	DialogBackgroundTransparency = 0.74,
} :: Types.ThemePreset

module.Mint = {
	-- Glass surface (cool mint-tinted glass)
	BackgroundColor3 = Color3.fromRGB(235, 252, 245),
	BackgroundTransparency = 0.86,

	-- Lens (mint saturation tint)
	LensGroupColor3 = Color3.fromRGB(220, 250, 240),
	LensGroupTransparency = 0.62,

	-- Inner glow (thin highlight strip — Apple's 1px inset at 80%)
	InnerGlowColor = Color3.fromRGB(240, 255, 248),
	InnerGlowTransparency = 0.82,
	InnerGlowHeight = 0.12,

	-- Inner edge highlight
	InnerEdgeColor = Color3.fromRGB(240, 255, 248),
	InnerEdgeTopTransparency = 0.44,
	InnerEdgeMidTransparency = 0.77,
	InnerEdgeBottomTransparency = 0.94,

	-- Fresnel rim
	StrokeColor = Color3.fromRGB(240, 255, 248),
	StrokeThickness = 1.5,
	FresnelStartTransparency = 0.34,
	FresnelEndTransparency = 0.95,
	FresnelMidTransparency = 0.64,
	FresnelMidPoint = 0.40,
	FresnelAngle = 90,

	-- Shadow (Apple-spec: deeper, wider)
	ShadowColor = Color3.fromRGB(20, 80, 60),
	ShadowTransparency = 0.82,
	ShadowSpread = 20,
	ShadowOffsetX = 0,
	ShadowOffsetY = 5,

	-- Refraction proxy
	GlassColor = Color3.fromRGB(230, 248, 240),
	GlassTransparency = 0.88,
	GlassReflectance = 0.08,

	-- Noise
	NoiseOpacity = 0.03,

	-- Text
	PrimaryTextColor = Color3.fromRGB(15, 55, 45),
	SecondaryTextColor = Color3.fromRGB(50, 100, 85),

	-- Toggle
	ToggleOnTrackColor = Color3.fromRGB(0, 199, 140),
	ToggleOffTrackColor = Color3.fromRGB(190, 210, 200),
	ToggleKnobColor = Color3.fromRGB(255, 255, 255),

	-- Slider
	SliderTrackColor = Color3.fromRGB(200, 225, 215),
	SliderFillColor = Color3.fromRGB(0, 199, 140),
	SliderThumbColor = Color3.fromRGB(255, 255, 255),
	SliderTrackTransparency = 0.42,
	SliderFillTransparency = 0.38,

	-- Button
	ButtonPressScale = 0.97,
	ButtonBackgroundTransparency = 0.78,

	-- Parallax
	ParallaxIntensity = 0.15,

	-- Notification stacking
	NotificationStackGap = 14,
	NotificationMaxVisible = 3,

	-- Segmented control (mint accent)
	SegmentedBackgroundTransparency = 0.88,
	SegmentedSelectedTransparency = 0.72,
	SegmentedSelectedColor = Color3.fromRGB(240, 255, 248),

	-- Dropdown
	DropdownBackgroundTransparency = 0.82,
	DropdownItemHoverColor = Color3.fromRGB(0, 199, 140),
	DropdownItemHoverTransparency = 0.85,

	-- Tab bar
	TabBarBackgroundTransparency = 0.82,
	TabBarSelectedColor = Color3.fromRGB(0, 199, 140),
	TabBarIconColor = Color3.fromRGB(100, 150, 130),
	TabBarIconSelectedColor = Color3.fromRGB(0, 199, 140),

	-- Search bar
	SearchBarBackgroundTransparency = 0.88,
	SearchBarPlaceholderColor = Color3.fromRGB(100, 150, 130),

	-- Text field
	TextFieldBackgroundTransparency = 0.92,
	TextFieldBorderColor = Color3.fromRGB(190, 215, 205),
	TextFieldFocusBorderColor = Color3.fromRGB(0, 199, 140),

	-- Checkbox (mint accent)
	CheckboxOnColor = Color3.fromRGB(0, 199, 140),
	CheckboxOffColor = Color3.fromRGB(190, 210, 200),
	CheckboxCheckColor = Color3.fromRGB(255, 255, 255),

	-- Progress bar
	ProgressBarTrackTransparency = 0.85,
	ProgressBarFillColor = Color3.fromRGB(0, 199, 140),
	ProgressBarFillTransparency = 0.30,

	-- Dialog
	DialogOverlayTransparency = 0.40,
	DialogBackgroundTransparency = 0.78,
} :: Types.ThemePreset

return module

end

_modules["LiquidFusion"] = function()


local TweenService = game:GetService("TweenService")

local Types = _require("Types")
local Themes = _require("Themes")
local resolve = Themes.resolve
local UserInputService = game:GetService("UserInputService")

local module = {}

local function makeSmoothTweenInfo(duration: number): TweenInfo
	return TweenInfo.new(
		duration,
		Enum.EasingStyle.Back,
		Enum.EasingDirection.Out,
		0,
		false,
		0
	)
end

function module.new(config: Types.LiquidFusionConfig): Types.LiquidFusionController
	local target: GuiObject = config.Target
	local bulgeScale: number = resolve(config.BulgeScale, nil, 1.025) :: number
	local bulgeDuration: number = resolve(config.BulgeDuration, nil, 0.25) :: number
	local restoreDuration: number = resolve(config.RestoreDuration, nil, 0.3) :: number
	local specularShiftOffset: UDim2 = resolve(config.SpecularShiftOffset, nil, UDim2.new(0.04, 0, 0.04, 0)) :: UDim2

	local useUIScale: boolean = if config.UseUIScale then true else false

	local connections: { RBXScriptConnection } = {}
	local activeTweens: { Tween } = {}
	local originalSize: UDim2? = nil
	local specularGradient: UIGradient? = nil
	local uiScaleInstance: UIScale? = nil
	local touchHitArea: TextButton? = nil

	local function cancelAllTweens()
		for _, tween in activeTweens do
			tween:Cancel()
		end
		table.clear(activeTweens)
	end

	local function trackTween(tween: Tween): Tween
		table.insert(activeTweens, tween)
		return tween
	end

	local controller = {} :: Types.LiquidFusionController

	function controller.TweenProperty(self: Types.LiquidFusionController, property: string, targetValue: any, duration: number?): Tween
		local tweenDuration: number = duration or bulgeDuration
		local tweenInfo = makeSmoothTweenInfo(tweenDuration)
		local tween = TweenService:Create(target, tweenInfo, { [property] = targetValue })
		trackTween(tween)
		tween:Play()
		return tween
	end

	function controller.Connect(self: Types.LiquidFusionController)
		-- Disconnect any existing connections first
		controller:Disconnect()

		-- Capture original size at connect time
		originalSize = target.Size

		-- Search for the SpecularStroke's UIGradient for specular rim animation
		-- (Must use named search to avoid picking up InnerHighlight's gradient)
		local specularStroke = target:FindFirstChild("SpecularStroke", true)
		if specularStroke then
			specularGradient = specularStroke:FindFirstChild("SpecularGradient") :: UIGradient?
		end

		-- UIScale mode: create UIScale child and tween Scale instead of Size
		if useUIScale then
			local scale = Instance.new("UIScale")
			scale.Scale = 1
			scale.Parent = target
			uiScaleInstance = scale

			local enterConnection = target.MouseEnter:Connect(function()
				cancelAllTweens()
				local tweenInfo = makeSmoothTweenInfo(bulgeDuration)
				local scaleTween = TweenService:Create(scale, tweenInfo, { Scale = bulgeScale })
				trackTween(scaleTween)
				scaleTween:Play()
				local gradient = specularGradient
				if gradient then
					local gradientTween = TweenService:Create(gradient, tweenInfo, {
						Offset = Vector2.new(specularShiftOffset.X.Scale, specularShiftOffset.Y.Scale),
					})
					trackTween(gradientTween)
					gradientTween:Play()
				end
			end)

			local leaveConnection = target.MouseLeave:Connect(function()
				cancelAllTweens()
				local tweenInfo = makeSmoothTweenInfo(restoreDuration)
				local scaleTween = TweenService:Create(scale, tweenInfo, { Scale = 1 })
				trackTween(scaleTween)
				scaleTween:Play()
				local gradient = specularGradient
				if gradient then
					local gradientTween = TweenService:Create(gradient, tweenInfo, {
						Offset = Vector2.new(0, 0),
					})
					trackTween(gradientTween)
					gradientTween:Play()
				end
			end)

			table.insert(connections, enterConnection)
			table.insert(connections, leaveConnection)

			if UserInputService.TouchEnabled then
				-- Create transparent TextButton for reliable touch input on transparent targets
				local hitBtn = Instance.new("TextButton")
				hitBtn.Name = "FusionTouchHitArea"
				hitBtn.Size = UDim2.new(1, 0, 1, 0)
				hitBtn.BackgroundTransparency = 1
				hitBtn.BorderSizePixel = 0
				hitBtn.Text = ""
				hitBtn.AutoButtonColor = false
				hitBtn.ZIndex = 99
				hitBtn.Parent = target
				touchHitArea = hitBtn

				local touchBeginConn = hitBtn.InputBegan:Connect(function(input: InputObject)
					if input.UserInputType == Enum.UserInputType.Touch then
						cancelAllTweens()
						local tweenInfo = makeSmoothTweenInfo(bulgeDuration)
						local scaleTween = TweenService:Create(scale, tweenInfo, { Scale = bulgeScale })
						trackTween(scaleTween)
						scaleTween:Play()
						local gradient = specularGradient
						if gradient then
							local gradTween = TweenService:Create(gradient, tweenInfo, {
								Offset = Vector2.new(specularShiftOffset.X.Scale, specularShiftOffset.Y.Scale),
							})
							trackTween(gradTween)
							gradTween:Play()
						end
					end
				end)
				local touchEndConn = hitBtn.InputEnded:Connect(function(input: InputObject)
					if input.UserInputType == Enum.UserInputType.Touch then
						cancelAllTweens()
						local tweenInfo = makeSmoothTweenInfo(restoreDuration)
						local scaleTween = TweenService:Create(scale, tweenInfo, { Scale = 1 })
						trackTween(scaleTween)
						scaleTween:Play()
						local gradient = specularGradient
						if gradient then
							local gradTween = TweenService:Create(gradient, tweenInfo, {
								Offset = Vector2.new(0, 0),
							})
							trackTween(gradTween)
							gradTween:Play()
						end
					end
				end)
				table.insert(connections, touchBeginConn)
				table.insert(connections, touchEndConn)
			end
		else
			-- Default Size-based mode
			local origSize: UDim2 = originalSize :: UDim2
			local bulgeSize = UDim2.new(
				origSize.X.Scale * bulgeScale,
				math.floor(origSize.X.Offset * bulgeScale),
				origSize.Y.Scale * bulgeScale,
				math.floor(origSize.Y.Offset * bulgeScale)
			)

			local enterConnection = target.MouseEnter:Connect(function()
				cancelAllTweens()
				local tweenInfo = makeSmoothTweenInfo(bulgeDuration)
				local sizeTween = TweenService:Create(target, tweenInfo, { Size = bulgeSize })
				trackTween(sizeTween)
				sizeTween:Play()
				local gradient = specularGradient
				if gradient then
					local gradientTween = TweenService:Create(gradient, tweenInfo, {
						Offset = Vector2.new(specularShiftOffset.X.Scale, specularShiftOffset.Y.Scale),
					})
					trackTween(gradientTween)
					gradientTween:Play()
				end
			end)

			local leaveConnection = target.MouseLeave:Connect(function()
				cancelAllTweens()
				local tweenInfo = makeSmoothTweenInfo(restoreDuration)
				local sizeTween = TweenService:Create(target, tweenInfo, { Size = origSize })
				trackTween(sizeTween)
				sizeTween:Play()
				local gradient = specularGradient
				if gradient then
					local gradientTween = TweenService:Create(gradient, tweenInfo, {
						Offset = Vector2.new(0, 0),
					})
					trackTween(gradientTween)
					gradientTween:Play()
				end
			end)

			table.insert(connections, enterConnection)
			table.insert(connections, leaveConnection)

			if UserInputService.TouchEnabled then
				-- Create transparent TextButton for reliable touch input on transparent targets
				local hitBtn = Instance.new("TextButton")
				hitBtn.Name = "FusionTouchHitArea"
				hitBtn.Size = UDim2.new(1, 0, 1, 0)
				hitBtn.BackgroundTransparency = 1
				hitBtn.BorderSizePixel = 0
				hitBtn.Text = ""
				hitBtn.AutoButtonColor = false
				hitBtn.ZIndex = 99
				hitBtn.Parent = target
				touchHitArea = hitBtn

				local touchBeginConn = hitBtn.InputBegan:Connect(function(input: InputObject)
					if input.UserInputType == Enum.UserInputType.Touch then
						cancelAllTweens()
						local tweenInfo = makeSmoothTweenInfo(bulgeDuration)
						local sizeTween = TweenService:Create(target, tweenInfo, { Size = bulgeSize })
						trackTween(sizeTween)
						sizeTween:Play()
						local gradient = specularGradient
						if gradient then
							local gradTween = TweenService:Create(gradient, tweenInfo, {
								Offset = Vector2.new(specularShiftOffset.X.Scale, specularShiftOffset.Y.Scale),
							})
							trackTween(gradTween)
							gradTween:Play()
						end
					end
				end)
				local touchEndConn = hitBtn.InputEnded:Connect(function(input: InputObject)
					if input.UserInputType == Enum.UserInputType.Touch then
						cancelAllTweens()
						local tweenInfo = makeSmoothTweenInfo(restoreDuration)
						local sizeTween = TweenService:Create(target, tweenInfo, { Size = origSize })
						trackTween(sizeTween)
						sizeTween:Play()
						local gradient = specularGradient
						if gradient then
							local gradTween = TweenService:Create(gradient, tweenInfo, {
								Offset = Vector2.new(0, 0),
							})
							trackTween(gradTween)
							gradTween:Play()
						end
					end
				end)
				table.insert(connections, touchBeginConn)
				table.insert(connections, touchEndConn)
			end
		end
	end

	function controller.Disconnect(self: Types.LiquidFusionController)
		for _, connection in connections do
			connection:Disconnect()
		end
		table.clear(connections)
		cancelAllTweens()
	end

	function controller.Destroy(self: Types.LiquidFusionController)
		controller:Disconnect()
		originalSize = nil
		specularGradient = nil
		if uiScaleInstance then
			uiScaleInstance:Destroy()
			uiScaleInstance = nil
		end
		if touchHitArea then
			touchHitArea:Destroy()
			touchHitArea = nil
		end
	end

	return controller
end

return module

end

_modules["RefractionProxy"] = function()


local RunService = game:GetService("RunService")
local HttpService = game:GetService("HttpService")

local Types = _require("Types")
local Themes = _require("Themes")
local resolve = Themes.resolve

local module = {}
local proxyDepthCounter = 0
local DEPTH_STEP = 0.003

function module.resetDepthCounter()
	proxyDepthCounter = 0
end

function module.new(config: Types.RefractionProxyConfig): Types.RefractionProxy
	local theme = config.Theme

	local targetGui: GuiObject = config.TargetGui
	local glassTransparency: number = resolve(config.GlassTransparency, theme and theme.GlassTransparency, 0.91)
	local glassMaterial: Enum.Material = resolve(config.GlassMaterial, nil, Enum.Material.Glass)
	local glassColor: Color3 = resolve(config.GlassColor, theme and theme.GlassColor, Color3.fromRGB(235, 240, 250))
	local glassReflectance: number = resolve(config.GlassReflectance, theme and theme.GlassReflectance, 0.04)
	local offsetDepth: number = resolve(config.OffsetDepth, nil, 1.5)
	local glassThickness: number = resolve(config.GlassThickness, nil, 0.05)
	local enabled: boolean = resolve(config.Enabled, nil, true)
	local viewportMode: boolean = resolve(config.ViewportMode, nil, false)

	proxyDepthCounter += 1
	local adjustedDepth: number = offsetDepth + (proxyDepthCounter * DEPTH_STEP)

	local bindingName: string = "MangoRefraction_" .. HttpService:GenerateGUID(false)

	-- Create the Glass Part
	local glassPart = Instance.new("Part")
	glassPart.Name = "MangoRefractionProxy"
	glassPart.Material = glassMaterial
	glassPart.Transparency = glassTransparency
	glassPart.Color = glassColor
	glassPart.Reflectance = glassReflectance
	glassPart.CanCollide = false
	glassPart.CanQuery = false
	glassPart.CanTouch = false
	glassPart.Anchored = true
	glassPart.CastShadow = false
	glassPart.TopSurface = Enum.SurfaceType.Smooth
	glassPart.BottomSurface = Enum.SurfaceType.Smooth
	local Workspace = game:GetService("Workspace")
	local camera = Workspace.CurrentCamera or Workspace:WaitForChild("CurrentCamera")
	glassPart.Parent = camera

	local function updatePartTransform()
		local camera = game:GetService("Workspace").CurrentCamera
		if not camera then
			return
		end

		local viewportSize: Vector2 = camera.ViewportSize
		if viewportSize.X == 0 or viewportSize.Y == 0 then
			return
		end

		local cameraCF: CFrame = camera.CFrame

		if viewportMode then
			-- Full viewport coverage — single Glass Part covers entire screen
			local fov: number = math.rad(camera.FieldOfView)
			local worldHeight: number = 2 * adjustedDepth * math.tan(fov * 0.5)
			local aspectRatio: number = viewportSize.X / viewportSize.Y
			local worldWidth: number = worldHeight * aspectRatio
			glassPart.Size = Vector3.new(worldWidth, worldHeight, glassThickness)
			glassPart.CFrame = cameraCF * CFrame.new(0, 0, -adjustedDepth)
		else
			-- Per-GUI tracking mode using ScreenPointToRay for robust coordinate mapping.
			-- This avoids all GUI inset ambiguity: AbsolutePosition with IgnoreGuiInset=true
			-- is in full-screen coords, matching ScreenPointToRay's coordinate system.
			local absSize: Vector2 = targetGui.AbsoluteSize
			local absPos: Vector2 = targetGui.AbsolutePosition

			local centerVpX: number = absPos.X + absSize.X * 0.5
			local centerVpY: number = absPos.Y + absSize.Y * 0.5

			local centerRay: Ray = camera:ScreenPointToRay(centerVpX, centerVpY, 0)
			local camForward: Vector3 = cameraCF.LookVector
			local t: number = adjustedDepth / camForward:Dot(centerRay.Direction)
			local worldCenter: Vector3 = cameraCF.Position + centerRay.Direction * t

			local topLeftRay: Ray = camera:ScreenPointToRay(absPos.X, absPos.Y, 0)
			local bottomRightRay: Ray = camera:ScreenPointToRay(absPos.X + absSize.X, absPos.Y + absSize.Y, 0)
			local tTL: number = adjustedDepth / camForward:Dot(topLeftRay.Direction)
			local tBR: number = adjustedDepth / camForward:Dot(bottomRightRay.Direction)
			local worldTL: Vector3 = cameraCF.Position + topLeftRay.Direction * tTL
			local worldBR: Vector3 = cameraCF.Position + bottomRightRay.Direction * tBR

			local localTL: Vector3 = cameraCF:PointToObjectSpace(worldTL)
			local localBR: Vector3 = cameraCF:PointToObjectSpace(worldBR)
			local partWidth: number = math.abs(localBR.X - localTL.X)
			local partHeight: number = math.abs(localBR.Y - localTL.Y)

			-- Inset glass Part slightly so rectangular edges hide behind rounded UI corners
			glassPart.Size = Vector3.new(partWidth * 0.97, partHeight * 0.95, glassThickness)
			glassPart.CFrame = CFrame.new(worldCenter, worldCenter + cameraCF.LookVector)
		end
	end

	local function bindRenderStep()
		RunService:BindToRenderStep(
			bindingName,
			Enum.RenderPriority.Camera.Value + 1,
			updatePartTransform
		)
	end

	local function unbindRenderStep()
		RunService:UnbindFromRenderStep(bindingName)
	end

	-- Start tracking if enabled
	if enabled then
		bindRenderStep()
	else
		glassPart.Transparency = 1
	end

	local proxy = {} :: Types.RefractionProxy
	proxy.GlassPart = glassPart
	proxy.Enabled = enabled

	function proxy.SetEnabled(self: Types.RefractionProxy, newEnabled: boolean)
		if self.Enabled == newEnabled then
			return
		end
		self.Enabled = newEnabled
		if newEnabled then
			glassPart.Transparency = glassTransparency
			bindRenderStep()
		else
			unbindRenderStep()
			glassPart.Transparency = 1
		end
	end

	function proxy.UpdateTarget(self: Types.RefractionProxy, newGui: GuiObject)
		targetGui = newGui
	end

	function proxy.Destroy(self: Types.RefractionProxy)
		self.Enabled = false
		pcall(unbindRenderStep)
		glassPart:Destroy()
		self.GlassPart = nil :: any
	end

	return proxy
end

return module

end

_modules["MangoGlassFrame"] = function()


local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")

local Types = _require("Types")
local Themes = _require("Themes")
local resolve = Themes.resolve

local module = {}

function module.new(config: Types.MangoGlassConfig): Types.MangoGlassFrame
	local theme = config.Theme

	-- Resolve all config values with nil-safe helper
	local size = config.Size
	local position = config.Position
	local anchorPoint = resolve(config.AnchorPoint, nil, Vector2.new(0, 0)) :: Vector2
	local cornerRadius = resolve(config.CornerRadius, nil, UDim.new(0, 16)) :: UDim
	local backgroundColor = resolve(config.BackgroundColor3, theme and theme.BackgroundColor3, Color3.fromRGB(255, 255, 255)) :: Color3
	local backgroundTransparency = resolve(config.BackgroundTransparency, theme and theme.BackgroundTransparency, 0.72) :: number
	local noiseImageId = resolve(config.NoiseImageId, nil, "rbxassetid://4531766211") :: string
	local noiseOpacity = resolve(config.NoiseOpacity, theme and theme.NoiseOpacity, 0.03) :: number
	local lensGroupColor3 = resolve(config.LensGroupColor3, theme and theme.LensGroupColor3, Color3.fromRGB(255, 254, 252)) :: Color3
	local lensGroupTransparency = resolve(config.LensGroupTransparency, theme and theme.LensGroupTransparency, 0.65) :: number
	local innerGlowColor = resolve(config.InnerGlowColor, theme and theme.InnerGlowColor, Color3.fromRGB(255, 255, 255)) :: Color3
	local innerGlowTransparency = resolve(config.InnerGlowTransparency, theme and theme.InnerGlowTransparency, 0.55) :: number
	local innerGlowHeight = resolve(config.InnerGlowHeight, theme and theme.InnerGlowHeight, 0.30) :: number
	local strokeColor = resolve(config.StrokeColor, theme and theme.StrokeColor, Color3.fromRGB(255, 255, 255)) :: Color3
	local strokeThickness = resolve(config.StrokeThickness, theme and theme.StrokeThickness, 1) :: number
	local fresnelStart = resolve(config.FresnelStartTransparency, theme and theme.FresnelStartTransparency, 0.25) :: number
	local fresnelEnd = resolve(config.FresnelEndTransparency, theme and theme.FresnelEndTransparency, 0.95) :: number
	local fresnelMid = resolve(config.FresnelMidTransparency, theme and theme.FresnelMidTransparency, 0.50) :: number
	local fresnelMidPoint = resolve(config.FresnelMidPoint, theme and theme.FresnelMidPoint, 0.35) :: number
	local fresnelAngle = resolve(config.FresnelAngle, theme and theme.FresnelAngle, 90) :: number
	local shadowColor = resolve(config.ShadowColor, theme and theme.ShadowColor, Color3.fromRGB(0, 0, 0)) :: Color3
	local shadowTransparency = resolve(config.ShadowTransparency, theme and theme.ShadowTransparency, 0.68) :: number
	local shadowSpread = resolve(config.ShadowSpread, theme and theme.ShadowSpread, 8) :: number
	local shadowOffsetY = resolve(config.ShadowOffsetY, theme and theme.ShadowOffsetY, 2) :: number
	local shadowOffsetX = resolve(config.ShadowOffsetX, theme and theme.ShadowOffsetX, 0) :: number
	local shadowEnabled = resolve(config.ShadowEnabled, nil, true) :: boolean
	local shadowLayerCount = resolve(config.ShadowLayerCount, nil, 5) :: number
	local lightweightMode = resolve(config.LightweightMode, nil, false) :: boolean
	local parallaxEnabled = resolve(config.ParallaxEnabled, nil, false) :: boolean
	local parallaxIntensity = resolve(config.ParallaxIntensity, theme and theme.ParallaxIntensity, 0.15) :: number

	-- Container (transparent wrapper, NO ClipsDescendants, NO UICorner)
	local container = Instance.new("Frame")
	container.Name = "MangoGlassFrame"
	container.Size = size
	container.Position = position
	container.AnchorPoint = anchorPoint
	container.BackgroundTransparency = 1
	container.BorderSizePixel = 0

	-- N-layer graduated shadow (quadratic falloff eliminates banding)
	local layerCount = math.clamp(shadowLayerCount, 1, 12)
	local shadowLayers: {Frame} = {}

	-- Loop REVERSED: outermost added first (bottom), innermost added last (top, darkest)
	for i = layerCount, 1, -1 do
		local t = i / layerCount
		local spread = math.ceil(shadowSpread * t)
		local layerAlpha = (1 - shadowTransparency)
			* ((layerCount - i + 1) / layerCount) ^ 2
			/ (layerCount / 3)
		local layerTransparency = math.clamp(1 - layerAlpha, 0, 1)
		local cornerRadiusOffset = math.ceil(8 * t)

		local shadowLayer = Instance.new("Frame")
		shadowLayer.Name = "ShadowLayer" .. i
		shadowLayer.AnchorPoint = Vector2.new(0.5, 0.5)
		shadowLayer.Position = UDim2.new(0.5, shadowOffsetX, 0.5, shadowOffsetY)
		shadowLayer.Size = UDim2.new(1, spread * 2, 1, spread * 2)
		shadowLayer.BackgroundColor3 = shadowColor
		shadowLayer.BackgroundTransparency = layerTransparency
		shadowLayer.BorderSizePixel = 0
		shadowLayer.ZIndex = 0
		shadowLayer.Visible = shadowEnabled
		shadowLayer.Parent = container

		local layerCorner = Instance.new("UICorner")
		layerCorner.CornerRadius = UDim.new(0, cornerRadius.Offset + cornerRadiusOffset)
		layerCorner.Parent = shadowLayer

		table.insert(shadowLayers, shadowLayer)
	end

	-- GlassSurface (clipping inner frame)
	local glassSurface = Instance.new("Frame")
	glassSurface.Name = "GlassSurface"
	glassSurface.Size = UDim2.new(1, 0, 1, 0)
	glassSurface.BackgroundColor3 = backgroundColor
	glassSurface.BackgroundTransparency = backgroundTransparency
	glassSurface.ClipsDescendants = true
	glassSurface.BorderSizePixel = 0
	glassSurface.ZIndex = 1
	glassSurface.Parent = container

	local glassSurfaceCorner = Instance.new("UICorner")
	glassSurfaceCorner.CornerRadius = cornerRadius
	glassSurfaceCorner.Parent = glassSurface

	local surfaceGradient = Instance.new("UIGradient")
	surfaceGradient.Name = "SurfaceGradient"
	surfaceGradient.Rotation = 135 -- Apple's diagonal gradient (top-left to bottom-right)
	surfaceGradient.Color = ColorSequence.new({
		ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 255, 255)),
		ColorSequenceKeypoint.new(1, Color3.fromRGB(230, 230, 235)),
	})
	surfaceGradient.Transparency = NumberSequence.new({
		NumberSequenceKeypoint.new(0, 0.92),
		NumberSequenceKeypoint.new(1, 0.96),
	})
	surfaceGradient.Parent = glassSurface

	local lensGroup: CanvasGroup? = nil
	local textureGroup: CanvasGroup? = nil
	local noiseTile: ImageLabel? = nil
	local innerHighlight: Frame? = nil

	if not lightweightMode then
		-- LensGroup (saturation tint via CanvasGroup)
		local lg = Instance.new("CanvasGroup")
		lg.Name = "LensGroup"
		lg.Size = UDim2.new(1, 0, 1, 0)
		lg.GroupColor3 = lensGroupColor3
		lg.GroupTransparency = lensGroupTransparency
		lg.BackgroundTransparency = 1
		lg.BorderSizePixel = 0
		lg.Parent = glassSurface

		local lensCorner = Instance.new("UICorner")
		lensCorner.CornerRadius = cornerRadius
		lensCorner.Parent = lg

		-- TextureGroup (noise dithering layer)
		local tg = Instance.new("CanvasGroup")
		tg.Name = "TextureGroup"
		tg.Size = UDim2.new(1, 0, 1, 0)
		tg.BackgroundTransparency = 1
		tg.BorderSizePixel = 0
		tg.Parent = lg

		local textureCorner = Instance.new("UICorner")
		textureCorner.CornerRadius = cornerRadius
		textureCorner.Parent = tg

		-- NoiseTile (Perlin noise overlay)
		local nt = Instance.new("ImageLabel")
		nt.Name = "NoiseTile"
		nt.Image = noiseImageId
		nt.ImageTransparency = 1 - noiseOpacity
		nt.ScaleType = Enum.ScaleType.Tile
		nt.TileSize = UDim2.new(0.125, 0, 0.125, 0)
		nt.Size = UDim2.new(1, 0, 1, 0)
		nt.BackgroundTransparency = 1
		nt.BorderSizePixel = 0
		nt.Parent = tg

		local noiseCorner = Instance.new("UICorner")
		noiseCorner.CornerRadius = cornerRadius
		noiseCorner.Parent = nt

		-- InnerHighlight (subtle top-edge glow)
		local ih = Instance.new("Frame")
		ih.Name = "InnerHighlight"
		ih.Size = UDim2.new(1, 0, innerGlowHeight, 0)
		ih.Position = UDim2.new(0, 0, 0, 0)
		ih.BackgroundColor3 = innerGlowColor
		ih.BackgroundTransparency = innerGlowTransparency
		ih.BorderSizePixel = 0
		ih.ZIndex = 2
		ih.Parent = tg

		local highlightCorner = Instance.new("UICorner")
		highlightCorner.CornerRadius = cornerRadius
		highlightCorner.Parent = ih

		local highlightGradient = Instance.new("UIGradient")
		highlightGradient.Name = "HighlightGradient"
		highlightGradient.Transparency = NumberSequence.new({
			NumberSequenceKeypoint.new(0, 0),
			NumberSequenceKeypoint.new(1, 1),
		})
		highlightGradient.Rotation = 90
		highlightGradient.Parent = ih

		lensGroup = lg
		textureGroup = tg
		noiseTile = nt
		innerHighlight = ih
	end

	-- Inner edge highlight (full-perimeter inner shadow inside GlassSurface)
	local innerEdgeColor = resolve(config.InnerEdgeColor, theme and theme.InnerEdgeColor, Color3.fromRGB(255, 255, 255)) :: Color3
	local innerEdgeTop = resolve(config.InnerEdgeTopTransparency, theme and theme.InnerEdgeTopTransparency, 0.30) :: number
	local innerEdgeMid = resolve(config.InnerEdgeMidTransparency, theme and theme.InnerEdgeMidTransparency, 0.68) :: number
	local innerEdgeBottom = resolve(config.InnerEdgeBottomTransparency, theme and theme.InnerEdgeBottomTransparency, 0.90) :: number

	local innerEdgeFrame = Instance.new("Frame")
	innerEdgeFrame.Name = "InnerEdgeFrame"
	innerEdgeFrame.Size = UDim2.new(1, 0, 1, 0)
	innerEdgeFrame.BackgroundTransparency = 1
	innerEdgeFrame.BorderSizePixel = 0
	innerEdgeFrame.ZIndex = 3
	innerEdgeFrame.Parent = glassSurface

	local innerEdgeCorner = Instance.new("UICorner")
	innerEdgeCorner.CornerRadius = cornerRadius
	innerEdgeCorner.Parent = innerEdgeFrame

	local innerEdgeStroke = Instance.new("UIStroke")
	innerEdgeStroke.Name = "InnerEdgeStroke"
	innerEdgeStroke.Color = innerEdgeColor
	innerEdgeStroke.Thickness = 1
	innerEdgeStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
	innerEdgeStroke.Parent = innerEdgeFrame

	local innerEdgeGradient = Instance.new("UIGradient")
	innerEdgeGradient.Name = "InnerEdgeGradient"
	innerEdgeGradient.Rotation = 90
	innerEdgeGradient.Transparency = NumberSequence.new({
		NumberSequenceKeypoint.new(0, innerEdgeTop),
		NumberSequenceKeypoint.new(0.5, innerEdgeMid),
		NumberSequenceKeypoint.new(1, innerEdgeBottom),
	})
	innerEdgeGradient.Parent = innerEdgeStroke

	-- SpecularFrame (CHILD OF CONTAINER, outside clip boundary)
	local specularFrame = Instance.new("Frame")
	specularFrame.Name = "SpecularFrame"
	specularFrame.Size = UDim2.new(1, 0, 1, 0)
	specularFrame.BackgroundTransparency = 1
	specularFrame.BorderSizePixel = 0
	specularFrame.ZIndex = 2
	specularFrame.Parent = container

	local specularCorner = Instance.new("UICorner")
	specularCorner.CornerRadius = cornerRadius
	specularCorner.Parent = specularFrame

	-- UIStroke (directional Fresnel rim)
	local specularStroke = Instance.new("UIStroke")
	specularStroke.Name = "SpecularStroke"
	specularStroke.Color = strokeColor
	specularStroke.Thickness = strokeThickness
	specularStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
	specularStroke.Parent = specularFrame

	-- UIGradient (directional top-lit transparency)
	local specularGradient = Instance.new("UIGradient")
	specularGradient.Name = "SpecularGradient"
	specularGradient.Rotation = fresnelAngle
	specularGradient.Transparency = NumberSequence.new({
		NumberSequenceKeypoint.new(0, fresnelStart),
		NumberSequenceKeypoint.new(fresnelMidPoint, fresnelMid),
		NumberSequenceKeypoint.new(1, fresnelEnd),
	})
	specularGradient.Parent = specularStroke

	-- Parent assignment
	if config.Parent then
		container.Parent = config.Parent
	end

	-- Parallax system
	local Workspace = game:GetService("Workspace")
	local parallaxBindingName = "MangoParallax_" .. tostring(math.random(100000, 999999))
	local parallaxBound = false

	local function startParallax()
		if parallaxBound then
			return
		end
		parallaxBound = true
		RunService:BindToRenderStep(parallaxBindingName, Enum.RenderPriority.Camera.Value + 1, function()
			local camera = Workspace.CurrentCamera
			if not camera then
				return
			end
			local mousePos = UserInputService:GetMouseLocation()
			local viewportSize = camera.ViewportSize
			if viewportSize.X == 0 or viewportSize.Y == 0 then
				return
			end
			local nx = (mousePos.X / viewportSize.X - 0.5) * 2
			local ny = (mousePos.Y / viewportSize.Y - 0.5) * 2
			local intensity = parallaxIntensity

			specularGradient.Offset = Vector2.new(nx * 0.03 * intensity, ny * 0.03 * intensity)
			innerEdgeGradient.Offset = Vector2.new(nx * 0.02 * intensity, ny * 0.02 * intensity)

			if not lightweightMode and innerHighlight then
				local highlightGrad = (innerHighlight :: Frame):FindFirstChild("HighlightGradient")
				if highlightGrad and highlightGrad:IsA("UIGradient") then
					(highlightGrad :: UIGradient).Offset = Vector2.new(nx * 0.01 * intensity, ny * 0.005 * intensity)
				end
			end
		end)
	end

	local function stopParallax()
		if not parallaxBound then
			return
		end
		parallaxBound = false
		pcall(function()
			RunService:UnbindFromRenderStep(parallaxBindingName)
		end)
	end

	if parallaxEnabled then
		startParallax()
	end

	local self: Types.MangoGlassFrame = {
		Container = container,
		Frame = container,
		GlassSurface = glassSurface,
		ShadowLayers = shadowLayers,
		LensGroup = lensGroup,
		TextureGroup = textureGroup,
		NoiseLabel = noiseTile,
		InnerHighlight = innerHighlight,
		InnerEdgeFrame = innerEdgeFrame,
		InnerEdgeStroke = innerEdgeStroke,
		InnerEdgeGradient = innerEdgeGradient,
		SpecularFrame = specularFrame,
		SpecularStroke = specularStroke,
		SpecularGradient = specularGradient,
		SetLightDirection = function(self: Types.MangoGlassFrame, angle: number)
			self.SpecularGradient.Rotation = angle
			self.InnerEdgeGradient.Rotation = angle
			local highlight = self.InnerHighlight
			if highlight then
				local highlightGrad = highlight:FindFirstChild("HighlightGradient")
				if highlightGrad and highlightGrad:IsA("UIGradient") then
					(highlightGrad :: UIGradient).Rotation = angle
				end
			end
		end,
		SetParallaxEnabled = function(self: Types.MangoGlassFrame, newEnabled: boolean)
			parallaxEnabled = newEnabled
			if newEnabled then
				startParallax()
			else
				stopParallax()
			end
		end,
		Destroy = function(self: Types.MangoGlassFrame)
			stopParallax()
			self.Container:Destroy()
		end,
	}

	return self
end

return module

end

_modules["MangoToggle"] = function()


local TweenService = game:GetService("TweenService")

local Types = _require("Types")
local Themes = _require("Themes")
local resolve = Themes.resolve

local module = {}

function module.new(config: Types.MangoToggleConfig): Types.MangoToggle
	local scale = resolve(config.Scale, nil, 1) :: number
	local theme = config.Theme
	local initialState = resolve(config.InitialState, nil, false) :: boolean

	-- Track colors
	local onTrackColor = resolve(nil, theme and theme.ToggleOnTrackColor, Color3.fromRGB(52, 199, 89)) :: Color3
	local offTrackColor = resolve(nil, theme and theme.ToggleOffTrackColor, Color3.fromRGB(200, 200, 200)) :: Color3
	local knobColor = resolve(nil, theme and theme.ToggleKnobColor, Color3.fromRGB(255, 255, 255)) :: Color3

	-- Stroke/fresnel from theme (matching glass)
	local strokeColor = resolve(nil, theme and theme.StrokeColor, Color3.fromRGB(255, 255, 255)) :: Color3
	local fresnelStart = resolve(nil, theme and theme.FresnelStartTransparency, 0.30) :: number
	local fresnelEnd = resolve(nil, theme and theme.FresnelEndTransparency, 0.95) :: number
	local fresnelMid = resolve(nil, theme and theme.FresnelMidTransparency, 0.55) :: number
	local fresnelMidPoint = resolve(nil, theme and theme.FresnelMidPoint, 0.35) :: number

	-- Dimensions (all scaled)
	local containerWidth = math.floor(51 * scale)
	local containerHeight = math.floor(31 * scale)
	local knobSize = math.floor(27 * scale)
	local knobShadowSize = math.floor(29 * scale)

	-- State
	local isOn: boolean = initialState
	local activeTweens: { Tween } = {}
	local inputConnection: RBXScriptConnection? = nil

	local function cancelAllTweens()
		for _, tween in activeTweens do
			tween:Cancel()
		end
		table.clear(activeTweens)
	end

	local function trackTween(tween: Tween): Tween
		table.insert(activeTweens, tween)
		return tween
	end

	-- ============================================================
	-- Container
	-- ============================================================
	local container = Instance.new("Frame")
	container.Name = "MangoToggle"
	container.Size = UDim2.new(0, containerWidth, 0, containerHeight)
	container.Position = config.Position
	container.AnchorPoint = resolve(config.AnchorPoint, nil, Vector2.new(0, 0)) :: Vector2
	container.BackgroundTransparency = 1
	container.BorderSizePixel = 0

	-- ============================================================
	-- TrackShadow1 (outer, subtle)
	-- ============================================================
	local trackShadow1 = Instance.new("Frame")
	trackShadow1.Name = "TrackShadow1"
	trackShadow1.AnchorPoint = Vector2.new(0.5, 0.5)
	trackShadow1.Position = UDim2.new(0.5, 0, 0.5, math.floor(1 * scale))
	trackShadow1.Size = UDim2.new(1, math.floor(4 * scale), 1, math.floor(4 * scale))
	trackShadow1.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
	trackShadow1.BackgroundTransparency = 0.92
	trackShadow1.BorderSizePixel = 0
	trackShadow1.ZIndex = 0
	trackShadow1.Parent = container

	local trackShadow1Corner = Instance.new("UICorner")
	trackShadow1Corner.CornerRadius = UDim.new(0, 999)
	trackShadow1Corner.Parent = trackShadow1

	-- ============================================================
	-- TrackShadow2 (tighter)
	-- ============================================================
	local trackShadow2 = Instance.new("Frame")
	trackShadow2.Name = "TrackShadow2"
	trackShadow2.AnchorPoint = Vector2.new(0.5, 0.5)
	trackShadow2.Position = UDim2.new(0.5, 0, 0.5, math.floor(1 * scale))
	trackShadow2.Size = UDim2.new(1, math.floor(2 * scale), 1, math.floor(2 * scale))
	trackShadow2.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
	trackShadow2.BackgroundTransparency = 0.84
	trackShadow2.BorderSizePixel = 0
	trackShadow2.ZIndex = 0
	trackShadow2.Parent = container

	local trackShadow2Corner = Instance.new("UICorner")
	trackShadow2Corner.CornerRadius = UDim.new(0, 999)
	trackShadow2Corner.Parent = trackShadow2

	-- ============================================================
	-- TrackSurface (pill shape)
	-- ============================================================
	local trackSurface = Instance.new("Frame")
	trackSurface.Name = "TrackSurface"
	trackSurface.Size = UDim2.new(1, 0, 1, 0)
	trackSurface.BackgroundColor3 = if isOn then onTrackColor else offTrackColor
	trackSurface.BackgroundTransparency = 0
	trackSurface.BorderSizePixel = 0
	trackSurface.ZIndex = 1
	trackSurface.Parent = container

	local trackSurfaceCorner = Instance.new("UICorner")
	trackSurfaceCorner.CornerRadius = UDim.new(0, 999)
	trackSurfaceCorner.Parent = trackSurface

	-- TrackSpecularFrame (specular rim on track)
	local trackSpecularFrame = Instance.new("Frame")
	trackSpecularFrame.Name = "TrackSpecularFrame"
	trackSpecularFrame.Size = UDim2.new(1, 0, 1, 0)
	trackSpecularFrame.BackgroundTransparency = 1
	trackSpecularFrame.BorderSizePixel = 0
	trackSpecularFrame.ZIndex = 2
	trackSpecularFrame.Parent = trackSurface

	local trackSpecularCorner = Instance.new("UICorner")
	trackSpecularCorner.CornerRadius = UDim.new(0, 999)
	trackSpecularCorner.Parent = trackSpecularFrame

	local trackSpecularStroke = Instance.new("UIStroke")
	trackSpecularStroke.Name = "TrackSpecularStroke"
	trackSpecularStroke.Color = strokeColor
	trackSpecularStroke.Thickness = math.floor(1 * scale)
	trackSpecularStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
	trackSpecularStroke.Parent = trackSpecularFrame

	local trackSpecularGradient = Instance.new("UIGradient")
	trackSpecularGradient.Rotation = 90
	trackSpecularGradient.Transparency = NumberSequence.new({
		NumberSequenceKeypoint.new(0, fresnelStart),
		NumberSequenceKeypoint.new(fresnelMidPoint, fresnelMid),
		NumberSequenceKeypoint.new(1, fresnelEnd),
	})
	trackSpecularGradient.Parent = trackSpecularStroke

	-- ============================================================
	-- KnobContainer
	-- ============================================================
	local knobContainer = Instance.new("Frame")
	knobContainer.Name = "KnobContainer"
	knobContainer.Size = UDim2.new(0, knobSize, 0, knobSize)
	knobContainer.BackgroundTransparency = 1
	knobContainer.BorderSizePixel = 0
	knobContainer.ZIndex = 3
	knobContainer.Parent = container

	-- Set initial knob position (no animation)
	if isOn then
		knobContainer.AnchorPoint = Vector2.new(1, 0.5)
		knobContainer.Position = UDim2.new(1, -math.floor(2 * scale), 0.5, 0)
	else
		knobContainer.AnchorPoint = Vector2.new(0, 0.5)
		knobContainer.Position = UDim2.new(0, math.floor(2 * scale), 0.5, 0)
	end

	-- KnobShadow
	local knobShadow = Instance.new("Frame")
	knobShadow.Name = "KnobShadow"
	knobShadow.AnchorPoint = Vector2.new(0.5, 0.5)
	knobShadow.Position = UDim2.new(0.5, 0, 0.5, 0)
	knobShadow.Size = UDim2.new(0, knobShadowSize, 0, knobShadowSize)
	knobShadow.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
	knobShadow.BackgroundTransparency = 0.85
	knobShadow.BorderSizePixel = 0
	knobShadow.ZIndex = 0
	knobShadow.Parent = knobContainer

	local knobShadowCorner = Instance.new("UICorner")
	knobShadowCorner.CornerRadius = UDim.new(0, 999)
	knobShadowCorner.Parent = knobShadow

	-- KnobSurface
	local knobSurface = Instance.new("Frame")
	knobSurface.Name = "KnobSurface"
	knobSurface.AnchorPoint = Vector2.new(0.5, 0.5)
	knobSurface.Position = UDim2.new(0.5, 0, 0.5, 0)
	knobSurface.Size = UDim2.new(0, knobSize, 0, knobSize)
	knobSurface.BackgroundColor3 = knobColor
	knobSurface.BackgroundTransparency = 0
	knobSurface.BorderSizePixel = 0
	knobSurface.ZIndex = 1
	knobSurface.Parent = knobContainer

	local knobSurfaceCorner = Instance.new("UICorner")
	knobSurfaceCorner.CornerRadius = UDim.new(0, 999)
	knobSurfaceCorner.Parent = knobSurface

	-- KnobHighlight (top inner glow)
	local knobHighlight = Instance.new("Frame")
	knobHighlight.Name = "KnobHighlight"
	knobHighlight.Size = UDim2.new(1, 0, 0.4, 0)
	knobHighlight.Position = UDim2.new(0, 0, 0, 0)
	knobHighlight.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
	knobHighlight.BackgroundTransparency = 0.7
	knobHighlight.BorderSizePixel = 0
	knobHighlight.ZIndex = 2
	knobHighlight.Parent = knobSurface

	local knobHighlightCorner = Instance.new("UICorner")
	knobHighlightCorner.CornerRadius = UDim.new(0, 999)
	knobHighlightCorner.Parent = knobHighlight

	local knobHighlightGradient = Instance.new("UIGradient")
	knobHighlightGradient.Rotation = 90
	knobHighlightGradient.Transparency = NumberSequence.new({
		NumberSequenceKeypoint.new(0, 0),
		NumberSequenceKeypoint.new(1, 1),
	})
	knobHighlightGradient.Parent = knobHighlight

	-- KnobSpecularFrame
	local knobSpecularFrame = Instance.new("Frame")
	knobSpecularFrame.Name = "KnobSpecularFrame"
	knobSpecularFrame.Size = UDim2.new(1, 0, 1, 0)
	knobSpecularFrame.AnchorPoint = Vector2.new(0.5, 0.5)
	knobSpecularFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
	knobSpecularFrame.BackgroundTransparency = 1
	knobSpecularFrame.BorderSizePixel = 0
	knobSpecularFrame.ZIndex = 2
	knobSpecularFrame.Parent = knobSurface

	local knobSpecularCorner = Instance.new("UICorner")
	knobSpecularCorner.CornerRadius = UDim.new(0, 999)
	knobSpecularCorner.Parent = knobSpecularFrame

	local knobSpecularStroke = Instance.new("UIStroke")
	knobSpecularStroke.Color = strokeColor
	knobSpecularStroke.Thickness = math.floor(1 * scale)
	knobSpecularStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
	knobSpecularStroke.Parent = knobSpecularFrame

	local knobSpecularGradient = Instance.new("UIGradient")
	knobSpecularGradient.Rotation = 90
	knobSpecularGradient.Transparency = NumberSequence.new({
		NumberSequenceKeypoint.new(0, fresnelStart + 0.1),
		NumberSequenceKeypoint.new(fresnelMidPoint, fresnelMid + 0.05),
		NumberSequenceKeypoint.new(1, fresnelEnd),
	})
	knobSpecularGradient.Parent = knobSpecularStroke

	-- ============================================================
	-- Animation
	-- ============================================================
	local function animateToState(state: boolean)
		cancelAllTweens()

		-- Knob position: 0.25s, Back, Out
		local knobTweenInfo = TweenInfo.new(
			0.25,
			Enum.EasingStyle.Back,
			Enum.EasingDirection.Out,
			0,
			false,
			0
		)

		-- Track color: 0.2s, Quad, Out
		local trackTweenInfo = TweenInfo.new(
			0.2,
			Enum.EasingStyle.Quad,
			Enum.EasingDirection.Out,
			0,
			false,
			0
		)

		if state then
			-- Animate knob to ON position
			local anchorTween = TweenService:Create(knobContainer, knobTweenInfo, {
				AnchorPoint = Vector2.new(1, 0.5),
				Position = UDim2.new(1, -math.floor(2 * scale), 0.5, 0),
			})
			trackTween(anchorTween)
			anchorTween:Play()

			-- Animate track to ON color
			local colorTween = TweenService:Create(trackSurface, trackTweenInfo, {
				BackgroundColor3 = onTrackColor,
			})
			trackTween(colorTween)
			colorTween:Play()
		else
			-- Animate knob to OFF position
			local anchorTween = TweenService:Create(knobContainer, knobTweenInfo, {
				AnchorPoint = Vector2.new(0, 0.5),
				Position = UDim2.new(0, math.floor(2 * scale), 0.5, 0),
			})
			trackTween(anchorTween)
			anchorTween:Play()

			-- Animate track to OFF color
			local colorTween = TweenService:Create(trackSurface, trackTweenInfo, {
				BackgroundColor3 = offTrackColor,
			})
			trackTween(colorTween)
			colorTween:Play()
		end
	end

	-- ============================================================
	-- Hit Area (transparent TextButton for reliable input on transparent container)
	-- ============================================================
	local hitArea = Instance.new("TextButton")
	hitArea.Name = "HitArea"
	hitArea.Size = UDim2.new(1, 0, 1, 0)
	hitArea.BackgroundTransparency = 1
	hitArea.BorderSizePixel = 0
	hitArea.Text = ""
	hitArea.AutoButtonColor = false
	hitArea.ZIndex = 100
	hitArea.Parent = container

	-- ============================================================
	-- Input Handling
	-- ============================================================
	inputConnection = hitArea.InputBegan:Connect(function(input: InputObject)
		if input.UserInputType == Enum.UserInputType.MouseButton1
			or input.UserInputType == Enum.UserInputType.Touch then
			isOn = not isOn
			animateToState(isOn)
			if config.OnToggled then
				config.OnToggled(isOn)
			end
		end
	end)

	-- ============================================================
	-- Parent assignment
	-- ============================================================
	if config.Parent then
		container.Parent = config.Parent
	end

	-- ============================================================
	-- Return table
	-- ============================================================
	local self: Types.MangoToggle = {
		Container = container,
		SetState = function(self: Types.MangoToggle, state: boolean)
			isOn = state
			animateToState(isOn)
		end,
		GetState = function(self: Types.MangoToggle): boolean
			return isOn
		end,
		Destroy = function(self: Types.MangoToggle)
			cancelAllTweens()
			if inputConnection then
				(inputConnection :: RBXScriptConnection):Disconnect()
				inputConnection = nil
			end
			container:Destroy()
		end,
	}

	return self
end

return module

end

_modules["MangoSlider"] = function()


local Types = _require("Types")
local Themes = _require("Themes")
local resolve = Themes.resolve
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")

local module = {}

local function makeSmoothTweenInfo(duration: number): TweenInfo
	return TweenInfo.new(
		duration,
		Enum.EasingStyle.Back,
		Enum.EasingDirection.Out,
		0,
		false,
		0
	)
end

function module.new(config: Types.MangoSliderConfig): Types.MangoSlider
	local theme = config.Theme

	-- Resolve all config values with nil-safe helper
	local size = resolve(config.Size, nil, UDim2.new(0, 200, 0, 36)) :: UDim2
	local position = config.Position
	local anchorPoint = resolve(config.AnchorPoint, nil, Vector2.new(0, 0)) :: Vector2
	local minVal = resolve(config.Min, nil, 0) :: number
	local maxVal = resolve(config.Max, nil, 1) :: number
	local step = resolve(config.Step, nil, 0) :: number
	local initialValue = resolve(config.InitialValue, nil, minVal) :: number

	local trackColor = resolve(nil, theme and theme.SliderTrackColor, Color3.fromRGB(220, 220, 225)) :: Color3
	local trackTransparency = resolve(nil, theme and theme.SliderTrackTransparency, 0.50) :: number
	local fillColor = resolve(nil, theme and theme.SliderFillColor, Color3.fromRGB(0, 122, 255)) :: Color3
	local thumbColor = resolve(nil, theme and theme.SliderThumbColor, Color3.fromRGB(255, 255, 255)) :: Color3
	local strokeColor = resolve(nil, theme and theme.StrokeColor, Color3.fromRGB(255, 255, 255)) :: Color3
	local fresnelStart = resolve(nil, theme and theme.FresnelStartTransparency, 0.30) :: number
	local fresnelMid = resolve(nil, theme and theme.FresnelMidTransparency, 0.55) :: number
	local fresnelMidPoint = resolve(nil, theme and theme.FresnelMidPoint, 0.35) :: number
	local fresnelEnd = resolve(nil, theme and theme.FresnelEndTransparency, 0.95) :: number

	-- State
	local currentValue: number = math.clamp(initialValue, minVal, maxVal)
	local isDragging = false
	local connections: {RBXScriptConnection} = {}
	local activeTweens: {Tween} = {}

	local function cancelAllTweens()
		for _, tween in activeTweens do
			tween:Cancel()
		end
		table.clear(activeTweens)
	end

	local function trackTween(tween: Tween): Tween
		table.insert(activeTweens, tween)
		return tween
	end

	-- ============================================================
	-- Instance Hierarchy
	-- ============================================================

	-- Container (transparent wrapper)
	local container = Instance.new("Frame")
	container.Name = "MangoSlider"
	container.Size = size
	container.Position = position
	container.AnchorPoint = anchorPoint
	container.BackgroundTransparency = 1
	container.BorderSizePixel = 0

	-- TrackShadow1 (outer, subtle shadow — fixed transparency)
	local trackShadow1 = Instance.new("Frame")
	trackShadow1.Name = "TrackShadow1"
	trackShadow1.AnchorPoint = Vector2.new(0.5, 0.5)
	trackShadow1.Position = UDim2.new(0.5, 0, 0.5, 1)
	trackShadow1.Size = UDim2.new(1, 6, 0, 14)
	trackShadow1.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
	trackShadow1.BackgroundTransparency = 0.86
	trackShadow1.BorderSizePixel = 0
	trackShadow1.ZIndex = 0
	trackShadow1.Parent = container

	local trackShadow1Corner = Instance.new("UICorner")
	trackShadow1Corner.CornerRadius = UDim.new(0, 999)
	trackShadow1Corner.Parent = trackShadow1

	-- TrackShadow2 (inner, tighter shadow — fixed transparency)
	local trackShadow2 = Instance.new("Frame")
	trackShadow2.Name = "TrackShadow2"
	trackShadow2.AnchorPoint = Vector2.new(0, 0.5)
	trackShadow2.Position = UDim2.new(0, -1.5, 0.5, 0.5)
	trackShadow2.Size = UDim2.new(1, 3, 0, 11)
	trackShadow2.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
	trackShadow2.BackgroundTransparency = 0.82
	trackShadow2.BorderSizePixel = 0
	trackShadow2.ZIndex = 0
	trackShadow2.Parent = container

	local trackShadow2Corner = Instance.new("UICorner")
	trackShadow2Corner.CornerRadius = UDim.new(0, 999)
	trackShadow2Corner.Parent = trackShadow2

	-- TrackSurface (6px tall glass-like pill, centered vertically)
	local trackSurface = Instance.new("Frame")
	trackSurface.Name = "TrackSurface"
	trackSurface.Size = UDim2.new(1, 0, 0, 6)
	trackSurface.Position = UDim2.new(0, 0, 0.5, 0)
	trackSurface.AnchorPoint = Vector2.new(0, 0.5)
	trackSurface.BackgroundColor3 = trackColor
	trackSurface.BackgroundTransparency = trackTransparency
	trackSurface.ClipsDescendants = true
	trackSurface.BorderSizePixel = 0
	trackSurface.ZIndex = 1
	trackSurface.Parent = container

	local trackSurfaceCorner = Instance.new("UICorner")
	trackSurfaceCorner.CornerRadius = UDim.new(0, 999)
	trackSurfaceCorner.Parent = trackSurface

	-- FillFrame (colored fill, anchored left, width = value fraction)
	local valueFraction = if (maxVal - minVal) > 0 then (currentValue - minVal) / (maxVal - minVal) else 0
	local fillFrame = Instance.new("Frame")
	fillFrame.Name = "FillFrame"
	fillFrame.Size = UDim2.new(valueFraction, 0, 1, 0)
	fillFrame.Position = UDim2.new(0, 0, 0, 0)
	fillFrame.AnchorPoint = Vector2.new(0, 0)
	fillFrame.BackgroundColor3 = fillColor
	local fillTransparency = resolve(nil, theme and theme.SliderFillTransparency, 0.40) :: number
	fillFrame.BackgroundTransparency = fillTransparency
	fillFrame.BorderSizePixel = 0
	fillFrame.ZIndex = 1
	fillFrame.ClipsDescendants = true
	fillFrame.Parent = trackSurface

	local fillFrameCorner = Instance.new("UICorner")
	fillFrameCorner.CornerRadius = UDim.new(0, 999)
	fillFrameCorner.Parent = fillFrame

	-- FillHighlight (glass capsule appearance for accent fill)
	local fillHighlight = Instance.new("Frame")
	fillHighlight.Name = "FillHighlight"
	fillHighlight.Size = UDim2.new(1, 0, 0.5, 0)
	fillHighlight.Position = UDim2.new(0, 0, 0, 0)
	fillHighlight.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
	fillHighlight.BackgroundTransparency = 0.88
	fillHighlight.BorderSizePixel = 0
	fillHighlight.ZIndex = 2
	fillHighlight.Parent = fillFrame

	local fillHighlightGradient = Instance.new("UIGradient")
	fillHighlightGradient.Name = "FillHighlightGradient"
	fillHighlightGradient.Rotation = 90
	fillHighlightGradient.Transparency = NumberSequence.new({
		NumberSequenceKeypoint.new(0, 0),
		NumberSequenceKeypoint.new(1, 1),
	})
	fillHighlightGradient.Parent = fillHighlight

	-- TrackSpecularFrame (transparent, specular rim on track)
	local trackSpecularFrame = Instance.new("Frame")
	trackSpecularFrame.Name = "TrackSpecularFrame"
	trackSpecularFrame.Size = UDim2.new(1, 0, 1, 0)
	trackSpecularFrame.BackgroundTransparency = 1
	trackSpecularFrame.BorderSizePixel = 0
	trackSpecularFrame.ZIndex = 2
	trackSpecularFrame.Parent = trackSurface

	local trackSpecularCorner = Instance.new("UICorner")
	trackSpecularCorner.CornerRadius = UDim.new(0, 999)
	trackSpecularCorner.Parent = trackSpecularFrame

	local trackSpecularStroke = Instance.new("UIStroke")
	trackSpecularStroke.Name = "TrackSpecularStroke"
	trackSpecularStroke.Color = strokeColor
	trackSpecularStroke.Thickness = 1
	trackSpecularStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
	trackSpecularStroke.Parent = trackSpecularFrame

	local trackSpecularGradient = Instance.new("UIGradient")
	trackSpecularGradient.Name = "TrackSpecularGradient"
	trackSpecularGradient.Rotation = 90
	trackSpecularGradient.Transparency = NumberSequence.new({
		NumberSequenceKeypoint.new(0, fresnelStart),
		NumberSequenceKeypoint.new(fresnelMidPoint, fresnelMid),
		NumberSequenceKeypoint.new(1, fresnelEnd),
	})
	trackSpecularGradient.Parent = trackSpecularStroke

	-- Track inner edge (recessed look via Border stroke inside ClipsDescendants)
	local innerEdgeColor = resolve(nil, theme and theme.InnerEdgeColor, Color3.fromRGB(255, 255, 255)) :: Color3
	local innerEdgeTop = resolve(nil, theme and theme.InnerEdgeTopTransparency, 0.35) :: number
	local innerEdgeMid = resolve(nil, theme and theme.InnerEdgeMidTransparency, 0.72) :: number
	local innerEdgeBottom = resolve(nil, theme and theme.InnerEdgeBottomTransparency, 0.92) :: number

	local trackInnerEdgeFrame = Instance.new("Frame")
	trackInnerEdgeFrame.Name = "TrackInnerEdgeFrame"
	trackInnerEdgeFrame.Size = UDim2.new(1, 0, 1, 0)
	trackInnerEdgeFrame.BackgroundTransparency = 1
	trackInnerEdgeFrame.BorderSizePixel = 0
	trackInnerEdgeFrame.ZIndex = 3
	trackInnerEdgeFrame.Parent = trackSurface

	local trackInnerEdgeCorner = Instance.new("UICorner")
	trackInnerEdgeCorner.CornerRadius = UDim.new(0, 999)
	trackInnerEdgeCorner.Parent = trackInnerEdgeFrame

	local trackInnerEdgeStroke = Instance.new("UIStroke")
	trackInnerEdgeStroke.Name = "TrackInnerEdgeStroke"
	trackInnerEdgeStroke.Color = innerEdgeColor
	trackInnerEdgeStroke.Thickness = 1
	trackInnerEdgeStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
	trackInnerEdgeStroke.Parent = trackInnerEdgeFrame

	local trackInnerEdgeGradient = Instance.new("UIGradient")
	trackInnerEdgeGradient.Name = "TrackInnerEdgeGradient"
	trackInnerEdgeGradient.Rotation = 90
	trackInnerEdgeGradient.Transparency = NumberSequence.new({
		NumberSequenceKeypoint.new(0, innerEdgeTop + 0.20),
		NumberSequenceKeypoint.new(0.5, innerEdgeMid + 0.10),
		NumberSequenceKeypoint.new(1, innerEdgeBottom),
	})
	trackInnerEdgeGradient.Parent = trackInnerEdgeStroke

	-- ThumbContainer (positioned by value)
	local thumbContainer = Instance.new("Frame")
	thumbContainer.Name = "ThumbContainer"
	thumbContainer.Size = UDim2.new(0, 28, 0, 28)
	thumbContainer.AnchorPoint = Vector2.new(0.5, 0.5)
	thumbContainer.Position = UDim2.new(valueFraction, 0, 0.5, 0)
	thumbContainer.BackgroundTransparency = 1
	thumbContainer.BorderSizePixel = 0
	thumbContainer.ZIndex = 3
	thumbContainer.Parent = container

	-- ThumbShadow (outer, behind thumb — grows on drag)
	local thumbShadow = Instance.new("Frame")
	thumbShadow.Name = "ThumbShadow"
	thumbShadow.Size = UDim2.new(0, 30, 0, 30)
	thumbShadow.AnchorPoint = Vector2.new(0.5, 0.5)
	thumbShadow.Position = UDim2.new(0.5, 0, 0.5, 1)
	thumbShadow.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
	thumbShadow.BackgroundTransparency = 0.85
	thumbShadow.BorderSizePixel = 0
	thumbShadow.ZIndex = 0
	thumbShadow.Parent = thumbContainer

	local thumbShadowCorner = Instance.new("UICorner")
	thumbShadowCorner.CornerRadius = UDim.new(0, 999)
	thumbShadowCorner.Parent = thumbShadow

	-- ThumbSurface (28x28 circle, white — grows on drag)
	local thumbSurface = Instance.new("Frame")
	thumbSurface.Name = "ThumbSurface"
	thumbSurface.Size = UDim2.new(0, 28, 0, 28)
	thumbSurface.AnchorPoint = Vector2.new(0.5, 0.5)
	thumbSurface.Position = UDim2.new(0.5, 0, 0.5, 0)
	thumbSurface.BackgroundColor3 = thumbColor
	thumbSurface.BackgroundTransparency = 0
	thumbSurface.BorderSizePixel = 0
	thumbSurface.ZIndex = 1
	thumbSurface.Parent = thumbContainer

	local thumbSurfaceCorner = Instance.new("UICorner")
	thumbSurfaceCorner.CornerRadius = UDim.new(0, 999)
	thumbSurfaceCorner.Parent = thumbSurface

	local thumbStroke = Instance.new("UIStroke")
	thumbStroke.Color = Color3.fromRGB(200, 200, 205)
	thumbStroke.Thickness = 0.5
	thumbStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
	thumbStroke.Transparency = 0.4
	thumbStroke.Parent = thumbSurface

	-- ============================================================
	-- Drag Logic
	-- ============================================================

	-- Helper: compute value from absolute X position
	local function valueFromX(absX: number): number
		local trackLeft = container.AbsolutePosition.X
		local trackWidth = container.AbsoluteSize.X
		local fraction = math.clamp((absX - trackLeft) / trackWidth, 0, 1)
		local rawValue = minVal + fraction * (maxVal - minVal)
		if step > 0 then
			rawValue = math.round(rawValue / step) * step
		end
		return math.clamp(rawValue, minVal, maxVal)
	end

	-- Helper: update visual position from current value
	local function updateVisual()
		local fraction = if (maxVal - minVal) > 0 then (currentValue - minVal) / (maxVal - minVal) else 0
		-- Edge-snap: prevent sub-pixel rounding artifacts at 0% and 100%
		if fraction >= 0.995 then fraction = 1 end
		if fraction <= 0.005 then fraction = 0 end
		fillFrame.Size = UDim2.new(fraction, 0, 1, 0)
		thumbContainer.Position = UDim2.new(fraction, 0, 0.5, 0)
	end

	-- Helper: apply value and fire callback
	local function applyValue(newValue: number)
		local oldValue = currentValue
		currentValue = newValue
		updateVisual()
		if oldValue ~= newValue and config.OnChanged then
			config.OnChanged(newValue)
		end
	end

	-- Thumb grow on drag start
	local function growThumb()
		local growInfo = TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
		trackTween(TweenService:Create(thumbSurface, growInfo, {
			Size = UDim2.new(0, 34, 0, 34),
		})):Play()
		trackTween(TweenService:Create(thumbShadow, growInfo, {
			Size = UDim2.new(0, 38, 0, 38),
			BackgroundTransparency = 0.72,
		})):Play()
	end

	-- Thumb shrink on drag end
	local function shrinkThumb()
		local shrinkInfo = makeSmoothTweenInfo(0.3)
		trackTween(TweenService:Create(thumbSurface, shrinkInfo, {
			Size = UDim2.new(0, 28, 0, 28),
		})):Play()
		trackTween(TweenService:Create(thumbShadow, shrinkInfo, {
			Size = UDim2.new(0, 30, 0, 30),
			BackgroundTransparency = 0.85,
		})):Play()
	end

	-- Transparent hit areas for reliable input (child elements block parent InputBegan)
	local thumbHitArea = Instance.new("TextButton")
	thumbHitArea.Name = "ThumbHitArea"
	thumbHitArea.Size = UDim2.new(1, 0, 1, 0)
	thumbHitArea.BackgroundTransparency = 1
	thumbHitArea.Text = ""
	thumbHitArea.BorderSizePixel = 0
	thumbHitArea.ZIndex = 100
	thumbHitArea.AutoButtonColor = false
	thumbHitArea.Parent = thumbContainer

	local trackHitArea = Instance.new("TextButton")
	trackHitArea.Name = "TrackHitArea"
	trackHitArea.Size = UDim2.new(1, 0, 0, 16)
	trackHitArea.AnchorPoint = Vector2.new(0, 0.5)
	trackHitArea.Position = UDim2.new(0, 0, 0.5, 0)
	trackHitArea.BackgroundTransparency = 1
	trackHitArea.Text = ""
	trackHitArea.BorderSizePixel = 0
	trackHitArea.ZIndex = 50
	trackHitArea.AutoButtonColor = false
	trackHitArea.Parent = container

	-- Start drag from thumb
	local thumbInputBeganConn = thumbHitArea.InputBegan:Connect(function(input: InputObject)
		if input.UserInputType == Enum.UserInputType.MouseButton1
			or input.UserInputType == Enum.UserInputType.Touch then
			isDragging = true
			growThumb()
		end
	end)
	table.insert(connections, thumbInputBeganConn)

	-- Start drag from track (tap-to-seek)
	local trackInputBeganConn = trackHitArea.InputBegan:Connect(function(input: InputObject)
		if input.UserInputType == Enum.UserInputType.MouseButton1
			or input.UserInputType == Enum.UserInputType.Touch then
			isDragging = true
			local newValue = valueFromX(input.Position.X)
			applyValue(newValue)
			growThumb()
		end
	end)
	table.insert(connections, trackInputBeganConn)

	-- Track drag globally via UserInputService.InputChanged
	local inputChangedConn = UserInputService.InputChanged:Connect(function(input: InputObject)
		if not isDragging then
			return
		end
		if input.UserInputType == Enum.UserInputType.MouseMovement
			or input.UserInputType == Enum.UserInputType.Touch then
			local newValue = valueFromX(input.Position.X)
			applyValue(newValue)
		end
	end)
	table.insert(connections, inputChangedConn)

	-- End drag on UserInputService.InputEnded
	local inputEndedConn = UserInputService.InputEnded:Connect(function(input: InputObject)
		if input.UserInputType == Enum.UserInputType.MouseButton1
			or input.UserInputType == Enum.UserInputType.Touch then
			if isDragging then
				isDragging = false

				-- Shrink thumb back and elastic settle
				shrinkThumb()
				local fraction = if (maxVal - minVal) > 0 then (currentValue - minVal) / (maxVal - minVal) else 0
				local settleInfo = makeSmoothTweenInfo(0.25)
				local settleTween = TweenService:Create(thumbContainer, settleInfo, {
					Position = UDim2.new(fraction, 0, 0.5, 0),
				})
				trackTween(settleTween)
				settleTween:Play()
			end
		end
	end)
	table.insert(connections, inputEndedConn)

	-- ============================================================
	-- Parent Assignment
	-- ============================================================

	if config.Parent then
		container.Parent = config.Parent
	end

	-- Set initial value and visual at construction time (no animation)
	updateVisual()

	-- ============================================================
	-- Return Table
	-- ============================================================

	local self: Types.MangoSlider = {
		Container = container,
		SetValue = function(self: Types.MangoSlider, value: number)
			currentValue = math.clamp(value, minVal, maxVal)
			updateVisual()
		end,
		GetValue = function(self: Types.MangoSlider): number
			return currentValue
		end,
		Destroy = function(self: Types.MangoSlider)
			for _, conn in connections do
				conn:Disconnect()
			end
			table.clear(connections)
			cancelAllTweens()
			container:Destroy()
		end,
	}

	return self
end

return module

end

_modules["MangoCheckbox"] = function()


local Types = _require("Types")
local Themes = _require("Themes")
local resolve = Themes.resolve
local TweenService = game:GetService("TweenService")

local module = {}

function module.new(config: Types.MangoCheckboxConfig): Types.MangoCheckbox
	local theme = config.Theme

	-- Resolve config values
	local position = config.Position
	local anchorPoint = resolve(config.AnchorPoint, nil, Vector2.new(0, 0)) :: Vector2
	local initialState = resolve(config.InitialState, nil, false) :: boolean
	local labelText = config.Label

	-- Theme values
	local onColor = resolve(nil, theme and theme.CheckboxOnColor, Color3.fromRGB(0, 122, 255)) :: Color3
	local offColor = resolve(nil, theme and theme.CheckboxOffColor, Color3.fromRGB(200, 200, 205)) :: Color3
	local checkColor = resolve(nil, theme and theme.CheckboxCheckColor, Color3.fromRGB(255, 255, 255)) :: Color3
	local primaryText = resolve(nil, theme and theme.PrimaryTextColor, Color3.fromRGB(0, 0, 0)) :: Color3

	-- State
	local isChecked: boolean = initialState
	local activeTweens: {Tween} = {}
	local connections: {RBXScriptConnection} = {}

	local function cancelAllTweens()
		for _, tween in activeTweens do
			tween:Cancel()
		end
		table.clear(activeTweens)
	end

	local function trackTween(tween: Tween): Tween
		table.insert(activeTweens, tween)
		return tween
	end

	-- Container (horizontal layout)
	local container = Instance.new("Frame")
	container.Name = "MangoCheckbox"
	container.Size = UDim2.new(0, 0, 0, 24)
	container.AutomaticSize = Enum.AutomaticSize.X
	container.Position = position
	container.AnchorPoint = anchorPoint
	container.BackgroundTransparency = 1
	container.BorderSizePixel = 0

	local layout = Instance.new("UIListLayout")
	layout.FillDirection = Enum.FillDirection.Horizontal
	layout.VerticalAlignment = Enum.VerticalAlignment.Center
	layout.SortOrder = Enum.SortOrder.LayoutOrder
	layout.Padding = UDim.new(0, 8)
	layout.Parent = container

	-- CheckboxFrame (24x24)
	local checkboxFrame = Instance.new("Frame")
	checkboxFrame.Name = "CheckboxFrame"
	checkboxFrame.Size = UDim2.new(0, 24, 0, 24)
	checkboxFrame.BackgroundTransparency = 1
	checkboxFrame.BorderSizePixel = 0
	checkboxFrame.LayoutOrder = 1
	checkboxFrame.Parent = container

	-- UIStroke (border that changes color)
	local checkboxStroke = Instance.new("UIStroke")
	checkboxStroke.Name = "CheckboxStroke"
	checkboxStroke.Color = if isChecked then onColor else offColor
	checkboxStroke.Thickness = 1.5
	checkboxStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
	checkboxStroke.Parent = checkboxFrame

	local checkboxCorner = Instance.new("UICorner")
	checkboxCorner.CornerRadius = UDim.new(0, 6)
	checkboxCorner.Parent = checkboxFrame

	-- CheckFill (colored fill, uses UIScale for animation)
	local checkFill = Instance.new("Frame")
	checkFill.Name = "CheckFill"
	checkFill.Size = UDim2.new(1, 0, 1, 0)
	checkFill.BackgroundColor3 = onColor
	checkFill.BackgroundTransparency = 0
	checkFill.BorderSizePixel = 0
	checkFill.ZIndex = 1
	checkFill.Parent = checkboxFrame

	local checkFillCorner = Instance.new("UICorner")
	checkFillCorner.CornerRadius = UDim.new(0, 6)
	checkFillCorner.Parent = checkFill

	local checkFillScale = Instance.new("UIScale")
	checkFillScale.Scale = if isChecked then 1 else 0
	checkFillScale.Parent = checkFill

	-- Checkmark label
	local checkmarkLabel = Instance.new("TextLabel")
	checkmarkLabel.Name = "CheckmarkLabel"
	checkmarkLabel.Size = UDim2.new(1, 0, 1, 0)
	checkmarkLabel.BackgroundTransparency = 1
	checkmarkLabel.BorderSizePixel = 0
	checkmarkLabel.Font = Enum.Font.GothamBold
	checkmarkLabel.TextSize = 14
	checkmarkLabel.Text = "\226\156\147" -- checkmark ✓
	checkmarkLabel.TextColor3 = checkColor
	checkmarkLabel.TextTransparency = if isChecked then 0 else 1
	checkmarkLabel.TextXAlignment = Enum.TextXAlignment.Center
	checkmarkLabel.TextYAlignment = Enum.TextYAlignment.Center
	checkmarkLabel.ZIndex = 10
	checkmarkLabel.Parent = checkboxFrame

	-- HitArea
	local hitArea = Instance.new("TextButton")
	hitArea.Name = "HitArea"
	hitArea.Size = UDim2.new(1, 0, 1, 0)
	hitArea.BackgroundTransparency = 1
	hitArea.Text = ""
	hitArea.BorderSizePixel = 0
	hitArea.ZIndex = 100
	hitArea.AutoButtonColor = false
	hitArea.Parent = checkboxFrame

	-- Label text (optional)
	if labelText and labelText ~= "" then
		local label = Instance.new("TextLabel")
		label.Name = "LabelText"
		label.Size = UDim2.new(0, 0, 1, 0)
		label.AutomaticSize = Enum.AutomaticSize.X
		label.BackgroundTransparency = 1
		label.BorderSizePixel = 0
		label.Font = Enum.Font.GothamMedium
		label.TextSize = 14
		label.Text = labelText
		label.TextColor3 = primaryText
		label.TextXAlignment = Enum.TextXAlignment.Left
		label.TextYAlignment = Enum.TextYAlignment.Center
		label.LayoutOrder = 2
		label.Parent = container
	end

	-- Animation
	local function animateToState(state: boolean)
		cancelAllTweens()

		local tweenInfo = TweenInfo.new(0.2, Enum.EasingStyle.Back, Enum.EasingDirection.Out)
		local colorInfo = TweenInfo.new(0.15, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)

		-- Scale fill in/out
		local scaleTween = TweenService:Create(checkFillScale, tweenInfo, {
			Scale = if state then 1 else 0,
		})
		trackTween(scaleTween)
		scaleTween:Play()

		-- Stroke color
		local strokeTween = TweenService:Create(checkboxStroke, colorInfo, {
			Color = if state then onColor else offColor,
		})
		trackTween(strokeTween)
		strokeTween:Play()

		-- Checkmark transparency
		local checkTween = TweenService:Create(checkmarkLabel, colorInfo, {
			TextTransparency = if state then 0 else 1,
		})
		trackTween(checkTween)
		checkTween:Play()
	end

	-- Click handler
	local clickConn = hitArea.MouseButton1Click:Connect(function()
		isChecked = not isChecked
		animateToState(isChecked)
		if config.OnToggled then
			config.OnToggled(isChecked)
		end
	end)
	table.insert(connections, clickConn)

	-- Parent assignment
	if config.Parent then
		container.Parent = config.Parent
	end

	-- Return table
	local self: Types.MangoCheckbox = {
		Container = container,
		SetState = function(self: Types.MangoCheckbox, state: boolean)
			isChecked = state
			animateToState(isChecked)
		end,
		GetState = function(self: Types.MangoCheckbox): boolean
			return isChecked
		end,
		Destroy = function(self: Types.MangoCheckbox)
			cancelAllTweens()
			for _, conn in connections do
				conn:Disconnect()
			end
			table.clear(connections)
			container:Destroy()
		end,
	}

	return self
end

return module

end

_modules["MangoProgressBar"] = function()


local Types = _require("Types")
local Themes = _require("Themes")
local resolve = Themes.resolve
local TweenService = game:GetService("TweenService")

local module = {}

function module.new(config: Types.MangoProgressBarConfig): Types.MangoProgressBar
	local theme = config.Theme

	-- Resolve config values
	local size = resolve(config.Size, nil, UDim2.new(0, 200, 0, 20)) :: UDim2
	local position = config.Position
	local anchorPoint = resolve(config.AnchorPoint, nil, Vector2.new(0, 0)) :: Vector2
	local initialValue = resolve(config.InitialValue, nil, 0) :: number

	-- Theme values
	local trackColor = resolve(nil, theme and theme.SliderTrackColor, Color3.fromRGB(220, 220, 225)) :: Color3
	local trackTransparency = resolve(nil, theme and theme.ProgressBarTrackTransparency, 0.85) :: number
	local fillColor = resolve(nil, theme and theme.ProgressBarFillColor, Color3.fromRGB(0, 122, 255)) :: Color3
	local fillTransparency = resolve(nil, theme and theme.ProgressBarFillTransparency, 0.30) :: number
	local strokeColor = resolve(nil, theme and theme.StrokeColor, Color3.fromRGB(255, 255, 255)) :: Color3
	local fresnelStart = resolve(nil, theme and theme.FresnelStartTransparency, 0.25) :: number
	local fresnelMid = resolve(nil, theme and theme.FresnelMidTransparency, 0.50) :: number
	local fresnelMidPoint = resolve(nil, theme and theme.FresnelMidPoint, 0.35) :: number
	local fresnelEnd = resolve(nil, theme and theme.FresnelEndTransparency, 0.95) :: number
	local innerEdgeColor = resolve(nil, theme and theme.InnerEdgeColor, Color3.fromRGB(255, 255, 255)) :: Color3
	local innerEdgeTop = resolve(nil, theme and theme.InnerEdgeTopTransparency, 0.35) :: number
	local innerEdgeMid = resolve(nil, theme and theme.InnerEdgeMidTransparency, 0.72) :: number
	local innerEdgeBottom = resolve(nil, theme and theme.InnerEdgeBottomTransparency, 0.92) :: number
	local shadowColor = resolve(nil, theme and theme.ShadowColor, Color3.fromRGB(0, 0, 0)) :: Color3

	-- State
	local currentValue: number = math.clamp(initialValue, 0, 1)
	local activeTweens: {Tween} = {}

	local function cancelAllTweens()
		for _, tween in activeTweens do
			tween:Cancel()
		end
		table.clear(activeTweens)
	end

	local function trackTween(tween: Tween): Tween
		table.insert(activeTweens, tween)
		return tween
	end

	-- Container
	local container = Instance.new("Frame")
	container.Name = "MangoProgressBar"
	container.Size = size
	container.Position = position
	container.AnchorPoint = anchorPoint
	container.BackgroundTransparency = 1
	container.BorderSizePixel = 0

	-- Shadow layer 1 (outer)
	local shadow1 = Instance.new("Frame")
	shadow1.Name = "ShadowLayer1"
	shadow1.AnchorPoint = Vector2.new(0.5, 0.5)
	shadow1.Position = UDim2.new(0.5, 0, 0.5, 1)
	shadow1.Size = UDim2.new(1, 8, 0, 12)
	shadow1.BackgroundColor3 = shadowColor
	shadow1.BackgroundTransparency = 0.88
	shadow1.BorderSizePixel = 0
	shadow1.ZIndex = 0
	shadow1.Parent = container

	local shadow1Corner = Instance.new("UICorner")
	shadow1Corner.CornerRadius = UDim.new(0, 999)
	shadow1Corner.Parent = shadow1

	-- Shadow layer 2 (inner)
	local shadow2 = Instance.new("Frame")
	shadow2.Name = "ShadowLayer2"
	shadow2.AnchorPoint = Vector2.new(0.5, 0.5)
	shadow2.Position = UDim2.new(0.5, 0, 0.5, 0.5)
	shadow2.Size = UDim2.new(1, 4, 0, 10)
	shadow2.BackgroundColor3 = shadowColor
	shadow2.BackgroundTransparency = 0.84
	shadow2.BorderSizePixel = 0
	shadow2.ZIndex = 0
	shadow2.Parent = container

	local shadow2Corner = Instance.new("UICorner")
	shadow2Corner.CornerRadius = UDim.new(0, 999)
	shadow2Corner.Parent = shadow2

	-- TrackSurface (6px tall pill, centered vertically)
	local trackSurface = Instance.new("Frame")
	trackSurface.Name = "TrackSurface"
	trackSurface.Size = UDim2.new(1, 0, 0, 6)
	trackSurface.Position = UDim2.new(0, 0, 0.5, 0)
	trackSurface.AnchorPoint = Vector2.new(0, 0.5)
	trackSurface.BackgroundColor3 = trackColor
	trackSurface.BackgroundTransparency = trackTransparency
	trackSurface.ClipsDescendants = true
	trackSurface.BorderSizePixel = 0
	trackSurface.ZIndex = 1
	trackSurface.Parent = container

	local trackCorner = Instance.new("UICorner")
	trackCorner.CornerRadius = UDim.new(0, 999)
	trackCorner.Parent = trackSurface

	-- FillFrame (width = value fraction)
	local fillFrame = Instance.new("Frame")
	fillFrame.Name = "FillFrame"
	fillFrame.Size = UDim2.new(currentValue, 0, 1, 0)
	fillFrame.Position = UDim2.new(0, 0, 0, 0)
	fillFrame.AnchorPoint = Vector2.new(0, 0)
	fillFrame.BackgroundColor3 = fillColor
	fillFrame.BackgroundTransparency = fillTransparency
	fillFrame.BorderSizePixel = 0
	fillFrame.ZIndex = 1
	fillFrame.Parent = trackSurface

	-- FillHighlight (glass capsule appearance)
	local fillHighlight = Instance.new("Frame")
	fillHighlight.Name = "FillHighlight"
	fillHighlight.Size = UDim2.new(1, 0, 0.5, 0)
	fillHighlight.Position = UDim2.new(0, 0, 0, 0)
	fillHighlight.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
	fillHighlight.BackgroundTransparency = 0.88
	fillHighlight.BorderSizePixel = 0
	fillHighlight.ZIndex = 2
	fillHighlight.Parent = fillFrame

	local fillHighlightCorner = Instance.new("UICorner")
	fillHighlightCorner.CornerRadius = UDim.new(1, 0)
	fillHighlightCorner.Parent = fillHighlight

	local fillHighlightGradient = Instance.new("UIGradient")
	fillHighlightGradient.Name = "FillHighlightGradient"
	fillHighlightGradient.Rotation = 90
	fillHighlightGradient.Transparency = NumberSequence.new({
		NumberSequenceKeypoint.new(0, 0),
		NumberSequenceKeypoint.new(1, 1),
	})
	fillHighlightGradient.Parent = fillHighlight

	-- TrackSpecularFrame (specular rim on track)
	local trackSpecularFrame = Instance.new("Frame")
	trackSpecularFrame.Name = "TrackSpecularFrame"
	trackSpecularFrame.Size = UDim2.new(1, 0, 1, 0)
	trackSpecularFrame.BackgroundTransparency = 1
	trackSpecularFrame.BorderSizePixel = 0
	trackSpecularFrame.ZIndex = 2
	trackSpecularFrame.Parent = trackSurface

	local trackSpecularCorner = Instance.new("UICorner")
	trackSpecularCorner.CornerRadius = UDim.new(0, 999)
	trackSpecularCorner.Parent = trackSpecularFrame

	local trackSpecularStroke = Instance.new("UIStroke")
	trackSpecularStroke.Name = "TrackSpecularStroke"
	trackSpecularStroke.Color = strokeColor
	trackSpecularStroke.Thickness = 1
	trackSpecularStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
	trackSpecularStroke.Parent = trackSpecularFrame

	local trackSpecularGradient = Instance.new("UIGradient")
	trackSpecularGradient.Name = "TrackSpecularGradient"
	trackSpecularGradient.Rotation = 90
	trackSpecularGradient.Transparency = NumberSequence.new({
		NumberSequenceKeypoint.new(0, fresnelStart),
		NumberSequenceKeypoint.new(fresnelMidPoint, fresnelMid),
		NumberSequenceKeypoint.new(1, fresnelEnd),
	})
	trackSpecularGradient.Parent = trackSpecularStroke

	-- Track inner edge (recessed look via Border stroke inside ClipsDescendants)
	local trackInnerEdgeFrame = Instance.new("Frame")
	trackInnerEdgeFrame.Name = "TrackInnerEdgeFrame"
	trackInnerEdgeFrame.Size = UDim2.new(1, 0, 1, 0)
	trackInnerEdgeFrame.BackgroundTransparency = 1
	trackInnerEdgeFrame.BorderSizePixel = 0
	trackInnerEdgeFrame.ZIndex = 3
	trackInnerEdgeFrame.Parent = trackSurface

	local trackInnerEdgeCorner = Instance.new("UICorner")
	trackInnerEdgeCorner.CornerRadius = UDim.new(0, 999)
	trackInnerEdgeCorner.Parent = trackInnerEdgeFrame

	local trackInnerEdgeStroke = Instance.new("UIStroke")
	trackInnerEdgeStroke.Name = "TrackInnerEdgeStroke"
	trackInnerEdgeStroke.Color = innerEdgeColor
	trackInnerEdgeStroke.Thickness = 1
	trackInnerEdgeStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
	trackInnerEdgeStroke.Parent = trackInnerEdgeFrame

	local trackInnerEdgeGradient = Instance.new("UIGradient")
	trackInnerEdgeGradient.Name = "TrackInnerEdgeGradient"
	trackInnerEdgeGradient.Rotation = 90
	trackInnerEdgeGradient.Transparency = NumberSequence.new({
		NumberSequenceKeypoint.new(0, innerEdgeTop + 0.20),
		NumberSequenceKeypoint.new(0.5, innerEdgeMid + 0.10),
		NumberSequenceKeypoint.new(1, innerEdgeBottom),
	})
	trackInnerEdgeGradient.Parent = trackInnerEdgeStroke

	-- Parent assignment
	if config.Parent then
		container.Parent = config.Parent
	end

	-- Return table
	local self: Types.MangoProgressBar = {
		Container = container,
		SetValue = function(self: Types.MangoProgressBar, value: number)
			local clamped = math.clamp(value, 0, 1)
			currentValue = clamped
			cancelAllTweens()
			local tweenInfo = TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
			local tween = TweenService:Create(fillFrame, tweenInfo, {
				Size = UDim2.new(clamped, 0, 1, 0),
			})
			trackTween(tween)
			tween:Play()
		end,
		GetValue = function(self: Types.MangoProgressBar): number
			return currentValue
		end,
		Destroy = function(self: Types.MangoProgressBar)
			cancelAllTweens()
			container:Destroy()
		end,
	}

	return self
end

return module

end

_modules["MangoSegmentedControl"] = function()


local Types = _require("Types")
local Themes = _require("Themes")
local resolve = Themes.resolve
local TweenService = game:GetService("TweenService")

local module = {}

function module.new(config: Types.MangoSegmentedControlConfig): Types.MangoSegmentedControl
	local theme = config.Theme
	local segments = config.Segments
	local segmentCount = #segments

	-- Resolve config values
	local segmentWidth = resolve(config.SegmentWidth, nil, 90) :: number
	local height = resolve(config.Height, nil, 36) :: number
	local initialIndex = resolve(config.InitialIndex, nil, 1) :: number
	local anchorPoint = resolve(config.AnchorPoint, nil, Vector2.new(0, 0)) :: Vector2
	local position = config.Position

	-- Theme values
	local bgTransparency = resolve(nil, theme and theme.SegmentedBackgroundTransparency, 0.88) :: number
	local selectedTransparency = resolve(nil, theme and theme.SegmentedSelectedTransparency, 0.72) :: number
	local selectedColor = resolve(nil, theme and theme.SegmentedSelectedColor, Color3.fromRGB(255, 255, 255)) :: Color3
	local bgColor = resolve(nil, theme and theme.BackgroundColor3, Color3.fromRGB(255, 255, 255)) :: Color3
	local primaryText = resolve(nil, theme and theme.PrimaryTextColor, Color3.fromRGB(0, 0, 0)) :: Color3
	local secondaryText = resolve(nil, theme and theme.SecondaryTextColor, Color3.fromRGB(60, 60, 70)) :: Color3
	local strokeColor = resolve(nil, theme and theme.StrokeColor, Color3.fromRGB(255, 255, 255)) :: Color3
	local fresnelStart = resolve(nil, theme and theme.FresnelStartTransparency, 0.25) :: number
	local fresnelMid = resolve(nil, theme and theme.FresnelMidTransparency, 0.50) :: number
	local fresnelMidPoint = resolve(nil, theme and theme.FresnelMidPoint, 0.35) :: number
	local fresnelEnd = resolve(nil, theme and theme.FresnelEndTransparency, 0.95) :: number

	-- State
	local currentIndex: number = math.clamp(initialIndex, 1, segmentCount)
	local activeTweens: {Tween} = {}
	local connections: {RBXScriptConnection} = {}

	local function cancelAllTweens()
		for _, tween in activeTweens do
			tween:Cancel()
		end
		table.clear(activeTweens)
	end

	local function trackTween(tween: Tween): Tween
		table.insert(activeTweens, tween)
		return tween
	end

	-- Container (pill shape, clips descendants)
	local totalWidth = segmentWidth * segmentCount
	local container = Instance.new("Frame")
	container.Name = "MangoSegmentedControl"
	container.Size = UDim2.new(0, totalWidth, 0, height)
	container.Position = position
	container.AnchorPoint = anchorPoint
	container.BackgroundTransparency = 1
	container.BorderSizePixel = 0
	container.ClipsDescendants = true

	-- BackgroundGlass (glass tint background)
	local backgroundGlass = Instance.new("Frame")
	backgroundGlass.Name = "BackgroundGlass"
	backgroundGlass.Size = UDim2.new(1, 0, 1, 0)
	backgroundGlass.BackgroundColor3 = bgColor
	backgroundGlass.BackgroundTransparency = bgTransparency
	backgroundGlass.BorderSizePixel = 0
	backgroundGlass.ZIndex = 0
	backgroundGlass.Parent = container

	local bgCorner = Instance.new("UICorner")
	bgCorner.CornerRadius = UDim.new(0, 999)
	bgCorner.Parent = backgroundGlass

	-- SelectedIndicator (sliding glass pill)
	local selectedIndicator = Instance.new("Frame")
	selectedIndicator.Name = "SelectedIndicator"
	selectedIndicator.Size = UDim2.new(0, segmentWidth, 1, -4)
	selectedIndicator.Position = UDim2.new(0, (currentIndex - 1) * segmentWidth + 2, 0.5, 0)
	selectedIndicator.AnchorPoint = Vector2.new(0, 0.5)
	selectedIndicator.BackgroundColor3 = selectedColor
	selectedIndicator.BackgroundTransparency = selectedTransparency
	selectedIndicator.BorderSizePixel = 0
	selectedIndicator.ZIndex = 1
	selectedIndicator.Parent = container

	local indicatorCorner = Instance.new("UICorner")
	indicatorCorner.CornerRadius = UDim.new(0, 999)
	indicatorCorner.Parent = selectedIndicator

	-- Indicator specular frame
	local indicatorSpecFrame = Instance.new("Frame")
	indicatorSpecFrame.Name = "SpecularFrame"
	indicatorSpecFrame.Size = UDim2.new(1, 0, 1, 0)
	indicatorSpecFrame.BackgroundTransparency = 1
	indicatorSpecFrame.BorderSizePixel = 0
	indicatorSpecFrame.ZIndex = 2
	indicatorSpecFrame.Parent = selectedIndicator

	local indicatorSpecCorner = Instance.new("UICorner")
	indicatorSpecCorner.CornerRadius = UDim.new(0, 999)
	indicatorSpecCorner.Parent = indicatorSpecFrame

	local indicatorSpecStroke = Instance.new("UIStroke")
	indicatorSpecStroke.Name = "SpecularStroke"
	indicatorSpecStroke.Color = strokeColor
	indicatorSpecStroke.Thickness = 1
	indicatorSpecStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
	indicatorSpecStroke.Parent = indicatorSpecFrame

	local indicatorSpecGradient = Instance.new("UIGradient")
	indicatorSpecGradient.Name = "SpecularGradient"
	indicatorSpecGradient.Rotation = 90
	indicatorSpecGradient.Transparency = NumberSequence.new({
		NumberSequenceKeypoint.new(0, fresnelStart + 0.05),
		NumberSequenceKeypoint.new(fresnelMidPoint, fresnelMid + 0.05),
		NumberSequenceKeypoint.new(1, fresnelEnd),
	})
	indicatorSpecGradient.Parent = indicatorSpecStroke

	-- Segment buttons
	local segmentButtons: {TextButton} = {}
	local segmentLabels: {TextButton} = {} -- reuse for color tweening

	for i = 1, segmentCount do
		local btn = Instance.new("TextButton")
		btn.Name = "Segment" .. i
		btn.Size = UDim2.new(0, segmentWidth, 1, 0)
		btn.Position = UDim2.new(0, (i - 1) * segmentWidth, 0, 0)
		btn.BackgroundTransparency = 1
		btn.BorderSizePixel = 0
		btn.Text = segments[i]
		btn.Font = Enum.Font.GothamMedium
		btn.TextSize = 14
		btn.TextColor3 = if i == currentIndex then primaryText else secondaryText
		btn.ZIndex = 10
		btn.AutoButtonColor = false
		btn.Parent = container

		table.insert(segmentButtons, btn)
		table.insert(segmentLabels, btn)
	end

	-- Outer specular frame (rim on entire container)
	local outerSpecFrame = Instance.new("Frame")
	outerSpecFrame.Name = "OuterSpecularFrame"
	outerSpecFrame.Size = UDim2.new(1, 0, 1, 0)
	outerSpecFrame.BackgroundTransparency = 1
	outerSpecFrame.BorderSizePixel = 0
	outerSpecFrame.ZIndex = 11
	outerSpecFrame.Parent = container

	local outerSpecCorner = Instance.new("UICorner")
	outerSpecCorner.CornerRadius = UDim.new(0, 999)
	outerSpecCorner.Parent = outerSpecFrame

	local outerSpecStroke = Instance.new("UIStroke")
	outerSpecStroke.Name = "OuterSpecularStroke"
	outerSpecStroke.Color = strokeColor
	outerSpecStroke.Thickness = 1
	outerSpecStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
	outerSpecStroke.Parent = outerSpecFrame

	local outerSpecGradient = Instance.new("UIGradient")
	outerSpecGradient.Name = "OuterSpecularGradient"
	outerSpecGradient.Rotation = 90
	outerSpecGradient.Transparency = NumberSequence.new({
		NumberSequenceKeypoint.new(0, fresnelStart + 0.10),
		NumberSequenceKeypoint.new(fresnelMidPoint, fresnelMid + 0.10),
		NumberSequenceKeypoint.new(1, fresnelEnd),
	})
	outerSpecGradient.Parent = outerSpecStroke

	-- Selection logic
	local function selectIndex(index: number)
		if index < 1 or index > segmentCount then
			return
		end
		cancelAllTweens()
		currentIndex = index

		-- Slide indicator
		local slideInfo = TweenInfo.new(0.25, Enum.EasingStyle.Back, Enum.EasingDirection.Out)
		local slideTween = TweenService:Create(selectedIndicator, slideInfo, {
			Position = UDim2.new(0, (index - 1) * segmentWidth + 2, 0.5, 0),
		})
		trackTween(slideTween)
		slideTween:Play()

		-- Update text colors
		local colorInfo = TweenInfo.new(0.15, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
		for i, btn in segmentLabels do
			local targetColor = if i == index then primaryText else secondaryText
			local colorTween = TweenService:Create(btn, colorInfo, {
				TextColor3 = targetColor,
			})
			trackTween(colorTween)
			colorTween:Play()
		end
	end

	-- Wire click handlers
	for i, btn in segmentButtons do
		local conn = btn.MouseButton1Click:Connect(function()
			if currentIndex ~= i then
				selectIndex(i)
				if config.OnChanged then
					config.OnChanged(i)
				end
			end
		end)
		table.insert(connections, conn)
	end

	-- Parent assignment
	if config.Parent then
		container.Parent = config.Parent
	end

	-- Return table
	local self: Types.MangoSegmentedControl = {
		Container = container,
		SetIndex = function(self: Types.MangoSegmentedControl, index: number)
			selectIndex(index)
		end,
		GetIndex = function(self: Types.MangoSegmentedControl): number
			return currentIndex
		end,
		Destroy = function(self: Types.MangoSegmentedControl)
			cancelAllTweens()
			for _, conn in connections do
				conn:Disconnect()
			end
			table.clear(connections)
			container:Destroy()
		end,
	}

	return self
end

return module

end

_modules["MangoSearchBar"] = function()


local Types = _require("Types")
local Themes = _require("Themes")
local MangoGlassFrame = _require("MangoGlassFrame")
local resolve = Themes.resolve
local TweenService = game:GetService("TweenService")

local module = {}

function module.new(config: Types.MangoSearchBarConfig): Types.MangoSearchBar
	local theme = config.Theme

	-- Resolve config values
	local size = resolve(config.Size, nil, UDim2.new(0, 280, 0, 36)) :: UDim2
	local position = config.Position
	local anchorPoint = resolve(config.AnchorPoint, nil, Vector2.new(0, 0)) :: Vector2
	local placeholder = resolve(config.Placeholder, nil, "Search") :: string

	-- Theme values
	local primaryText = resolve(nil, theme and theme.PrimaryTextColor, Color3.fromRGB(0, 0, 0)) :: Color3
	local placeholderColor = resolve(nil, theme and theme.SearchBarPlaceholderColor, Color3.fromRGB(142, 142, 147)) :: Color3
	local bgTransparency = resolve(nil, theme and theme.SearchBarBackgroundTransparency, 0.88) :: number

	-- State
	local activeTweens: {Tween} = {}
	local connections: {RBXScriptConnection} = {}

	local function cancelAllTweens()
		for _, tween in activeTweens do
			tween:Cancel()
		end
		table.clear(activeTweens)
	end

	local function trackTween(tween: Tween): Tween
		table.insert(activeTweens, tween)
		return tween
	end

	-- Container via MangoGlassFrame (pill, LightweightMode)
	local glassFrame = MangoGlassFrame.new({
		Size = size,
		Position = position,
		AnchorPoint = anchorPoint,
		CornerRadius = UDim.new(0, 999),
		BackgroundTransparency = bgTransparency,
		Theme = theme,
		ShadowEnabled = true,
		ShadowLayerCount = 2,
		ShadowSpread = 4,
		ShadowOffsetY = 1,
		LightweightMode = true,
	})

	local container = glassFrame.Container
	local glassSurface = glassFrame.GlassSurface

	-- UIPadding inside GlassSurface
	local padding = Instance.new("UIPadding")
	padding.PaddingLeft = UDim.new(0, 10)
	padding.PaddingRight = UDim.new(0, 10)
	padding.Parent = glassSurface

	-- Search icon (left side)
	local searchIcon = Instance.new("TextLabel")
	searchIcon.Name = "SearchIcon"
	searchIcon.Size = UDim2.new(0, 20, 0, 20)
	searchIcon.Position = UDim2.new(0, 0, 0.5, 0)
	searchIcon.AnchorPoint = Vector2.new(0, 0.5)
	searchIcon.BackgroundTransparency = 1
	searchIcon.BorderSizePixel = 0
	searchIcon.Font = Enum.Font.Gotham
	searchIcon.TextSize = 16
	searchIcon.Text = "\240\159\148\141" -- magnifying glass emoji
	searchIcon.TextColor3 = placeholderColor
	searchIcon.ZIndex = 10
	searchIcon.Parent = glassSurface

	-- InputBox (fills remaining width between icon and clear button)
	local inputBox = Instance.new("TextBox")
	inputBox.Name = "InputBox"
	inputBox.Size = UDim2.new(1, -48, 1, 0)
	inputBox.Position = UDim2.new(0, 24, 0, 0)
	inputBox.BackgroundTransparency = 1
	inputBox.BorderSizePixel = 0
	inputBox.Font = Enum.Font.GothamMedium
	inputBox.TextSize = 14
	inputBox.TextColor3 = primaryText
	inputBox.PlaceholderText = placeholder
	inputBox.PlaceholderColor3 = placeholderColor
	inputBox.Text = ""
	inputBox.ClearTextOnFocus = false
	inputBox.TextXAlignment = Enum.TextXAlignment.Left
	inputBox.ZIndex = 10
	inputBox.Parent = glassSurface

	-- Clear button (right side, visible when text is not empty)
	local clearFrame = Instance.new("Frame")
	clearFrame.Name = "ClearFrame"
	clearFrame.Size = UDim2.new(0, 20, 0, 20)
	clearFrame.Position = UDim2.new(1, -4, 0.5, 0)
	clearFrame.AnchorPoint = Vector2.new(1, 0.5)
	clearFrame.BackgroundTransparency = 1
	clearFrame.BorderSizePixel = 0
	clearFrame.Visible = false
	clearFrame.ZIndex = 10
	clearFrame.Parent = glassSurface

	local clearLabel = Instance.new("TextLabel")
	clearLabel.Name = "ClearLabel"
	clearLabel.Size = UDim2.new(1, 0, 1, 0)
	clearLabel.BackgroundTransparency = 1
	clearLabel.BorderSizePixel = 0
	clearLabel.Font = Enum.Font.GothamBold
	clearLabel.TextSize = 14
	clearLabel.Text = "\226\156\149" -- ✕
	clearLabel.TextColor3 = placeholderColor
	clearLabel.ZIndex = 10
	clearLabel.Parent = clearFrame

	local clearHitArea = Instance.new("TextButton")
	clearHitArea.Name = "HitArea"
	clearHitArea.Size = UDim2.new(1, 8, 1, 8)
	clearHitArea.AnchorPoint = Vector2.new(0.5, 0.5)
	clearHitArea.Position = UDim2.new(0.5, 0, 0.5, 0)
	clearHitArea.BackgroundTransparency = 1
	clearHitArea.Text = ""
	clearHitArea.BorderSizePixel = 0
	clearHitArea.ZIndex = 100
	clearHitArea.AutoButtonColor = false
	clearHitArea.Parent = clearFrame

	-- Focus animation
	local originalBgTransparency = glassSurface.BackgroundTransparency

	local focusedConn = inputBox.Focused:Connect(function()
		cancelAllTweens()
		local tweenInfo = TweenInfo.new(0.15, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
		local tween = TweenService:Create(glassSurface, tweenInfo, {
			BackgroundTransparency = math.clamp(originalBgTransparency - 0.05, 0, 1),
		})
		trackTween(tween)
		tween:Play()
	end)
	table.insert(connections, focusedConn)

	local focusLostConn = inputBox.FocusLost:Connect(function(enterPressed: boolean)
		cancelAllTweens()
		local tweenInfo = TweenInfo.new(0.15, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
		local tween = TweenService:Create(glassSurface, tweenInfo, {
			BackgroundTransparency = originalBgTransparency,
		})
		trackTween(tween)
		tween:Play()

		if config.OnSubmit then
			config.OnSubmit(inputBox.Text)
		end
	end)
	table.insert(connections, focusLostConn)

	-- Text changed: show/hide clear button, fire callback
	local textChangedConn = inputBox:GetPropertyChangedSignal("Text"):Connect(function()
		clearFrame.Visible = inputBox.Text ~= ""
		if config.OnTextChanged then
			config.OnTextChanged(inputBox.Text)
		end
	end)
	table.insert(connections, textChangedConn)

	-- Clear button click
	local clearConn = clearHitArea.MouseButton1Click:Connect(function()
		inputBox.Text = ""
		if config.OnTextChanged then
			config.OnTextChanged("")
		end
		inputBox:CaptureFocus()
	end)
	table.insert(connections, clearConn)

	-- Parent assignment
	if config.Parent then
		container.Parent = config.Parent
	end

	-- Return table
	local self: Types.MangoSearchBar = {
		Container = container,
		GetText = function(self: Types.MangoSearchBar): string
			return inputBox.Text
		end,
		SetText = function(self: Types.MangoSearchBar, text: string)
			inputBox.Text = text
		end,
		Focus = function(self: Types.MangoSearchBar)
			inputBox:CaptureFocus()
		end,
		Destroy = function(self: Types.MangoSearchBar)
			cancelAllTweens()
			for _, conn in connections do
				conn:Disconnect()
			end
			table.clear(connections)
			glassFrame:Destroy()
		end,
	}

	return self
end

return module

end

_modules["MangoTextField"] = function()


local Types = _require("Types")
local Themes = _require("Themes")
local resolve = Themes.resolve
local TweenService = game:GetService("TweenService")

local module = {}

function module.new(config: Types.MangoTextFieldConfig): Types.MangoTextField
	local theme = config.Theme

	-- Resolve config values
	local size = resolve(config.Size, nil, UDim2.new(0, 280, 0, 40)) :: UDim2
	local position = config.Position
	local anchorPoint = resolve(config.AnchorPoint, nil, Vector2.new(0, 0)) :: Vector2
	local placeholder = resolve(config.Placeholder, nil, "") :: string
	local initialText = resolve(config.InitialText, nil, "") :: string

	-- Theme values
	local primaryText = resolve(nil, theme and theme.PrimaryTextColor, Color3.fromRGB(0, 0, 0)) :: Color3
	local secondaryText = resolve(nil, theme and theme.SecondaryTextColor, Color3.fromRGB(60, 60, 70)) :: Color3
	local bgColor = resolve(nil, theme and theme.BackgroundColor3, Color3.fromRGB(255, 255, 255)) :: Color3
	local bgTransparency = resolve(nil, theme and theme.TextFieldBackgroundTransparency, 0.92) :: number
	local borderColor = resolve(nil, theme and theme.TextFieldBorderColor, Color3.fromRGB(200, 200, 205)) :: Color3
	local focusBorderColor = resolve(nil, theme and theme.TextFieldFocusBorderColor, Color3.fromRGB(0, 122, 255)) :: Color3
	local shadowColor = resolve(nil, theme and theme.ShadowColor, Color3.fromRGB(0, 0, 0)) :: Color3

	-- State
	local activeTweens: {Tween} = {}
	local connections: {RBXScriptConnection} = {}

	local function cancelAllTweens()
		for _, tween in activeTweens do
			tween:Cancel()
		end
		table.clear(activeTweens)
	end

	local function trackTween(tween: Tween): Tween
		table.insert(activeTweens, tween)
		return tween
	end

	-- Container
	local container = Instance.new("Frame")
	container.Name = "MangoTextField"
	container.Size = size
	container.Position = position
	container.AnchorPoint = anchorPoint
	container.BackgroundTransparency = 1
	container.BorderSizePixel = 0

	-- Shadow layer 1 (outer)
	local shadow1 = Instance.new("Frame")
	shadow1.Name = "ShadowLayer1"
	shadow1.AnchorPoint = Vector2.new(0.5, 0.5)
	shadow1.Position = UDim2.new(0.5, 0, 0.5, 1)
	shadow1.Size = UDim2.new(1, 8, 1, 8)
	shadow1.BackgroundColor3 = shadowColor
	shadow1.BackgroundTransparency = 0.92
	shadow1.BorderSizePixel = 0
	shadow1.ZIndex = 0
	shadow1.Parent = container

	local shadow1Corner = Instance.new("UICorner")
	shadow1Corner.CornerRadius = UDim.new(0, 12)
	shadow1Corner.Parent = shadow1

	-- Shadow layer 2 (inner)
	local shadow2 = Instance.new("Frame")
	shadow2.Name = "ShadowLayer2"
	shadow2.AnchorPoint = Vector2.new(0.5, 0.5)
	shadow2.Position = UDim2.new(0.5, 0, 0.5, 0.5)
	shadow2.Size = UDim2.new(1, 4, 1, 4)
	shadow2.BackgroundColor3 = shadowColor
	shadow2.BackgroundTransparency = 0.88
	shadow2.BorderSizePixel = 0
	shadow2.ZIndex = 0
	shadow2.Parent = container

	local shadow2Corner = Instance.new("UICorner")
	shadow2Corner.CornerRadius = UDim.new(0, 11)
	shadow2Corner.Parent = shadow2

	-- FieldFrame (rounded rectangle)
	local fieldFrame = Instance.new("Frame")
	fieldFrame.Name = "FieldFrame"
	fieldFrame.Size = UDim2.new(1, 0, 1, 0)
	fieldFrame.BackgroundColor3 = bgColor
	fieldFrame.BackgroundTransparency = bgTransparency
	fieldFrame.BorderSizePixel = 0
	fieldFrame.ZIndex = 1
	fieldFrame.ClipsDescendants = true
	fieldFrame.Parent = container

	local fieldCorner = Instance.new("UICorner")
	fieldCorner.CornerRadius = UDim.new(0, 10)
	fieldCorner.Parent = fieldFrame

	-- UIStroke (border)
	local fieldStroke = Instance.new("UIStroke")
	fieldStroke.Name = "FieldStroke"
	fieldStroke.Color = borderColor
	fieldStroke.Thickness = 1
	fieldStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
	fieldStroke.Parent = fieldFrame

	-- UIPadding
	local fieldPadding = Instance.new("UIPadding")
	fieldPadding.PaddingLeft = UDim.new(0, 12)
	fieldPadding.PaddingRight = UDim.new(0, 12)
	fieldPadding.Parent = fieldFrame

	-- InputBox
	local inputBox = Instance.new("TextBox")
	inputBox.Name = "InputBox"
	inputBox.Size = UDim2.new(1, -20, 1, 0)
	inputBox.Position = UDim2.new(0, 0, 0, 0)
	inputBox.BackgroundTransparency = 1
	inputBox.BorderSizePixel = 0
	inputBox.Font = Enum.Font.GothamMedium
	inputBox.TextSize = 14
	inputBox.TextColor3 = primaryText
	inputBox.PlaceholderText = placeholder
	inputBox.PlaceholderColor3 = secondaryText
	inputBox.Text = initialText
	inputBox.ClearTextOnFocus = false
	inputBox.TextXAlignment = Enum.TextXAlignment.Left
	inputBox.ZIndex = 10
	inputBox.Parent = fieldFrame

	-- Clear button (right side, visible when text is not empty)
	local clearFrame = Instance.new("Frame")
	clearFrame.Name = "ClearFrame"
	clearFrame.Size = UDim2.new(0, 16, 0, 16)
	clearFrame.Position = UDim2.new(1, -4, 0.5, 0)
	clearFrame.AnchorPoint = Vector2.new(1, 0.5)
	clearFrame.BackgroundTransparency = 1
	clearFrame.BorderSizePixel = 0
	clearFrame.Visible = initialText ~= ""
	clearFrame.ZIndex = 10
	clearFrame.Parent = fieldFrame

	local clearLabel = Instance.new("TextLabel")
	clearLabel.Name = "ClearLabel"
	clearLabel.Size = UDim2.new(1, 0, 1, 0)
	clearLabel.BackgroundTransparency = 1
	clearLabel.BorderSizePixel = 0
	clearLabel.Font = Enum.Font.GothamBold
	clearLabel.TextSize = 12
	clearLabel.Text = "\226\156\149" -- ✕
	clearLabel.TextColor3 = secondaryText
	clearLabel.ZIndex = 10
	clearLabel.Parent = clearFrame

	local clearHitArea = Instance.new("TextButton")
	clearHitArea.Name = "HitArea"
	clearHitArea.Size = UDim2.new(1, 8, 1, 8)
	clearHitArea.AnchorPoint = Vector2.new(0.5, 0.5)
	clearHitArea.Position = UDim2.new(0.5, 0, 0.5, 0)
	clearHitArea.BackgroundTransparency = 1
	clearHitArea.Text = ""
	clearHitArea.BorderSizePixel = 0
	clearHitArea.ZIndex = 100
	clearHitArea.AutoButtonColor = false
	clearHitArea.Parent = clearFrame

	-- Focus: animate UIStroke color
	local focusedConn = inputBox.Focused:Connect(function()
		cancelAllTweens()
		local tweenInfo = TweenInfo.new(0.15, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
		local tween = TweenService:Create(fieldStroke, tweenInfo, {
			Color = focusBorderColor,
		})
		trackTween(tween)
		tween:Play()
	end)
	table.insert(connections, focusedConn)

	local focusLostConn = inputBox.FocusLost:Connect(function(enterPressed: boolean)
		cancelAllTweens()
		local tweenInfo = TweenInfo.new(0.15, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
		local tween = TweenService:Create(fieldStroke, tweenInfo, {
			Color = borderColor,
		})
		trackTween(tween)
		tween:Play()

		if config.OnFocusLost then
			config.OnFocusLost(inputBox.Text, enterPressed)
		end
	end)
	table.insert(connections, focusLostConn)

	-- Text changed: show/hide clear button, fire callback
	local textChangedConn = inputBox:GetPropertyChangedSignal("Text"):Connect(function()
		clearFrame.Visible = inputBox.Text ~= ""
		if config.OnTextChanged then
			config.OnTextChanged(inputBox.Text)
		end
	end)
	table.insert(connections, textChangedConn)

	-- Clear button click
	local clearConn = clearHitArea.MouseButton1Click:Connect(function()
		inputBox.Text = ""
		if config.OnTextChanged then
			config.OnTextChanged("")
		end
		inputBox:CaptureFocus()
	end)
	table.insert(connections, clearConn)

	-- Parent assignment
	if config.Parent then
		container.Parent = config.Parent
	end

	-- Return table
	local self: Types.MangoTextField = {
		Container = container,
		GetText = function(self: Types.MangoTextField): string
			return inputBox.Text
		end,
		SetText = function(self: Types.MangoTextField, text: string)
			inputBox.Text = text
		end,
		Focus = function(self: Types.MangoTextField)
			inputBox:CaptureFocus()
		end,
		Destroy = function(self: Types.MangoTextField)
			cancelAllTweens()
			for _, conn in connections do
				conn:Disconnect()
			end
			table.clear(connections)
			container:Destroy()
		end,
	}

	return self
end

return module

end

_modules["MangoEnvironmentLight"] = function()


local Types = _require("Types")
local Themes = _require("Themes")
local resolve = Themes.resolve

local RunService = game:GetService("RunService")
local Lighting = game:GetService("Lighting")
local Workspace = game:GetService("Workspace")

local module = {}

type RegisteredFrame = {
	frame: Types.MangoGlassFrame,
	originalColor: Color3,
	originalSpecularColor: Color3?,
}

function module.new(config: Types.MangoEnvironmentLightConfig?): Types.MangoEnvironmentLight
	local cfg = config or {} :: Types.MangoEnvironmentLightConfig

	local updateAngleEveryFrame = resolve(cfg.UpdateAngleEveryFrame, nil, true) :: boolean
	local tintUpdateInterval = resolve(cfg.TintUpdateInterval, nil, 0.5) :: number
	local tintInfluence = resolve(cfg.TintInfluence, nil, 0.45) :: number
	local enabled = resolve(cfg.Enabled, nil, true) :: boolean

	local registeredFrames: {RegisteredFrame} = {}
	local renderStepName = "MangoEnvLight_" .. tostring(math.random(100000, 999999))
	local lastTintUpdate: number = 0
	local currentSunAngle: number = 90
	local currentTint: Color3 = Color3.new(1, 1, 1)
	local lastAppliedAngle: number = -999

	-- Compute the sun/moon direction projected into screen-space gradient angle
	local function computeSunAngle(): number
		local camera = Workspace.CurrentCamera
		if not camera then
			return 90
		end

		local sunDir = Lighting:GetSunDirection()
		-- If sun is below horizon, try moon
		if sunDir.Y < -0.1 then
			sunDir = Lighting:GetMoonDirection()
		end

		-- Project into camera local space
		local localDir = camera.CFrame:VectorToObjectSpace(sunDir)
		-- Convert to gradient rotation angle
		-- localDir.X = right, localDir.Y = up
		local angle = (math.deg(math.atan2(-localDir.Y, localDir.X)) + 90) % 360
		return angle
	end

	-- Sample ambient/outdoor lighting for glass tint
	local function computeEnvironmentTint(): Color3
		local outdoor = Lighting.OutdoorAmbient
		local ambient = Lighting.Ambient
		local colorShiftTop = Lighting.ColorShift_Top

		-- Weighted blend: OutdoorAmbient * 0.5 + Ambient * 0.2 + ColorShift_Top * 0.3
		local r = outdoor.R * 0.5 + ambient.R * 0.2 + colorShiftTop.R * 0.3
		local g = outdoor.G * 0.5 + ambient.G * 0.2 + colorShiftTop.G * 0.3
		local b = outdoor.B * 0.5 + ambient.B * 0.2 + colorShiftTop.B * 0.3

		return Color3.new(math.clamp(r, 0, 1), math.clamp(g, 0, 1), math.clamp(b, 0, 1))
	end

	-- Apply tint to registered frames
	local function applyTint(tint: Color3)
		for _, entry in registeredFrames do
			local original = entry.originalColor
			local tinted = original:Lerp(tint, tintInfluence)
			entry.frame.GlassSurface.BackgroundColor3 = tinted
			-- Tint specular stroke at half influence
			local origSpecular = entry.originalSpecularColor
			if origSpecular then
				entry.frame.SpecularStroke.Color = origSpecular:Lerp(tint, tintInfluence * 0.5)
			end
		end
	end

	-- Main update function bound to RenderStep
	local function onRenderStep(_dt: number)
		if not enabled then
			return
		end

		-- Update sun angle every frame (or skip if disabled)
		if updateAngleEveryFrame then
			currentSunAngle = computeSunAngle()

			-- Only apply if angle changed significantly (caching threshold)
			if math.abs(currentSunAngle - lastAppliedAngle) >= 0.1 then
				lastAppliedAngle = currentSunAngle
				-- Update all registered frames' gradient rotations
				for _, entry in registeredFrames do
					entry.frame:SetLightDirection(currentSunAngle)
				end
			end
		end

		-- Throttle tint updates
		local now = tick()
		if now - lastTintUpdate >= tintUpdateInterval then
			lastTintUpdate = now
			currentTint = computeEnvironmentTint()
			applyTint(currentTint)
		end
	end

	-- Start the render step binding
	local function startBinding()
		pcall(function()
			RunService:UnbindFromRenderStep(renderStepName)
		end)
		RunService:BindToRenderStep(renderStepName, Enum.RenderPriority.Camera.Value + 2, onRenderStep)
	end

	-- Stop the render step binding
	local function stopBinding()
		pcall(function()
			RunService:UnbindFromRenderStep(renderStepName)
		end)
	end

	if enabled then
		startBinding()
	end

	local self: Types.MangoEnvironmentLight = {
		Enable = function(self: Types.MangoEnvironmentLight)
			if not enabled then
				enabled = true
				startBinding()
			end
		end,
		Disable = function(self: Types.MangoEnvironmentLight)
			if enabled then
				enabled = false
				stopBinding()
				-- Restore original colors
				for _, entry in registeredFrames do
					entry.frame.GlassSurface.BackgroundColor3 = entry.originalColor
					if entry.originalSpecularColor then
						entry.frame.SpecularStroke.Color = entry.originalSpecularColor
					end
				end
			end
		end,
		IsEnabled = function(self: Types.MangoEnvironmentLight): boolean
			return enabled
		end,
		GetSunAngle = function(self: Types.MangoEnvironmentLight): number
			return currentSunAngle
		end,
		GetEnvironmentTint = function(self: Types.MangoEnvironmentLight): Color3
			return currentTint
		end,
		RegisterGlassFrame = function(self: Types.MangoEnvironmentLight, frame: Types.MangoGlassFrame)
			-- Check if already registered
			for _, entry in registeredFrames do
				if entry.frame == frame then
					return
				end
			end
			table.insert(registeredFrames, {
				frame = frame,
				originalColor = frame.GlassSurface.BackgroundColor3,
				originalSpecularColor = frame.SpecularStroke.Color,
			})
		end,
		UnregisterGlassFrame = function(self: Types.MangoEnvironmentLight, frame: Types.MangoGlassFrame)
			for i, entry in registeredFrames do
				if entry.frame == frame then
					-- Restore original colors
					entry.frame.GlassSurface.BackgroundColor3 = entry.originalColor
					if entry.originalSpecularColor then
						entry.frame.SpecularStroke.Color = entry.originalSpecularColor
					end
					table.remove(registeredFrames, i)
					return
				end
			end
		end,
		Destroy = function(self: Types.MangoEnvironmentLight)
			enabled = false
			stopBinding()
			-- Restore original colors
			for _, entry in registeredFrames do
				entry.frame.GlassSurface.BackgroundColor3 = entry.originalColor
				if entry.originalSpecularColor then
					entry.frame.SpecularStroke.Color = entry.originalSpecularColor
				end
			end
			table.clear(registeredFrames)
		end,
	}

	return self
end

return module

end

_modules["MangoButton"] = function()


local Types = _require("Types")
local Themes = _require("Themes")
local MangoGlassFrame = _require("MangoGlassFrame")
local resolve = Themes.resolve
local TweenService = game:GetService("TweenService")
local TextService = game:GetService("TextService")

local module = {}

function module.new(config: Types.MangoButtonConfig): Types.MangoButton
	local theme = config.Theme

	-- Resolve config values with nil-safe helper
	local textSize = resolve(config.TextSize, nil, 16) :: number
	local font = Enum.Font.GothamBold
	local text = config.Text

	-- Button-specific opacity: more opaque than panels for readability
	local buttonTransparency = resolve(config.BackgroundTransparency, theme and theme.ButtonBackgroundTransparency, 0.65) :: number

	-- Auto-size: measure text and add padding if no explicit Size given
	local size: UDim2
	if config.Size then
		size = config.Size
	else
		local textBounds = TextService:GetTextSize(text, textSize, font, Vector2.new(1000, 1000))
		size = UDim2.new(0, textBounds.X + 28, 0, textBounds.Y + 20)
	end

	-- Create MangoGlassFrame with pill shape (CornerRadius = 999)
	-- Button-specific shadow: tighter spread + offset to avoid boxy look on small pills
	local glassFrame = MangoGlassFrame.new({
		Size = size,
		Position = config.Position,
		AnchorPoint = resolve(config.AnchorPoint, nil, Vector2.new(0, 0)) :: Vector2,
		CornerRadius = UDim.new(0, 999),
		BackgroundTransparency = buttonTransparency,
		Theme = config.Theme,
		ShadowEnabled = true,
		ShadowLayerCount = 2,
		ShadowSpread = 5,
		ShadowOffsetY = 1,
		LightweightMode = true,
		Parent = config.Parent,
	})

	-- UIScale on Container for press animation
	local uiScale = Instance.new("UIScale")
	uiScale.Scale = 1
	uiScale.Parent = glassFrame.Container

	-- Directional specular on buttons — softer fresnel for small pills, responds to light direction
	local fresnelStart = resolve(nil, theme and theme.FresnelStartTransparency, 0.25) :: number
	local fresnelMid = resolve(nil, theme and theme.FresnelMidTransparency, 0.50) :: number
	local fresnelMidPoint = resolve(nil, theme and theme.FresnelMidPoint, 0.35) :: number
	local fresnelEnd = resolve(nil, theme and theme.FresnelEndTransparency, 0.95) :: number
	glassFrame.SpecularGradient.Transparency = NumberSequence.new({
		NumberSequenceKeypoint.new(0, fresnelStart + 0.05),
		NumberSequenceKeypoint.new(fresnelMidPoint, fresnelMid + 0.05),
		NumberSequenceKeypoint.new(1, fresnelEnd),
	})

	-- TextLabel inside GlassSurface
	local textColor = resolve(nil, theme and theme.PrimaryTextColor, Color3.fromRGB(0, 0, 0)) :: Color3

	local textLabel = Instance.new("TextLabel")
	textLabel.Name = "ButtonText"
	textLabel.Text = text
	textLabel.Font = font
	textLabel.TextSize = textSize
	textLabel.TextColor3 = textColor
	textLabel.BackgroundTransparency = 1
	textLabel.Size = UDim2.new(1, 0, 1, 0)
	textLabel.TextXAlignment = Enum.TextXAlignment.Center
	textLabel.TextYAlignment = Enum.TextYAlignment.Center
	textLabel.BorderSizePixel = 0
	textLabel.ZIndex = 10
	textLabel.Parent = glassFrame.GlassSurface

	-- Transparent TextButton hit area on top of all glass layers for reliable input
	local hitArea = Instance.new("TextButton")
	hitArea.Name = "HitArea"
	hitArea.Size = UDim2.new(1, 0, 1, 0)
	hitArea.BackgroundTransparency = 1
	hitArea.Text = ""
	hitArea.BorderSizePixel = 0
	hitArea.ZIndex = 100
	hitArea.AutoButtonColor = false
	hitArea.Parent = glassFrame.GlassSurface

	-- Press animation
	local pressScale = resolve(nil, theme and theme.ButtonPressScale, 0.97) :: number
	local originalBgTransparency = glassFrame.GlassSurface.BackgroundTransparency
	local activeTweens: {Tween} = {}

	local function cancelAllTweens()
		for _, tween in activeTweens do
			tween:Cancel()
		end
		table.clear(activeTweens)
	end

	local function trackTween(tween: Tween): Tween
		table.insert(activeTweens, tween)
		return tween
	end

	local connections: {RBXScriptConnection} = {}
	local isHovering = false

	-- Hover animation: subtle scale-up + specular gradient shift on mouse enter
	local hoverEnterConn = hitArea.MouseEnter:Connect(function()
		isHovering = true
		cancelAllTweens()
		local tweenInfo = TweenInfo.new(0.25, Enum.EasingStyle.Quint, Enum.EasingDirection.Out)
		local scaleTween = TweenService:Create(uiScale, tweenInfo, { Scale = 1.02 })
		trackTween(scaleTween)
		scaleTween:Play()
		local gradientTween = TweenService:Create(glassFrame.SpecularGradient, tweenInfo, {
			Offset = Vector2.new(0.02, 0.02),
		})
		trackTween(gradientTween)
		gradientTween:Play()
	end)
	table.insert(connections, hoverEnterConn)

	local hoverLeaveConn = hitArea.MouseLeave:Connect(function()
		isHovering = false
		cancelAllTweens()
		local tweenInfo = TweenInfo.new(0.25, Enum.EasingStyle.Quint, Enum.EasingDirection.Out)
		local scaleTween = TweenService:Create(uiScale, tweenInfo, { Scale = 1 })
		trackTween(scaleTween)
		scaleTween:Play()
		local gradientTween = TweenService:Create(glassFrame.SpecularGradient, tweenInfo, {
			Offset = Vector2.new(0, 0),
		})
		trackTween(gradientTween)
		gradientTween:Play()
	end)
	table.insert(connections, hoverLeaveConn)

	local pressConn = hitArea.MouseButton1Down:Connect(function()
		cancelAllTweens()
		local tweenInfo = TweenInfo.new(0.1, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
		local tween = TweenService:Create(uiScale, tweenInfo, { Scale = pressScale })
		trackTween(tween)
		tween:Play()
		-- Opacity pulse: glass becomes more opaque on press
		local opacityTween = TweenService:Create(glassFrame.GlassSurface, tweenInfo, {
			BackgroundTransparency = math.clamp(originalBgTransparency - 0.04, 0, 1),
		})
		trackTween(opacityTween)
		opacityTween:Play()
	end)
	table.insert(connections, pressConn)

	local releaseConn = hitArea.MouseButton1Up:Connect(function()
		cancelAllTweens()
		local tweenInfo = TweenInfo.new(0.25, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
		-- Restore to hover scale if still hovering, otherwise back to 1.0
		local restoreScale = if isHovering then 1.02 else 1
		local tween = TweenService:Create(uiScale, tweenInfo, { Scale = restoreScale })
		trackTween(tween)
		tween:Play()
		-- Restore opacity
		local opacityTween = TweenService:Create(glassFrame.GlassSurface, tweenInfo, {
			BackgroundTransparency = originalBgTransparency,
		})
		trackTween(opacityTween)
		opacityTween:Play()
		-- Restore specular offset to hover state if still hovering
		local gradientOffset = if isHovering then Vector2.new(0.02, 0.02) else Vector2.new(0, 0)
		local gradientTween = TweenService:Create(glassFrame.SpecularGradient, tweenInfo, {
			Offset = gradientOffset,
		})
		trackTween(gradientTween)
		gradientTween:Play()
		if config.OnActivated then
			config.OnActivated()
		end
	end)
	table.insert(connections, releaseConn)

	-- Return typed table
	local self: Types.MangoButton = {
		Container = glassFrame.Container,
		GlassSurface = glassFrame.GlassSurface,
		TextLabel = textLabel,
		SetText = function(self: Types.MangoButton, newText: string)
			textLabel.Text = newText
		end,
		Destroy = function(self: Types.MangoButton)
			cancelAllTweens()
			for _, conn in connections do
				conn:Disconnect()
			end
			table.clear(connections)
			glassFrame:Destroy()
		end,
	}

	return self
end

return module

end

_modules["MangoNotification"] = function()


local Types = _require("Types")
local Themes = _require("Themes")
local MangoGlassFrame = _require("MangoGlassFrame")
local resolve = Themes.resolve
local TweenService = game:GetService("TweenService")
local TextService = game:GetService("TextService")
local Players = game:GetService("Players")

local module = {}

function module.new(config: Types.MangoNotificationConfig): Types.MangoNotification
	local theme = config.Theme
	local title = config.Title
	local body = config.Body
	local icon = config.Icon
	local duration = resolve(config.Duration, nil, 5) :: number

	-- Theme-driven visual properties
	local primaryTextColor = resolve(nil, theme and theme.PrimaryTextColor, Color3.fromRGB(0, 0, 0)) :: Color3
	local secondaryTextColor = resolve(nil, theme and theme.SecondaryTextColor, Color3.fromRGB(60, 60, 70)) :: Color3

	-- Measure text to calculate height
	local titleFont = Enum.Font.GothamBold
	local bodyFont = Enum.Font.Gotham
	local titleSize = 15
	local bodySize = 13
	local contentWidth = 380 - 28 -- 14px padding on each side
	local hasIcon = icon ~= nil and icon ~= ""
	if hasIcon then
		contentWidth = contentWidth - 48 -- 36px icon + 12px gap
	end

	local titleBounds = TextService:GetTextSize(title, titleSize, titleFont, Vector2.new(contentWidth, 1000))
	local totalHeight = 28 + titleBounds.Y -- 14px top + 14px bottom padding

	local bodyBounds: Vector2? = nil
	if body and body ~= "" then
		bodyBounds = TextService:GetTextSize(body, bodySize, bodyFont, Vector2.new(contentWidth, 1000))
		totalHeight = totalHeight + 2 + (bodyBounds :: Vector2).Y -- 2px gap
	end

	-- Clamp height
	totalHeight = math.clamp(totalHeight, 64, 120)

	-- State
	local isShowing = false
	local isDismissing = false
	local isDestroyed = false
	local activeTweens: {Tween} = {}
	local connections: {RBXScriptConnection} = {}
	local dismissThread: thread? = nil
	local positionTweens: {Tween} = {}

	local function cancelAllTweens()
		for _, tween in activeTweens do
			tween:Cancel()
		end
		table.clear(activeTweens)
	end

	local function cancelPositionTweens()
		for _, tween in positionTweens do
			tween:Cancel()
		end
		table.clear(positionTweens)
	end

	local function trackTween(tween: Tween): Tween
		table.insert(activeTweens, tween)
		return tween
	end

	-- Determine parent: config.Parent or create a ScreenGui in PlayerGui
	local screenGui: ScreenGui? = nil
	local parentInstance: Instance
	if config.Parent then
		parentInstance = config.Parent
	else
		local player = Players.LocalPlayer
		local playerGui = player:WaitForChild("PlayerGui")
		local gui = Instance.new("ScreenGui")
		gui.Name = "MangoNotificationGui"
		gui.ResetOnSpawn = false
		gui.IgnoreGuiInset = true
		gui.DisplayOrder = 100
		gui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
		gui.Parent = playerGui
		screenGui = gui
		parentInstance = gui
	end

	-- NotificationContainer (starts offscreen above)
	local notifContainer = Instance.new("Frame")
	notifContainer.Name = "MangoNotification"
	notifContainer.Size = UDim2.new(0, 380, 0, totalHeight)
	notifContainer.AnchorPoint = Vector2.new(0.5, 0)
	notifContainer.Position = UDim2.new(0.5, 0, 0, -80)
	notifContainer.BackgroundTransparency = 1
	notifContainer.BorderSizePixel = 0
	notifContainer.Parent = parentInstance

	-- Glass frame inside
	local glassFrame = MangoGlassFrame.new({
		Size = UDim2.new(1, 0, 1, 0),
		Position = UDim2.new(0, 0, 0, 0),
		CornerRadius = UDim.new(0, 20),
		Theme = theme,
		ShadowEnabled = true,
		ShadowLayerCount = 4,
		ShadowOffsetY = 4,
		ShadowSpread = 12,
		Parent = notifContainer,
	})

	-- Store target transparency for fade-in animation
	local targetBgTransparency = glassFrame.GlassSurface.BackgroundTransparency

	-- UIPadding on GlassSurface
	local padding = Instance.new("UIPadding")
	padding.PaddingTop = UDim.new(0, 14)
	padding.PaddingBottom = UDim.new(0, 14)
	padding.PaddingLeft = UDim.new(0, 14)
	padding.PaddingRight = UDim.new(0, 14)
	padding.Parent = glassFrame.GlassSurface

	-- UIListLayout (Horizontal, 12px gap)
	local hLayout = Instance.new("UIListLayout")
	hLayout.FillDirection = Enum.FillDirection.Horizontal
	hLayout.Padding = UDim.new(0, 12)
	hLayout.VerticalAlignment = Enum.VerticalAlignment.Center
	hLayout.SortOrder = Enum.SortOrder.LayoutOrder
	hLayout.Parent = glassFrame.GlassSurface

	-- Icon (optional)
	if hasIcon then
		local iconFrame = Instance.new("ImageLabel")
		iconFrame.Name = "IconFrame"
		iconFrame.Size = UDim2.new(0, 36, 0, 36)
		iconFrame.Image = icon :: string
		iconFrame.BackgroundTransparency = 1
		iconFrame.BorderSizePixel = 0
		iconFrame.LayoutOrder = 1
		iconFrame.ZIndex = 10
		iconFrame.Parent = glassFrame.GlassSurface

		local iconCorner = Instance.new("UICorner")
		iconCorner.CornerRadius = UDim.new(0, 8)
		iconCorner.Parent = iconFrame
	end

	-- TextContainer
	local textContainer = Instance.new("Frame")
	textContainer.Name = "TextContainer"
	textContainer.Size = UDim2.new(1, if hasIcon then -48 else 0, 1, 0)
	textContainer.BackgroundTransparency = 1
	textContainer.BorderSizePixel = 0
	textContainer.LayoutOrder = 2
	textContainer.ZIndex = 10
	textContainer.Parent = glassFrame.GlassSurface

	-- Vertical layout inside TextContainer
	local vLayout = Instance.new("UIListLayout")
	vLayout.FillDirection = Enum.FillDirection.Vertical
	vLayout.Padding = UDim.new(0, 2)
	vLayout.SortOrder = Enum.SortOrder.LayoutOrder
	vLayout.Parent = textContainer

	-- TitleLabel
	local titleLabel = Instance.new("TextLabel")
	titleLabel.Name = "TitleLabel"
	titleLabel.Text = title
	titleLabel.Font = titleFont
	titleLabel.TextSize = titleSize
	titleLabel.TextColor3 = primaryTextColor
	titleLabel.BackgroundTransparency = 1
	titleLabel.Size = UDim2.new(1, 0, 0, titleBounds.Y)
	titleLabel.TextXAlignment = Enum.TextXAlignment.Left
	titleLabel.TextYAlignment = Enum.TextYAlignment.Top
	titleLabel.TextWrapped = true
	titleLabel.BorderSizePixel = 0
	titleLabel.LayoutOrder = 1
	titleLabel.ZIndex = 10
	titleLabel.Parent = textContainer

	-- BodyLabel (optional)
	if body and body ~= "" and bodyBounds then
		local bodyLabel = Instance.new("TextLabel")
		bodyLabel.Name = "BodyLabel"
		bodyLabel.Text = body
		bodyLabel.Font = bodyFont
		bodyLabel.TextSize = bodySize
		bodyLabel.TextColor3 = secondaryTextColor
		bodyLabel.BackgroundTransparency = 1
		bodyLabel.Size = UDim2.new(1, 0, 0, (bodyBounds :: Vector2).Y)
		bodyLabel.TextXAlignment = Enum.TextXAlignment.Left
		bodyLabel.TextYAlignment = Enum.TextYAlignment.Top
		bodyLabel.TextWrapped = true
		bodyLabel.BorderSizePixel = 0
		bodyLabel.LayoutOrder = 2
		bodyLabel.ZIndex = 10
		bodyLabel.Parent = textContainer
	end

	-- Hit area for tap-to-dismiss (transparent TextButton for reliable input on transparent container)
	local dismissHitArea = Instance.new("TextButton")
	dismissHitArea.Name = "DismissHitArea"
	dismissHitArea.Size = UDim2.new(1, 0, 1, 0)
	dismissHitArea.BackgroundTransparency = 1
	dismissHitArea.BorderSizePixel = 0
	dismissHitArea.Text = ""
	dismissHitArea.AutoButtonColor = false
	dismissHitArea.ZIndex = 50
	dismissHitArea.Parent = notifContainer

	-- Tap to dismiss
	local tapConn = dismissHitArea.InputBegan:Connect(function(input: InputObject)
		if input.UserInputType == Enum.UserInputType.MouseButton1
			or input.UserInputType == Enum.UserInputType.Touch then
			if isShowing and not isDismissing then
				-- Forward reference to dismiss — handled via self
				isDismissing = true
				-- Cancel auto-dismiss thread to prevent leaked task.delay
				if dismissThread then
					task.cancel(dismissThread)
					dismissThread = nil
				end
				cancelAllTweens()
				local tweenOut = TweenInfo.new(0.35, Enum.EasingStyle.Quad, Enum.EasingDirection.In)
				local slideTween = TweenService:Create(notifContainer, tweenOut, {
					Position = UDim2.new(0.5, 0, 0, -80),
				})
				trackTween(slideTween)
				slideTween:Play()
				slideTween.Completed:Connect(function()
					if not isDestroyed then
						if config.OnDismissed then
							config.OnDismissed()
						end
						-- Auto-destroy after dismiss
						isDestroyed = true
						for _, conn in connections do
							conn:Disconnect()
						end
						table.clear(connections)
						glassFrame:Destroy()
						notifContainer:Destroy()
						if screenGui then
							screenGui:Destroy()
						end
					end
				end)
			end
		end
	end)
	table.insert(connections, tapConn)

	-- Return table
	local self: Types.MangoNotification = {
		Container = notifContainer,
		Show = function(self: Types.MangoNotification)
			if isShowing or isDestroyed then
				return
			end
			isShowing = true

			-- Start with glass surface fully transparent for fade-in
			glassFrame.GlassSurface.BackgroundTransparency = 1

			-- Spring tween to visible position
			cancelAllTweens()
			local springInfo = TweenInfo.new(0.4, Enum.EasingStyle.Back, Enum.EasingDirection.Out)
			local slideTween = TweenService:Create(notifContainer, springInfo, {
				Position = UDim2.new(0.5, 0, 0, 16),
			})
			trackTween(slideTween)
			slideTween:Play()

			-- Fade in glass surface
			local fadeInfo = TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
			local fadeTween = TweenService:Create(glassFrame.GlassSurface, fadeInfo, {
				BackgroundTransparency = targetBgTransparency,
			})
			trackTween(fadeTween)
			fadeTween:Play()

			-- Auto-dismiss after duration (0 = no auto-dismiss)
			if duration > 0 then
				dismissThread = task.delay(duration, function()
					if not isDismissing and not isDestroyed and isShowing then
						self:Dismiss()
					end
				end)
			end
		end,
		Dismiss = function(self: Types.MangoNotification)
			if isDismissing or isDestroyed or not isShowing then
				return
			end
			isDismissing = true

			-- Cancel auto-dismiss thread
			if dismissThread then
				task.cancel(dismissThread)
				dismissThread = nil
			end

			cancelAllTweens()
			local tweenOut = TweenInfo.new(0.35, Enum.EasingStyle.Quad, Enum.EasingDirection.In)
			local slideTween = TweenService:Create(notifContainer, tweenOut, {
				Position = UDim2.new(0.5, 0, 0, -80),
			})
			trackTween(slideTween)
			slideTween:Play()
			slideTween.Completed:Connect(function()
				if not isDestroyed then
					if config.OnDismissed then
						config.OnDismissed()
					end
					-- Auto-destroy after dismiss
					self:Destroy()
				end
			end)
		end,
		SetPosition = function(self: Types.MangoNotification, position: UDim2)
			if isDestroyed then
				return
			end
			cancelPositionTweens()
			local tweenInfo = TweenInfo.new(0.25, Enum.EasingStyle.Back, Enum.EasingDirection.Out)
			local posTween = TweenService:Create(notifContainer, tweenInfo, {
				Position = position,
			})
			table.insert(positionTweens, posTween)
			posTween:Play()
		end,
		GetHeight = function(self: Types.MangoNotification): number
			return totalHeight
		end,
		Destroy = function(self: Types.MangoNotification)
			if isDestroyed then
				return
			end
			isDestroyed = true

			-- Cancel auto-dismiss thread
			if dismissThread then
				task.cancel(dismissThread)
				dismissThread = nil
			end

			cancelAllTweens()
			cancelPositionTweens()
			for _, conn in connections do
				conn:Disconnect()
			end
			table.clear(connections)
			glassFrame:Destroy()
			notifContainer:Destroy()
			if screenGui then
				screenGui:Destroy()
			end
		end,
	}

	return self
end

return module

end

_modules["MangoDialog"] = function()


local Types = _require("Types")
local Themes = _require("Themes")
local MangoGlassFrame = _require("MangoGlassFrame")
local resolve = Themes.resolve
local TweenService = game:GetService("TweenService")
local Players = game:GetService("Players")
local TextService = game:GetService("TextService")

local module = {}

function module.new(config: Types.MangoDialogConfig): Types.MangoDialog
	local theme = config.Theme
	local title = config.Title
	local message = config.Message
	local buttons = config.Buttons

	-- Theme-driven values
	local overlayTransparency = resolve(nil, theme and theme.DialogOverlayTransparency, 0.40) :: number
	local dialogBgTransparency = resolve(nil, theme and theme.DialogBackgroundTransparency, 0.78) :: number
	local primaryTextColor = resolve(nil, theme and theme.PrimaryTextColor, Color3.fromRGB(0, 0, 0)) :: Color3
	local secondaryTextColor = resolve(nil, theme and theme.SecondaryTextColor, Color3.fromRGB(60, 60, 70)) :: Color3

	-- If no buttons config, add a single OK button
	if not buttons or #buttons == 0 then
		buttons = {
			{ Text = "OK", Style = "cancel" },
		}
	end

	-- State
	local isShowing = false
	local isDismissing = false
	local isDestroyed = false
	local activeTweens: {Tween} = {}
	local connections: {RBXScriptConnection} = {}

	local function cancelAllTweens()
		for _, tween in activeTweens do
			tween:Cancel()
		end
		table.clear(activeTweens)
	end

	local function trackTween(tween: Tween): Tween
		table.insert(activeTweens, tween)
		return tween
	end

	-- Create ScreenGui
	local screenGui: ScreenGui? = nil
	local parentInstance: Instance
	if config.Parent then
		parentInstance = config.Parent
	else
		local player = Players.LocalPlayer
		local playerGui = player:WaitForChild("PlayerGui")
		local gui = Instance.new("ScreenGui")
		gui.Name = "MangoDialogGui"
		gui.ResetOnSpawn = false
		gui.IgnoreGuiInset = true
		gui.DisplayOrder = 150
		gui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
		gui.Parent = playerGui
		screenGui = gui
		parentInstance = gui
	end

	-- Overlay
	local overlay = Instance.new("Frame")
	overlay.Name = "DialogOverlay"
	overlay.Size = UDim2.new(1, 0, 1, 0)
	overlay.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
	overlay.BackgroundTransparency = 1 -- starts fully transparent
	overlay.BorderSizePixel = 0
	overlay.ZIndex = 1
	overlay.Parent = parentInstance

	-- DialogContainer
	local dialogContainer = Instance.new("Frame")
	dialogContainer.Name = "DialogContainer"
	dialogContainer.AnchorPoint = Vector2.new(0.5, 0.5)
	dialogContainer.Position = UDim2.new(0.5, 0, 0.5, 0)
	dialogContainer.BackgroundTransparency = 1
	dialogContainer.BorderSizePixel = 0
	dialogContainer.ZIndex = 2
	dialogContainer.Parent = parentInstance

	-- UIScale for dialog animation
	local dialogScale = Instance.new("UIScale")
	dialogScale.Scale = 0.8
	dialogScale.Parent = dialogContainer

	-- Measure text to compute dialog height
	local contentWidth = 270 - 32 -- 16px padding each side
	local titleFont = Enum.Font.GothamBold
	local titleSize = 17
	local messageFont = Enum.Font.Gotham
	local messageSize = 14

	local titleBounds = TextService:GetTextSize(title, titleSize, titleFont, Vector2.new(contentWidth, 1000))
	local dialogContentHeight = 20 + titleBounds.Y -- 20px top padding

	local messageBounds: Vector2? = nil
	if message and message ~= "" then
		messageBounds = TextService:GetTextSize(message, messageSize, messageFont, Vector2.new(contentWidth, 1000))
		dialogContentHeight = dialogContentHeight + 4 + (messageBounds :: Vector2).Y
	end

	dialogContentHeight = dialogContentHeight + 16 -- bottom padding before separator

	-- Separator + buttons height
	local buttonCount = #(buttons :: {Types.MangoDialogButtonConfig})
	local buttonsHeight = 1 + (buttonCount * 44) + math.max(0, buttonCount - 1) -- 1px separator + buttons + inter-button separators
	local totalDialogHeight = dialogContentHeight + buttonsHeight

	dialogContainer.Size = UDim2.new(0, 270, 0, totalDialogHeight)

	-- Glass frame inside dialog
	local glassFrame = MangoGlassFrame.new({
		Size = UDim2.new(1, 0, 1, 0),
		Position = UDim2.new(0, 0, 0, 0),
		CornerRadius = UDim.new(0, 16),
		Theme = theme,
		BackgroundTransparency = dialogBgTransparency,
		ShadowEnabled = true,
		ShadowLayerCount = 4,
		ShadowOffsetY = 4,
		ShadowSpread = 16,
		LightweightMode = true,
		Parent = dialogContainer,
	})

	-- Store target transparency for animation
	local targetGlassTransparency = glassFrame.GlassSurface.BackgroundTransparency

	-- UIPadding on GlassSurface for title/message area
	-- We use a content frame for the text area and separate the buttons
	local contentFrame = Instance.new("Frame")
	contentFrame.Name = "ContentFrame"
	contentFrame.Size = UDim2.new(1, 0, 0, dialogContentHeight)
	contentFrame.Position = UDim2.new(0, 0, 0, 0)
	contentFrame.BackgroundTransparency = 1
	contentFrame.BorderSizePixel = 0
	contentFrame.ZIndex = 10
	contentFrame.Parent = glassFrame.GlassSurface

	local contentPadding = Instance.new("UIPadding")
	contentPadding.PaddingTop = UDim.new(0, 20)
	contentPadding.PaddingLeft = UDim.new(0, 16)
	contentPadding.PaddingRight = UDim.new(0, 16)
	contentPadding.Parent = contentFrame

	local contentLayout = Instance.new("UIListLayout")
	contentLayout.FillDirection = Enum.FillDirection.Vertical
	contentLayout.Padding = UDim.new(0, 4)
	contentLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
	contentLayout.SortOrder = Enum.SortOrder.LayoutOrder
	contentLayout.Parent = contentFrame

	-- TitleLabel
	local titleLabel = Instance.new("TextLabel")
	titleLabel.Name = "TitleLabel"
	titleLabel.Text = title
	titleLabel.Font = titleFont
	titleLabel.TextSize = titleSize
	titleLabel.TextColor3 = primaryTextColor
	titleLabel.BackgroundTransparency = 1
	titleLabel.Size = UDim2.new(1, 0, 0, titleBounds.Y)
	titleLabel.TextXAlignment = Enum.TextXAlignment.Center
	titleLabel.TextYAlignment = Enum.TextYAlignment.Center
	titleLabel.TextWrapped = true
	titleLabel.BorderSizePixel = 0
	titleLabel.LayoutOrder = 1
	titleLabel.ZIndex = 10
	titleLabel.Parent = contentFrame

	-- MessageLabel (optional)
	if message and message ~= "" and messageBounds then
		local messageLabel = Instance.new("TextLabel")
		messageLabel.Name = "MessageLabel"
		messageLabel.Text = message
		messageLabel.Font = messageFont
		messageLabel.TextSize = messageSize
		messageLabel.TextColor3 = secondaryTextColor
		messageLabel.BackgroundTransparency = 1
		messageLabel.Size = UDim2.new(1, 0, 0, (messageBounds :: Vector2).Y)
		messageLabel.TextXAlignment = Enum.TextXAlignment.Center
		messageLabel.TextYAlignment = Enum.TextYAlignment.Top
		messageLabel.TextWrapped = true
		messageLabel.BorderSizePixel = 0
		messageLabel.LayoutOrder = 2
		messageLabel.ZIndex = 10
		messageLabel.Parent = contentFrame
	end

	-- Separator between content and buttons
	local separator = Instance.new("Frame")
	separator.Name = "Separator"
	separator.Size = UDim2.new(1, 0, 0, 1)
	separator.Position = UDim2.new(0, 0, 0, dialogContentHeight)
	separator.BackgroundColor3 = Color3.fromRGB(180, 180, 180)
	separator.BackgroundTransparency = 0.7
	separator.BorderSizePixel = 0
	separator.ZIndex = 10
	separator.Parent = glassFrame.GlassSurface

	-- Buttons container
	local buttonsContainer = Instance.new("Frame")
	buttonsContainer.Name = "ButtonsContainer"
	buttonsContainer.Size = UDim2.new(1, 0, 0, buttonsHeight - 1) -- minus the top separator
	buttonsContainer.Position = UDim2.new(0, 0, 0, dialogContentHeight + 1)
	buttonsContainer.BackgroundTransparency = 1
	buttonsContainer.BorderSizePixel = 0
	buttonsContainer.ZIndex = 10
	buttonsContainer.Parent = glassFrame.GlassSurface

	local buttonsLayout = Instance.new("UIListLayout")
	buttonsLayout.FillDirection = Enum.FillDirection.Vertical
	buttonsLayout.Padding = UDim.new(0, 0) -- separators are inline
	buttonsLayout.SortOrder = Enum.SortOrder.LayoutOrder
	buttonsLayout.Parent = buttonsContainer

	-- Forward reference for dismiss
	local dismissFunc: (() -> ())? = nil

	-- Create each button
	for i, buttonConfig in buttons :: {Types.MangoDialogButtonConfig} do
		-- Inter-button separator (not before the first button)
		if i > 1 then
			local btnSep = Instance.new("Frame")
			btnSep.Name = "ButtonSeparator" .. i
			btnSep.Size = UDim2.new(1, 0, 0, 1)
			btnSep.BackgroundColor3 = Color3.fromRGB(180, 180, 180)
			btnSep.BackgroundTransparency = 0.7
			btnSep.BorderSizePixel = 0
			btnSep.ZIndex = 10
			btnSep.LayoutOrder = (i - 1) * 2
			btnSep.Parent = buttonsContainer
		end

		local btnFrame = Instance.new("Frame")
		btnFrame.Name = "Button" .. i
		btnFrame.Size = UDim2.new(1, 0, 0, 44)
		btnFrame.BackgroundTransparency = 1
		btnFrame.BorderSizePixel = 0
		btnFrame.ZIndex = 10
		btnFrame.LayoutOrder = (i - 1) * 2 + 1
		btnFrame.Parent = buttonsContainer

		-- Determine style
		local style = buttonConfig.Style or "default"
		local btnTextColor: Color3
		local btnFont: Enum.Font
		if style == "destructive" then
			btnTextColor = Color3.fromRGB(255, 59, 48)
			btnFont = Enum.Font.Gotham
		elseif style == "cancel" then
			btnTextColor = primaryTextColor
			btnFont = Enum.Font.GothamBold
		else
			btnTextColor = primaryTextColor
			btnFont = Enum.Font.Gotham
		end

		local btnLabel = Instance.new("TextLabel")
		btnLabel.Name = "ButtonLabel"
		btnLabel.Text = buttonConfig.Text
		btnLabel.Font = btnFont
		btnLabel.TextSize = 17
		btnLabel.TextColor3 = btnTextColor
		btnLabel.BackgroundTransparency = 1
		btnLabel.Size = UDim2.new(1, 0, 1, 0)
		btnLabel.TextXAlignment = Enum.TextXAlignment.Center
		btnLabel.TextYAlignment = Enum.TextYAlignment.Center
		btnLabel.BorderSizePixel = 0
		btnLabel.ZIndex = 10
		btnLabel.Parent = btnFrame

		-- HitArea
		local hitArea = Instance.new("TextButton")
		hitArea.Name = "HitArea"
		hitArea.Size = UDim2.new(1, 0, 1, 0)
		hitArea.BackgroundTransparency = 1
		hitArea.Text = ""
		hitArea.BorderSizePixel = 0
		hitArea.ZIndex = 100
		hitArea.AutoButtonColor = false
		hitArea.Parent = btnFrame

		local conn = hitArea.Activated:Connect(function()
			if buttonConfig.OnActivated then
				buttonConfig.OnActivated()
			end
			if dismissFunc then
				dismissFunc()
			end
		end)
		table.insert(connections, conn)
	end

	-- Overlay tap to dismiss
	local overlayHit = Instance.new("TextButton")
	overlayHit.Name = "OverlayHitArea"
	overlayHit.Size = UDim2.new(1, 0, 1, 0)
	overlayHit.BackgroundTransparency = 1
	overlayHit.Text = ""
	overlayHit.BorderSizePixel = 0
	overlayHit.ZIndex = 0
	overlayHit.AutoButtonColor = false
	overlayHit.Parent = overlay

	local overlayConn = overlayHit.Activated:Connect(function()
		if dismissFunc then
			dismissFunc()
		end
	end)
	table.insert(connections, overlayConn)

	-- Dismiss implementation
	local function doDismiss()
		if isDismissing or isDestroyed or not isShowing then
			return
		end
		isDismissing = true

		cancelAllTweens()
		local tweenOut = TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.In)

		-- Fade overlay out
		local overlayTween = TweenService:Create(overlay, tweenOut, {
			BackgroundTransparency = 1,
		})
		trackTween(overlayTween)
		overlayTween:Play()

		-- Scale dialog down + fade glass
		local scaleTween = TweenService:Create(dialogScale, tweenOut, { Scale = 0.8 })
		trackTween(scaleTween)
		scaleTween:Play()

		local glassFadeTween = TweenService:Create(glassFrame.GlassSurface, tweenOut, {
			BackgroundTransparency = 1,
		})
		trackTween(glassFadeTween)
		glassFadeTween:Play()

		scaleTween.Completed:Once(function()
			if not isDestroyed then
				if config.OnDismissed then
					config.OnDismissed()
				end
				-- Auto-destroy
				isDestroyed = true
				cancelAllTweens()
				for _, conn in connections do
					conn:Disconnect()
				end
				table.clear(connections)
				glassFrame:Destroy()
				dialogContainer:Destroy()
				overlay:Destroy()
				if screenGui then
					screenGui:Destroy()
				end
			end
		end)
	end

	dismissFunc = doDismiss

	-- Return table
	local self: Types.MangoDialog = {
		Show = function(self: Types.MangoDialog)
			if isShowing or isDestroyed then
				return
			end
			isShowing = true

			-- Start with glass surface fully transparent
			glassFrame.GlassSurface.BackgroundTransparency = 1
			dialogScale.Scale = 0.8

			cancelAllTweens()

			-- Fade overlay in
			local overlayInfo = TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
			local overlayTween = TweenService:Create(overlay, overlayInfo, {
				BackgroundTransparency = overlayTransparency,
			})
			trackTween(overlayTween)
			overlayTween:Play()

			-- Scale dialog in
			local scaleInfo = TweenInfo.new(0.25, Enum.EasingStyle.Back, Enum.EasingDirection.Out)
			local scaleTween = TweenService:Create(dialogScale, scaleInfo, { Scale = 1 })
			trackTween(scaleTween)
			scaleTween:Play()

			-- Fade glass surface in
			local fadeInfo = TweenInfo.new(0.25, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
			local glassFadeTween = TweenService:Create(glassFrame.GlassSurface, fadeInfo, {
				BackgroundTransparency = targetGlassTransparency,
			})
			trackTween(glassFadeTween)
			glassFadeTween:Play()
		end,
		Dismiss = function(self: Types.MangoDialog)
			doDismiss()
		end,
		Destroy = function(self: Types.MangoDialog)
			if isDestroyed then
				return
			end
			isDestroyed = true

			cancelAllTweens()
			for _, conn in connections do
				conn:Disconnect()
			end
			table.clear(connections)
			glassFrame:Destroy()
			dialogContainer:Destroy()
			overlay:Destroy()
			if screenGui then
				screenGui:Destroy()
			end
		end,
	}

	return self
end

return module

end

_modules["MangoActionSheet"] = function()


local Types = _require("Types")
local Themes = _require("Themes")
local MangoGlassFrame = _require("MangoGlassFrame")
local resolve = Themes.resolve
local TweenService = game:GetService("TweenService")
local Players = game:GetService("Players")
local TextService = game:GetService("TextService")

local module = {}

function module.new(config: Types.MangoActionSheetConfig): Types.MangoActionSheet
	local theme = config.Theme
	local title = config.Title
	local message = config.Message
	local actions = config.Actions
	local cancelText = resolve(config.CancelText, nil, "Cancel") :: string

	-- Theme-driven values
	local overlayTransparency = resolve(nil, theme and theme.DialogOverlayTransparency, 0.40) :: number
	local primaryTextColor = resolve(nil, theme and theme.PrimaryTextColor, Color3.fromRGB(0, 0, 0)) :: Color3
	local secondaryTextColor = resolve(nil, theme and theme.SecondaryTextColor, Color3.fromRGB(60, 60, 70)) :: Color3
	local cancelButtonColor = resolve(nil, theme and theme.TabBarSelectedColor, primaryTextColor) :: Color3

	-- State
	local isShowing = false
	local isDismissing = false
	local isDestroyed = false
	local activeTweens: {Tween} = {}
	local connections: {RBXScriptConnection} = {}

	local function cancelAllTweens()
		for _, tween in activeTweens do
			tween:Cancel()
		end
		table.clear(activeTweens)
	end

	local function trackTween(tween: Tween): Tween
		table.insert(activeTweens, tween)
		return tween
	end

	-- Create ScreenGui
	local screenGui: ScreenGui? = nil
	local parentInstance: Instance
	if config.Parent then
		parentInstance = config.Parent
	else
		local player = Players.LocalPlayer
		local playerGui = player:WaitForChild("PlayerGui")
		local gui = Instance.new("ScreenGui")
		gui.Name = "MangoActionSheetGui"
		gui.ResetOnSpawn = false
		gui.IgnoreGuiInset = true
		gui.DisplayOrder = 150
		gui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
		gui.Parent = playerGui
		screenGui = gui
		parentInstance = gui
	end

	-- Overlay
	local overlay = Instance.new("Frame")
	overlay.Name = "ActionSheetOverlay"
	overlay.Size = UDim2.new(1, 0, 1, 0)
	overlay.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
	overlay.BackgroundTransparency = 1 -- starts fully transparent
	overlay.BorderSizePixel = 0
	overlay.ZIndex = 1
	overlay.Parent = parentInstance

	-- SheetContainer (anchored bottom center)
	local sheetContainer = Instance.new("Frame")
	sheetContainer.Name = "SheetContainer"
	sheetContainer.AnchorPoint = Vector2.new(0.5, 1)
	sheetContainer.Position = UDim2.new(0.5, 0, 1, 100) -- starts offscreen below
	sheetContainer.BackgroundTransparency = 1
	sheetContainer.BorderSizePixel = 0
	sheetContainer.ZIndex = 2
	sheetContainer.Parent = parentInstance

	-- Compute actions group height
	local hasHeader = (title and title ~= "") or (message and message ~= "")
	local headerHeight = 0
	local titleFont = Enum.Font.Gotham
	local titleSize = 13
	local messageFont = Enum.Font.Gotham
	local messageSize = 13
	-- Use a reasonable content width: min(400, estimate) - padding
	local sheetWidth = 400 -- will be constrained by UISizeConstraint
	local contentWidth = sheetWidth - 32 -- 16px padding each side

	local titleBounds: Vector2? = nil
	local messageBounds: Vector2? = nil

	if title and title ~= "" then
		titleBounds = TextService:GetTextSize(title, titleSize, titleFont, Vector2.new(contentWidth, 1000))
		headerHeight = headerHeight + 16 + (titleBounds :: Vector2).Y -- 16px top padding
	end

	if message and message ~= "" then
		messageBounds = TextService:GetTextSize(message, messageSize, messageFont, Vector2.new(contentWidth, 1000))
		local topGap = if headerHeight > 0 then 4 else 16
		headerHeight = headerHeight + topGap + (messageBounds :: Vector2).Y
	end

	if hasHeader then
		headerHeight = headerHeight + 12 -- bottom padding
		headerHeight = headerHeight + 1 -- separator
	end

	local actionCount = #actions
	local actionsAreaHeight = (actionCount * 56) + math.max(0, actionCount - 1) -- 56px per action + 1px separators
	local actionsGroupHeight = headerHeight + actionsAreaHeight

	-- Cancel group height
	local cancelGroupHeight = 56

	-- Total sheet height
	local totalSheetHeight = actionsGroupHeight + 8 + cancelGroupHeight

	-- Width: min(400, screen width - 16) — we use a UISizeConstraint to handle screen width
	sheetContainer.Size = UDim2.new(1, -16, 0, totalSheetHeight)

	local sizeConstraint = Instance.new("UISizeConstraint")
	sizeConstraint.MaxSize = Vector2.new(400, totalSheetHeight)
	sizeConstraint.Parent = sheetContainer

	-- Vertical layout for sheet container
	local sheetLayout = Instance.new("UIListLayout")
	sheetLayout.FillDirection = Enum.FillDirection.Vertical
	sheetLayout.Padding = UDim.new(0, 8)
	sheetLayout.SortOrder = Enum.SortOrder.LayoutOrder
	sheetLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
	sheetLayout.Parent = sheetContainer

	-- Actions Group Glass Frame
	local actionsGroupContainer = Instance.new("Frame")
	actionsGroupContainer.Name = "ActionsGroupContainer"
	actionsGroupContainer.Size = UDim2.new(1, 0, 0, actionsGroupHeight)
	actionsGroupContainer.BackgroundTransparency = 1
	actionsGroupContainer.BorderSizePixel = 0
	actionsGroupContainer.LayoutOrder = 1
	actionsGroupContainer.Parent = sheetContainer

	local actionsGlass = MangoGlassFrame.new({
		Size = UDim2.new(1, 0, 1, 0),
		Position = UDim2.new(0, 0, 0, 0),
		CornerRadius = UDim.new(0, 14),
		Theme = theme,
		ShadowEnabled = true,
		ShadowLayerCount = 3,
		ShadowOffsetY = 2,
		ShadowSpread = 8,
		LightweightMode = true,
		Parent = actionsGroupContainer,
	})

	-- Forward reference for dismiss
	local dismissFunc: (() -> ())? = nil

	-- Build header inside actions glass
	local currentY = 0

	if hasHeader then
		local headerFrame = Instance.new("Frame")
		headerFrame.Name = "HeaderFrame"
		headerFrame.Size = UDim2.new(1, 0, 0, headerHeight - 1) -- minus separator
		headerFrame.Position = UDim2.new(0, 0, 0, 0)
		headerFrame.BackgroundTransparency = 1
		headerFrame.BorderSizePixel = 0
		headerFrame.ZIndex = 10
		headerFrame.Parent = actionsGlass.GlassSurface

		local headerPadding = Instance.new("UIPadding")
		headerPadding.PaddingTop = UDim.new(0, 16)
		headerPadding.PaddingLeft = UDim.new(0, 16)
		headerPadding.PaddingRight = UDim.new(0, 16)
		headerPadding.Parent = headerFrame

		local headerLayout = Instance.new("UIListLayout")
		headerLayout.FillDirection = Enum.FillDirection.Vertical
		headerLayout.Padding = UDim.new(0, 4)
		headerLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
		headerLayout.SortOrder = Enum.SortOrder.LayoutOrder
		headerLayout.Parent = headerFrame

		if title and title ~= "" and titleBounds then
			local titleLabel = Instance.new("TextLabel")
			titleLabel.Name = "TitleLabel"
			titleLabel.Text = title
			titleLabel.Font = titleFont
			titleLabel.TextSize = titleSize
			titleLabel.TextColor3 = secondaryTextColor
			titleLabel.BackgroundTransparency = 1
			titleLabel.Size = UDim2.new(1, 0, 0, (titleBounds :: Vector2).Y)
			titleLabel.TextXAlignment = Enum.TextXAlignment.Center
			titleLabel.TextYAlignment = Enum.TextYAlignment.Center
			titleLabel.TextWrapped = true
			titleLabel.BorderSizePixel = 0
			titleLabel.LayoutOrder = 1
			titleLabel.ZIndex = 10
			titleLabel.Parent = headerFrame
		end

		if message and message ~= "" and messageBounds then
			local messageLabel = Instance.new("TextLabel")
			messageLabel.Name = "MessageLabel"
			messageLabel.Text = message
			messageLabel.Font = messageFont
			messageLabel.TextSize = messageSize
			messageLabel.TextColor3 = secondaryTextColor
			messageLabel.BackgroundTransparency = 1
			messageLabel.Size = UDim2.new(1, 0, 0, (messageBounds :: Vector2).Y)
			messageLabel.TextXAlignment = Enum.TextXAlignment.Center
			messageLabel.TextYAlignment = Enum.TextYAlignment.Top
			messageLabel.TextWrapped = true
			messageLabel.BorderSizePixel = 0
			messageLabel.LayoutOrder = 2
			messageLabel.ZIndex = 10
			messageLabel.Parent = headerFrame
		end

		-- Separator after header
		local headerSep = Instance.new("Frame")
		headerSep.Name = "HeaderSeparator"
		headerSep.Size = UDim2.new(1, 0, 0, 1)
		headerSep.Position = UDim2.new(0, 0, 0, headerHeight - 1)
		headerSep.BackgroundColor3 = Color3.fromRGB(180, 180, 180)
		headerSep.BackgroundTransparency = 0.7
		headerSep.BorderSizePixel = 0
		headerSep.ZIndex = 10
		headerSep.Parent = actionsGlass.GlassSurface

		currentY = headerHeight
	end

	-- Action items
	for i, actionConfig in actions do
		-- Inter-action separator (not before first if no header, or always between actions)
		if i > 1 then
			local actionSep = Instance.new("Frame")
			actionSep.Name = "ActionSeparator" .. i
			actionSep.Size = UDim2.new(1, 0, 0, 1)
			actionSep.Position = UDim2.new(0, 0, 0, currentY)
			actionSep.BackgroundColor3 = Color3.fromRGB(180, 180, 180)
			actionSep.BackgroundTransparency = 0.7
			actionSep.BorderSizePixel = 0
			actionSep.ZIndex = 10
			actionSep.Parent = actionsGlass.GlassSurface
			currentY = currentY + 1
		end

		local actionFrame = Instance.new("Frame")
		actionFrame.Name = "Action" .. i
		actionFrame.Size = UDim2.new(1, 0, 0, 56)
		actionFrame.Position = UDim2.new(0, 0, 0, currentY)
		actionFrame.BackgroundTransparency = 1
		actionFrame.BorderSizePixel = 0
		actionFrame.ZIndex = 10
		actionFrame.Parent = actionsGlass.GlassSurface

		local style = actionConfig.Style or "default"
		local actionTextColor: Color3
		if style == "destructive" then
			actionTextColor = Color3.fromRGB(255, 59, 48)
		else
			actionTextColor = primaryTextColor
		end

		local actionLabel = Instance.new("TextLabel")
		actionLabel.Name = "ActionLabel"
		actionLabel.Text = actionConfig.Text
		actionLabel.Font = Enum.Font.Gotham
		actionLabel.TextSize = 20
		actionLabel.TextColor3 = actionTextColor
		actionLabel.BackgroundTransparency = 1
		actionLabel.Size = UDim2.new(1, 0, 1, 0)
		actionLabel.TextXAlignment = Enum.TextXAlignment.Center
		actionLabel.TextYAlignment = Enum.TextYAlignment.Center
		actionLabel.BorderSizePixel = 0
		actionLabel.ZIndex = 10
		actionLabel.Parent = actionFrame

		local hitArea = Instance.new("TextButton")
		hitArea.Name = "HitArea"
		hitArea.Size = UDim2.new(1, 0, 1, 0)
		hitArea.BackgroundTransparency = 1
		hitArea.Text = ""
		hitArea.BorderSizePixel = 0
		hitArea.ZIndex = 100
		hitArea.AutoButtonColor = false
		hitArea.Parent = actionFrame

		local conn = hitArea.Activated:Connect(function()
			if actionConfig.OnActivated then
				actionConfig.OnActivated()
			end
			if dismissFunc then
				dismissFunc()
			end
		end)
		table.insert(connections, conn)

		currentY = currentY + 56
	end

	-- Cancel Group
	local cancelGroupContainer = Instance.new("Frame")
	cancelGroupContainer.Name = "CancelGroupContainer"
	cancelGroupContainer.Size = UDim2.new(1, 0, 0, cancelGroupHeight)
	cancelGroupContainer.BackgroundTransparency = 1
	cancelGroupContainer.BorderSizePixel = 0
	cancelGroupContainer.LayoutOrder = 2
	cancelGroupContainer.Parent = sheetContainer

	local cancelGlass = MangoGlassFrame.new({
		Size = UDim2.new(1, 0, 1, 0),
		Position = UDim2.new(0, 0, 0, 0),
		CornerRadius = UDim.new(0, 14),
		Theme = theme,
		ShadowEnabled = true,
		ShadowLayerCount = 2,
		ShadowOffsetY = 1,
		ShadowSpread = 4,
		LightweightMode = true,
		Parent = cancelGroupContainer,
	})

	local cancelLabel = Instance.new("TextLabel")
	cancelLabel.Name = "CancelLabel"
	cancelLabel.Text = cancelText
	cancelLabel.Font = Enum.Font.GothamBold
	cancelLabel.TextSize = 20
	cancelLabel.TextColor3 = cancelButtonColor
	cancelLabel.BackgroundTransparency = 1
	cancelLabel.Size = UDim2.new(1, 0, 1, 0)
	cancelLabel.TextXAlignment = Enum.TextXAlignment.Center
	cancelLabel.TextYAlignment = Enum.TextYAlignment.Center
	cancelLabel.BorderSizePixel = 0
	cancelLabel.ZIndex = 10
	cancelLabel.Parent = cancelGlass.GlassSurface

	local cancelHitArea = Instance.new("TextButton")
	cancelHitArea.Name = "HitArea"
	cancelHitArea.Size = UDim2.new(1, 0, 1, 0)
	cancelHitArea.BackgroundTransparency = 1
	cancelHitArea.Text = ""
	cancelHitArea.BorderSizePixel = 0
	cancelHitArea.ZIndex = 100
	cancelHitArea.AutoButtonColor = false
	cancelHitArea.Parent = cancelGlass.GlassSurface

	local cancelConn = cancelHitArea.Activated:Connect(function()
		if dismissFunc then
			dismissFunc()
		end
	end)
	table.insert(connections, cancelConn)

	-- Overlay tap to dismiss
	local overlayHit = Instance.new("TextButton")
	overlayHit.Name = "OverlayHitArea"
	overlayHit.Size = UDim2.new(1, 0, 1, 0)
	overlayHit.BackgroundTransparency = 1
	overlayHit.Text = ""
	overlayHit.BorderSizePixel = 0
	overlayHit.ZIndex = 0
	overlayHit.AutoButtonColor = false
	overlayHit.Parent = overlay

	local overlayConn = overlayHit.Activated:Connect(function()
		if dismissFunc then
			dismissFunc()
		end
	end)
	table.insert(connections, overlayConn)

	-- Dismiss implementation
	local function doDismiss()
		if isDismissing or isDestroyed or not isShowing then
			return
		end
		isDismissing = true

		cancelAllTweens()
		local tweenOut = TweenInfo.new(0.25, Enum.EasingStyle.Quad, Enum.EasingDirection.In)

		-- Fade overlay out
		local overlayTween = TweenService:Create(overlay, tweenOut, {
			BackgroundTransparency = 1,
		})
		trackTween(overlayTween)
		overlayTween:Play()

		-- Slide sheet down
		local slideTween = TweenService:Create(sheetContainer, tweenOut, {
			Position = UDim2.new(0.5, 0, 1, 100),
		})
		trackTween(slideTween)
		slideTween:Play()

		slideTween.Completed:Once(function()
			if not isDestroyed then
				if config.OnDismissed then
					config.OnDismissed()
				end
				-- Auto-destroy
				isDestroyed = true
				cancelAllTweens()
				for _, conn in connections do
					conn:Disconnect()
				end
				table.clear(connections)
				actionsGlass:Destroy()
				cancelGlass:Destroy()
				sheetContainer:Destroy()
				overlay:Destroy()
				if screenGui then
					screenGui:Destroy()
				end
			end
		end)
	end

	dismissFunc = doDismiss

	-- Return table
	local self: Types.MangoActionSheet = {
		Show = function(self: Types.MangoActionSheet)
			if isShowing or isDestroyed then
				return
			end
			isShowing = true

			-- Start offscreen
			sheetContainer.Position = UDim2.new(0.5, 0, 1, 100)

			cancelAllTweens()

			-- Fade overlay in
			local overlayInfo = TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
			local overlayTween = TweenService:Create(overlay, overlayInfo, {
				BackgroundTransparency = overlayTransparency,
			})
			trackTween(overlayTween)
			overlayTween:Play()

			-- Slide sheet up
			local slideInfo = TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.Out)
			local slideTween = TweenService:Create(sheetContainer, slideInfo, {
				Position = UDim2.new(0.5, 0, 1, -8),
			})
			trackTween(slideTween)
			slideTween:Play()
		end,
		Dismiss = function(self: Types.MangoActionSheet)
			doDismiss()
		end,
		Destroy = function(self: Types.MangoActionSheet)
			if isDestroyed then
				return
			end
			isDestroyed = true

			cancelAllTweens()
			for _, conn in connections do
				conn:Disconnect()
			end
			table.clear(connections)
			actionsGlass:Destroy()
			cancelGlass:Destroy()
			sheetContainer:Destroy()
			overlay:Destroy()
			if screenGui then
				screenGui:Destroy()
			end
		end,
	}

	return self
end

return module

end

_modules["MangoDropdown"] = function()


local Types = _require("Types")
local Themes = _require("Themes")
local MangoGlassFrame = _require("MangoGlassFrame")
local resolve = Themes.resolve
local TweenService = game:GetService("TweenService")

local module = {}

function module.new(config: Types.MangoDropdownConfig): Types.MangoDropdown
	local theme = config.Theme
	local items = table.clone(config.Items)
	local itemCount = #items

	-- Resolve config values
	local size = resolve(config.Size, nil, UDim2.new(0, 200, 0, 36)) :: UDim2
	local position = config.Position
	local anchorPoint = resolve(config.AnchorPoint, nil, Vector2.new(0, 0)) :: Vector2
	local initialIndex = resolve(config.InitialIndex, nil, 1) :: number

	-- Theme values
	local primaryText = resolve(nil, theme and theme.PrimaryTextColor, Color3.fromRGB(0, 0, 0)) :: Color3
	local secondaryText = resolve(nil, theme and theme.SecondaryTextColor, Color3.fromRGB(60, 60, 70)) :: Color3
	local dropdownBgTransparency = resolve(nil, theme and theme.DropdownBackgroundTransparency, 0.82) :: number
	local itemHoverColor = resolve(nil, theme and theme.DropdownItemHoverColor, Color3.fromRGB(0, 122, 255)) :: Color3
	local itemHoverTransparency = resolve(nil, theme and theme.DropdownItemHoverTransparency, 0.85) :: number

	-- State
	local selectedIndex: number = math.clamp(initialIndex, 1, math.max(itemCount, 1))
	local isOpen = false
	local isDestroyed = false
	local activeTweens: {Tween} = {}
	local itemHoverTweens: {Tween} = {}
	local connections: {RBXScriptConnection} = {}
	local itemConnections: {RBXScriptConnection} = {}
	local clickBlocker: TextButton? = nil

	local function cancelAllTweens()
		for _, tween in activeTweens do
			tween:Cancel()
		end
		table.clear(activeTweens)
	end

	local function cancelItemHoverTweens()
		for _, tween in itemHoverTweens do
			tween:Cancel()
		end
		table.clear(itemHoverTweens)
	end

	local function trackTween(tween: Tween): Tween
		table.insert(activeTweens, tween)
		return tween
	end

	local function trackItemHoverTween(tween: Tween): Tween
		table.insert(itemHoverTweens, tween)
		return tween
	end

	-- Forward declaration for closeDropdown (used by click-blocker before definition)
	local closeDropdown: () -> ()

	-- Container (transparent wrapper, holds trigger + panel)
	local container = Instance.new("Frame")
	container.Name = "MangoDropdown"
	container.Size = UDim2.new(size.X.Scale, size.X.Offset, size.Y.Scale, size.Y.Offset + 0)
	container.Position = position
	container.AnchorPoint = anchorPoint
	container.BackgroundTransparency = 1
	container.BorderSizePixel = 0
	container.ClipsDescendants = false

	local function findScreenGui(): ScreenGui?
		local current: Instance? = container
		while current do
			if current:IsA("ScreenGui") then
				return current :: ScreenGui
			end
			current = current.Parent
		end
		return nil
	end

	local function createClickBlocker()
		local screenGui = findScreenGui()
		if not screenGui then return end

		local blocker = Instance.new("TextButton")
		blocker.Name = "DropdownClickBlocker"
		blocker.Size = UDim2.new(1, 0, 1, 0)
		blocker.BackgroundTransparency = 1
		blocker.Text = ""
		blocker.ZIndex = 49
		blocker.AutoButtonColor = false
		blocker.Parent = screenGui
		clickBlocker = blocker

		blocker.MouseButton1Click:Connect(function()
			closeDropdown()
		end)
	end

	local function destroyClickBlocker()
		if clickBlocker then
			clickBlocker:Destroy()
			clickBlocker = nil
		end
	end

	-- Trigger button via MangoGlassFrame (LightweightMode)
	local triggerGlass = MangoGlassFrame.new({
		Size = size,
		Position = UDim2.new(0, 0, 0, 0),
		CornerRadius = UDim.new(0, 999),
		BackgroundTransparency = dropdownBgTransparency,
		Theme = theme,
		ShadowEnabled = true,
		ShadowLayerCount = 2,
		ShadowSpread = 4,
		ShadowOffsetY = 1,
		LightweightMode = true,
		Parent = container,
	})

	-- SelectedLabel (left-aligned text)
	local selectedLabel = Instance.new("TextLabel")
	selectedLabel.Name = "SelectedLabel"
	selectedLabel.Size = UDim2.new(1, -40, 1, 0)
	selectedLabel.Position = UDim2.new(0, 14, 0, 0)
	selectedLabel.BackgroundTransparency = 1
	selectedLabel.BorderSizePixel = 0
	selectedLabel.Font = Enum.Font.GothamMedium
	selectedLabel.TextSize = 14
	selectedLabel.TextColor3 = primaryText
	selectedLabel.TextXAlignment = Enum.TextXAlignment.Left
	selectedLabel.TextTruncate = Enum.TextTruncate.AtEnd
	selectedLabel.Text = if itemCount > 0 then items[selectedIndex] else ""
	selectedLabel.ZIndex = 10
	selectedLabel.Parent = triggerGlass.GlassSurface

	-- Chevron (right side)
	local chevronLabel = Instance.new("TextLabel")
	chevronLabel.Name = "ChevronLabel"
	chevronLabel.Size = UDim2.new(0, 20, 1, 0)
	chevronLabel.Position = UDim2.new(1, -28, 0, 0)
	chevronLabel.BackgroundTransparency = 1
	chevronLabel.BorderSizePixel = 0
	chevronLabel.Font = Enum.Font.Gotham
	chevronLabel.TextSize = 12
	chevronLabel.TextColor3 = secondaryText
	chevronLabel.Text = "\226\150\188" -- ▼
	chevronLabel.ZIndex = 10
	chevronLabel.Parent = triggerGlass.GlassSurface

	-- HitArea on trigger
	local triggerHitArea = Instance.new("TextButton")
	triggerHitArea.Name = "HitArea"
	triggerHitArea.Size = UDim2.new(1, 0, 1, 0)
	triggerHitArea.BackgroundTransparency = 1
	triggerHitArea.Text = ""
	triggerHitArea.BorderSizePixel = 0
	triggerHitArea.ZIndex = 100
	triggerHitArea.AutoButtonColor = false
	triggerHitArea.Parent = triggerGlass.GlassSurface

	-- Dropdown panel (below trigger)
	local maxVisibleItems = 5
	local itemHeight = 36
	local panelItemCount = math.min(itemCount, maxVisibleItems)
	local panelHeight = panelItemCount * itemHeight + 8

	local panelGlass = MangoGlassFrame.new({
		Size = UDim2.new(1, 0, 0, panelHeight),
		Position = UDim2.new(0, 0, 0, size.Y.Offset + 4),
		CornerRadius = UDim.new(0, 12),
		BackgroundTransparency = dropdownBgTransparency - 0.05,
		Theme = theme,
		ShadowEnabled = true,
		ShadowLayerCount = 4,
		ShadowSpread = 6,
		ShadowOffsetY = 2,
		LightweightMode = true,
		Parent = container,
	})
	panelGlass.Container.Visible = false
	panelGlass.Container.ZIndex = 50

	-- UIScale for open animation
	local panelUIScale = Instance.new("UIScale")
	panelUIScale.Scale = 0.92
	panelUIScale.Parent = panelGlass.Container

	-- ScrollingFrame inside panel GlassSurface
	local scrollFrame = Instance.new("ScrollingFrame")
	scrollFrame.Name = "ScrollFrame"
	scrollFrame.Size = UDim2.new(1, 0, 1, 0)
	scrollFrame.Position = UDim2.new(0, 0, 0, 0)
	scrollFrame.BackgroundTransparency = 1
	scrollFrame.BorderSizePixel = 0
	scrollFrame.ScrollBarThickness = if itemCount > maxVisibleItems then 4 else 0
	scrollFrame.CanvasSize = UDim2.new(0, 0, 0, itemCount * itemHeight)
	scrollFrame.ScrollingDirection = Enum.ScrollingDirection.Y
	scrollFrame.ZIndex = 10
	scrollFrame.Parent = panelGlass.GlassSurface

	local scrollPadding = Instance.new("UIPadding")
	scrollPadding.PaddingTop = UDim.new(0, 4)
	scrollPadding.PaddingBottom = UDim.new(0, 4)
	scrollPadding.Parent = scrollFrame

	local scrollLayout = Instance.new("UIListLayout")
	scrollLayout.FillDirection = Enum.FillDirection.Vertical
	scrollLayout.SortOrder = Enum.SortOrder.LayoutOrder
	scrollLayout.Padding = UDim.new(0, 0)
	scrollLayout.Parent = scrollFrame

	-- Build item list
	local itemFrames: {Frame} = {}

	local function clearItemConnections()
		for _, conn in itemConnections do
			conn:Disconnect()
		end
		table.clear(itemConnections)
	end

	local function buildItems()
		-- Clear old items
		clearItemConnections()
		for _, frame in itemFrames do
			frame:Destroy()
		end
		table.clear(itemFrames)

		for i = 1, #items do
			local itemFrame = Instance.new("Frame")
			itemFrame.Name = "Item" .. i
			itemFrame.Size = UDim2.new(1, 0, 0, itemHeight)
			itemFrame.BackgroundColor3 = itemHoverColor
			itemFrame.BackgroundTransparency = 1
			itemFrame.BorderSizePixel = 0
			itemFrame.LayoutOrder = i
			itemFrame.Parent = scrollFrame

			local itemCorner = Instance.new("UICorner")
			itemCorner.CornerRadius = UDim.new(0, 8)
			itemCorner.Parent = itemFrame

			local itemLabel = Instance.new("TextLabel")
			itemLabel.Name = "ItemLabel"
			itemLabel.Size = UDim2.new(1, -48, 1, 0)
			itemLabel.Position = UDim2.new(0, 12, 0, 0)
			itemLabel.BackgroundTransparency = 1
			itemLabel.BorderSizePixel = 0
			itemLabel.Font = Enum.Font.GothamMedium
			itemLabel.TextSize = 14
			itemLabel.TextColor3 = if i == selectedIndex then primaryText else secondaryText
			itemLabel.TextXAlignment = Enum.TextXAlignment.Left
			itemLabel.TextTruncate = Enum.TextTruncate.AtEnd
			itemLabel.Text = items[i]
			itemLabel.ZIndex = 10
			itemLabel.Parent = itemFrame

			local checkLabel = Instance.new("TextLabel")
			checkLabel.Name = "CheckLabel"
			checkLabel.Size = UDim2.new(0, 20, 1, 0)
			checkLabel.Position = UDim2.new(1, -28, 0, 0)
			checkLabel.BackgroundTransparency = 1
			checkLabel.BorderSizePixel = 0
			checkLabel.Font = Enum.Font.GothamBold
			checkLabel.TextSize = 14
			checkLabel.TextColor3 = primaryText
			checkLabel.Text = if i == selectedIndex then "\226\156\147" else ""
			checkLabel.ZIndex = 10
			checkLabel.Parent = itemFrame

			if i < #items then
				local sep = Instance.new("Frame")
				sep.Name = "Separator"
				sep.Size = UDim2.new(1, -24, 0, 1)
				sep.Position = UDim2.new(0, 12, 1, 0)
				sep.BackgroundColor3 = resolve(nil, theme and theme.BackgroundColor3, Color3.fromRGB(230, 230, 235)) :: Color3
				sep.BackgroundTransparency = 0.80
				sep.BorderSizePixel = 0
				sep.ZIndex = 5
				sep.Parent = itemFrame
			end

			local itemHitArea = Instance.new("TextButton")
			itemHitArea.Name = "HitArea"
			itemHitArea.Size = UDim2.new(1, 0, 1, 0)
			itemHitArea.BackgroundTransparency = 1
			itemHitArea.Text = ""
			itemHitArea.BorderSizePixel = 0
			itemHitArea.ZIndex = 100
			itemHitArea.AutoButtonColor = false
			itemHitArea.Parent = itemFrame

			-- Hover highlight (tweened — uses separate tween array to avoid cancelling panel tweens)
			local hoverEnter = itemHitArea.MouseEnter:Connect(function()
				cancelItemHoverTweens()
				local tw = TweenService:Create(itemFrame, TweenInfo.new(0.15, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
					BackgroundTransparency = itemHoverTransparency,
				})
				trackItemHoverTween(tw)
				tw:Play()
			end)
			table.insert(itemConnections, hoverEnter)

			local hoverLeave = itemHitArea.MouseLeave:Connect(function()
				cancelItemHoverTweens()
				local tw = TweenService:Create(itemFrame, TweenInfo.new(0.15, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
					BackgroundTransparency = 1,
				})
				trackItemHoverTween(tw)
				tw:Play()
			end)
			table.insert(itemConnections, hoverLeave)

			-- Click
			local clickConn = itemHitArea.MouseButton1Click:Connect(function()
				selectedIndex = i
				selectedLabel.Text = items[i]
				-- Update all item label colors and checkmarks
				for j, f in itemFrames do
					local lbl = f:FindFirstChild("ItemLabel")
					if lbl and lbl:IsA("TextLabel") then
						lbl.TextColor3 = if j == i then primaryText else secondaryText
					end
					local chk = f:FindFirstChild("CheckLabel")
					if chk and chk:IsA("TextLabel") then
						chk.Text = if j == i then "\226\156\147" else ""
					end
				end
				closeDropdown()
				if config.OnChanged then
					config.OnChanged(i)
				end
			end)
			table.insert(itemConnections, clickConn)

			table.insert(itemFrames, itemFrame)
		end

		-- Update scroll canvas size
		scrollFrame.CanvasSize = UDim2.new(0, 0, 0, #items * itemHeight)
		scrollFrame.ScrollBarThickness = if #items > maxVisibleItems then 4 else 0

		-- Update panel height
		local newPanelItemCount = math.min(#items, maxVisibleItems)
		local newPanelHeight = newPanelItemCount * itemHeight + 8
		panelGlass.Container.Size = UDim2.new(1, 0, 0, newPanelHeight)
	end

	-- Open/Close
	closeDropdown = function()
		if not isOpen then
			return
		end
		isOpen = false
		cancelAllTweens()
		destroyClickBlocker()

		local tweenInfo = TweenInfo.new(0.1, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
		local scaleTween = TweenService:Create(panelUIScale, tweenInfo, { Scale = 0.95 })
		trackTween(scaleTween)
		scaleTween:Play()

		local fadeTween = TweenService:Create(panelGlass.GlassSurface, tweenInfo, {
			BackgroundTransparency = 1,
		})
		trackTween(fadeTween)
		fadeTween:Play()

		scaleTween.Completed:Once(function()
			if isDestroyed then return end
			panelGlass.Container.Visible = false
			-- Restore panel parent to container
			panelGlass.Container.Parent = container
			panelGlass.Container.Position = UDim2.new(0, 0, 0, size.Y.Offset + 4)
			panelGlass.Container.Size = UDim2.new(1, 0, 0, panelGlass.Container.Size.Y.Offset)
		end)
	end

	local function openDropdown()
		if isOpen then
			return
		end
		isOpen = true
		cancelAllTweens()
		createClickBlocker()

		-- Reparent panel to ScreenGui for proper Z layering
		local screenGui = findScreenGui()
		if screenGui then
			local triggerAbsPos = triggerGlass.Container.AbsolutePosition
			local triggerAbsSize = triggerGlass.Container.AbsoluteSize
			panelGlass.Container.Parent = screenGui
			panelGlass.Container.Position = UDim2.new(0, triggerAbsPos.X, 0, triggerAbsPos.Y + triggerAbsSize.Y + 4)
			panelGlass.Container.Size = UDim2.new(0, triggerAbsSize.X, 0, panelGlass.Container.Size.Y.Offset)
		end

		panelGlass.Container.Visible = true
		panelGlass.Container.ZIndex = 50
		panelUIScale.Scale = 0.92
		panelGlass.GlassSurface.BackgroundTransparency = 1

		local tweenInfo = TweenInfo.new(0.2, Enum.EasingStyle.Back, Enum.EasingDirection.Out)
		local scaleTween = TweenService:Create(panelUIScale, tweenInfo, { Scale = 1 })
		trackTween(scaleTween)
		scaleTween:Play()

		local fadeTween = TweenService:Create(panelGlass.GlassSurface, tweenInfo, {
			BackgroundTransparency = dropdownBgTransparency - 0.05,
		})
		trackTween(fadeTween)
		fadeTween:Play()
	end

	-- Toggle on trigger click
	local triggerConn = triggerHitArea.MouseButton1Click:Connect(function()
		if isOpen then
			closeDropdown()
		else
			openDropdown()
		end
	end)
	table.insert(connections, triggerConn)

	-- Build initial items
	buildItems()

	-- Parent assignment
	if config.Parent then
		container.Parent = config.Parent
	end

	-- Return table
	local self: Types.MangoDropdown = {
		Container = container,
		SetSelectedIndex = function(self: Types.MangoDropdown, index: number)
			if index >= 1 and index <= #items then
				selectedIndex = index
				selectedLabel.Text = items[index]
			end
		end,
		GetSelectedIndex = function(self: Types.MangoDropdown): number
			return selectedIndex
		end,
		SetItems = function(self: Types.MangoDropdown, newItems: {string})
			items = table.clone(newItems)
			selectedIndex = math.clamp(selectedIndex, 1, math.max(#items, 1))
			selectedLabel.Text = if #items > 0 then items[selectedIndex] else ""
			buildItems()
		end,
		Open = function(self: Types.MangoDropdown)
			openDropdown()
		end,
		Close = function(self: Types.MangoDropdown)
			closeDropdown()
		end,
		Destroy = function(self: Types.MangoDropdown)
			isDestroyed = true
			cancelAllTweens()
			cancelItemHoverTweens()
			clearItemConnections()
			destroyClickBlocker()
			for _, conn in connections do
				conn:Disconnect()
			end
			table.clear(connections)
			triggerGlass:Destroy()
			panelGlass:Destroy()
			container:Destroy()
		end,
	}

	return self
end

return module

end

_modules["MangoTabBar"] = function()


local Types = _require("Types")
local Themes = _require("Themes")
local MangoGlassFrame = _require("MangoGlassFrame")
local resolve = Themes.resolve
local TweenService = game:GetService("TweenService")

local module = {}

function module.new(config: Types.MangoTabBarConfig): Types.MangoTabBar
	local theme = config.Theme
	local tabs = config.Tabs
	local tabCount = #tabs

	-- Resolve config values
	local initialIndex = resolve(config.InitialIndex, nil, 1) :: number

	-- Theme values
	local bgTransparency = resolve(nil, theme and theme.TabBarBackgroundTransparency, 0.82) :: number
	local selectedColor = resolve(nil, theme and theme.TabBarSelectedColor, Color3.fromRGB(0, 122, 255)) :: Color3
	local iconColor = resolve(nil, theme and theme.TabBarIconColor, Color3.fromRGB(140, 140, 150)) :: Color3
	local iconSelectedColor = resolve(nil, theme and theme.TabBarIconSelectedColor, Color3.fromRGB(0, 122, 255)) :: Color3
	local secondaryText = resolve(nil, theme and theme.SecondaryTextColor, Color3.fromRGB(60, 60, 70)) :: Color3

	-- State
	local currentIndex: number = math.clamp(initialIndex, 1, tabCount)
	local activeTweens: {Tween} = {}
	local connections: {RBXScriptConnection} = {}

	local function cancelAllTweens()
		for _, tween in activeTweens do
			tween:Cancel()
		end
		table.clear(activeTweens)
	end

	local function trackTween(tween: Tween): Tween
		table.insert(activeTweens, tween)
		return tween
	end

	-- Container (full width, 54px tall, anchored to bottom)
	local container = Instance.new("Frame")
	container.Name = "MangoTabBar"
	container.Size = UDim2.new(1, 0, 0, 54)
	container.Position = UDim2.new(0, 0, 1, 0)
	container.AnchorPoint = Vector2.new(0, 1)
	container.BackgroundTransparency = 1
	container.BorderSizePixel = 0

	-- MangoGlassFrame (full tab bar background)
	local glassFrame = MangoGlassFrame.new({
		Size = UDim2.new(1, 0, 1, 0),
		Position = UDim2.new(0, 0, 0, 0),
		CornerRadius = UDim.new(0, 0),
		BackgroundTransparency = bgTransparency,
		Theme = theme,
		ShadowEnabled = true,
		ShadowLayerCount = 2,
		ShadowSpread = 6,
		ShadowOffsetY = -2,
		LightweightMode = true,
		Parent = container,
	})

	-- Layout inside GlassSurface
	local tabLayout = Instance.new("UIListLayout")
	tabLayout.FillDirection = Enum.FillDirection.Horizontal
	tabLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
	tabLayout.VerticalAlignment = Enum.VerticalAlignment.Center
	tabLayout.SortOrder = Enum.SortOrder.LayoutOrder
	tabLayout.Padding = UDim.new(0, 0)
	tabLayout.Parent = glassFrame.GlassSurface

	-- Tab items
	local tabFrames: {Frame} = {}
	local iconLabels: {TextLabel} = {}
	local textLabels: {TextLabel} = {}
	local dotFrames: {Frame} = {}

	for i = 1, tabCount do
		local tab = tabs[i]
		local hasIcon = tab.Icon ~= nil and tab.Icon ~= ""
		local isSelected = i == currentIndex

		local tabFrame = Instance.new("Frame")
		tabFrame.Name = "Tab" .. i
		tabFrame.Size = UDim2.new(1 / tabCount, 0, 1, 0)
		tabFrame.BackgroundTransparency = 1
		tabFrame.BorderSizePixel = 0
		tabFrame.LayoutOrder = i
		tabFrame.Parent = glassFrame.GlassSurface

		-- Icon (if provided)
		local iconLabel = Instance.new("TextLabel")
		iconLabel.Name = "IconLabel"
		iconLabel.Size = UDim2.new(1, 0, 0, 24)
		iconLabel.Position = UDim2.new(0, 0, 0, 4)
		iconLabel.BackgroundTransparency = 1
		iconLabel.BorderSizePixel = 0
		iconLabel.Font = Enum.Font.Gotham
		iconLabel.TextSize = 20
		iconLabel.Text = if hasIcon then (tab.Icon :: string) else ""
		iconLabel.TextColor3 = if isSelected then iconSelectedColor else iconColor
		iconLabel.TextXAlignment = Enum.TextXAlignment.Center
		iconLabel.TextYAlignment = Enum.TextYAlignment.Center
		iconLabel.Visible = hasIcon
		iconLabel.ZIndex = 5
		iconLabel.Parent = tabFrame

		-- Tab label
		local textLabel = Instance.new("TextLabel")
		textLabel.Name = "TabLabel"
		textLabel.Size = UDim2.new(1, 0, 0, 14)
		textLabel.Position = if hasIcon then UDim2.new(0, 0, 0, 28) else UDim2.new(0, 0, 0.5, -7)
		textLabel.BackgroundTransparency = 1
		textLabel.BorderSizePixel = 0
		textLabel.Font = Enum.Font.GothamMedium
		textLabel.TextSize = 10
		textLabel.Text = tab.Label
		textLabel.TextColor3 = if isSelected then selectedColor else secondaryText
		textLabel.TextXAlignment = Enum.TextXAlignment.Center
		textLabel.TextYAlignment = Enum.TextYAlignment.Center
		textLabel.ZIndex = 5
		textLabel.Parent = tabFrame

		-- Selected dot
		local dot = Instance.new("Frame")
		dot.Name = "SelectedDot"
		dot.Size = UDim2.new(0, 4, 0, 4)
		dot.AnchorPoint = Vector2.new(0.5, 0)
		dot.Position = if hasIcon then UDim2.new(0.5, 0, 0, 44) else UDim2.new(0.5, 0, 0, 38)
		dot.BackgroundColor3 = selectedColor
		dot.BackgroundTransparency = 0
		dot.BorderSizePixel = 0
		dot.Visible = isSelected
		dot.ZIndex = 5
		dot.Parent = tabFrame

		local dotCorner = Instance.new("UICorner")
		dotCorner.CornerRadius = UDim.new(0, 999)
		dotCorner.Parent = dot

		-- HitArea
		local hitArea = Instance.new("TextButton")
		hitArea.Name = "HitArea"
		hitArea.Size = UDim2.new(1, 0, 1, 0)
		hitArea.BackgroundTransparency = 1
		hitArea.Text = ""
		hitArea.BorderSizePixel = 0
		hitArea.ZIndex = 100
		hitArea.AutoButtonColor = false
		hitArea.Parent = tabFrame

		table.insert(tabFrames, tabFrame)
		table.insert(iconLabels, iconLabel)
		table.insert(textLabels, textLabel)
		table.insert(dotFrames, dot)
	end

	-- Selection logic
	local function selectIndex(index: number)
		if index < 1 or index > tabCount then
			return
		end
		cancelAllTweens()
		currentIndex = index

		local colorInfo = TweenInfo.new(0.15, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)

		for i = 1, tabCount do
			local isSelected = i == index

			-- Animate icon color
			local iconTween = TweenService:Create(iconLabels[i], colorInfo, {
				TextColor3 = if isSelected then iconSelectedColor else iconColor,
			})
			trackTween(iconTween)
			iconTween:Play()

			-- Animate text color
			local textTween = TweenService:Create(textLabels[i], colorInfo, {
				TextColor3 = if isSelected then selectedColor else secondaryText,
			})
			trackTween(textTween)
			textTween:Play()

			-- Show/hide dot
			dotFrames[i].Visible = isSelected
		end
	end

	-- Wire click handlers
	for i = 1, tabCount do
		local hitArea = tabFrames[i]:FindFirstChild("HitArea") :: TextButton
		local conn = hitArea.MouseButton1Click:Connect(function()
			if currentIndex ~= i then
				selectIndex(i)
				if config.OnChanged then
					config.OnChanged(i)
				end
			end
		end)
		table.insert(connections, conn)
	end

	-- Parent assignment
	if config.Parent then
		container.Parent = config.Parent
	end

	-- Return table
	local self: Types.MangoTabBar = {
		Container = container,
		SetIndex = function(self: Types.MangoTabBar, index: number)
			selectIndex(index)
		end,
		GetIndex = function(self: Types.MangoTabBar): number
			return currentIndex
		end,
		Destroy = function(self: Types.MangoTabBar)
			cancelAllTweens()
			for _, conn in connections do
				conn:Disconnect()
			end
			table.clear(connections)
			glassFrame:Destroy()
			container:Destroy()
		end,
	}

	return self
end

return module

end

_modules["MangoBillboardLabel"] = function()


local Types = _require("Types")
local Themes = _require("Themes")
local resolve = Themes.resolve
local TextService = game:GetService("TextService")

local module = {}

function module.new(config: Types.MangoBillboardLabelConfig): Types.MangoBillboardLabel
	-- Determine target part
	local targetPart: BasePart? = config.TargetPart
	if not targetPart and config.TargetCharacter then
		targetPart = config.TargetCharacter:FindFirstChild("Head") :: BasePart?
	end

	-- Resolve config values with nil-safe helper
	local theme = config.Theme
	local text = config.Text
	local textSize = resolve(config.TextSize, nil, 14) :: number
	local maxDistance = resolve(config.MaxDistance, nil, 50) :: number
	local studsOffset = resolve(config.StudsOffset, nil, Vector3.new(0, 2.2, 0)) :: Vector3
	local alwaysOnTop = resolve(config.AlwaysOnTop, nil, false) :: boolean

	-- Theme-driven visual properties
	local bgColor = resolve(nil, theme and theme.BackgroundColor3, Color3.fromRGB(255, 255, 255)) :: Color3
	local bgTransparency = resolve(nil, theme and theme.BackgroundTransparency, 0.78) :: number
	-- Override for billboard readability - more opaque than panels
	bgTransparency = math.max(0, bgTransparency - 0.15)
	local textColor = resolve(nil, theme and theme.PrimaryTextColor, Color3.fromRGB(0, 0, 0)) :: Color3
	local strokeColor = resolve(nil, theme and theme.StrokeColor, Color3.fromRGB(255, 255, 255)) :: Color3
	local shadowColor = resolve(nil, theme and theme.ShadowColor, Color3.fromRGB(0, 0, 0)) :: Color3
	local innerGlowColor = resolve(nil, theme and theme.InnerGlowColor, Color3.fromRGB(255, 255, 255)) :: Color3
	local innerGlowTransparency = resolve(nil, theme and theme.InnerGlowTransparency, 0.65) :: number
	local innerEdgeColor = resolve(nil, theme and theme.InnerEdgeColor, Color3.fromRGB(255, 255, 255)) :: Color3
	local innerEdgeTop = resolve(nil, theme and theme.InnerEdgeTopTransparency, 0.35) :: number
	local innerEdgeMid = resolve(nil, theme and theme.InnerEdgeMidTransparency, 0.72) :: number
	local innerEdgeBottom = resolve(nil, theme and theme.InnerEdgeBottomTransparency, 0.92) :: number
	local fresnelStart = resolve(nil, theme and theme.FresnelStartTransparency, 0.30) :: number
	local fresnelEnd = resolve(nil, theme and theme.FresnelEndTransparency, 0.95) :: number
	local fresnelMid = resolve(nil, theme and theme.FresnelMidTransparency, 0.55) :: number
	local fresnelMidPoint = resolve(nil, theme and theme.FresnelMidPoint, 0.35) :: number

	-- Auto-size based on text measurement
	local font = Enum.Font.GothamMedium
	local textBounds = TextService:GetTextSize(text, textSize, font, Vector2.new(500, 100))
	local containerWidth = textBounds.X + 28
	local containerHeight = textBounds.Y + 14

	-- BillboardGui
	local billboardGui = Instance.new("BillboardGui")
	billboardGui.Name = "MangoBillboardLabel"
	billboardGui.Size = UDim2.new(0, containerWidth, 0, containerHeight)
	billboardGui.MaxDistance = maxDistance
	billboardGui.StudsOffset = studsOffset
	billboardGui.AlwaysOnTop = alwaysOnTop
	billboardGui.Active = false
	billboardGui.ResetOnSpawn = false
	if targetPart then
		billboardGui.Adornee = targetPart
	end

	-- Container (transparent wrapper, full size)
	local container = Instance.new("Frame")
	container.Name = "Container"
	container.Size = UDim2.new(1, 0, 1, 0)
	container.BackgroundTransparency = 1
	container.BorderSizePixel = 0
	container.Parent = billboardGui

	-- ShadowLayer1 (outer, larger spread)
	local shadowLayer1 = Instance.new("Frame")
	shadowLayer1.Name = "ShadowLayer1"
	shadowLayer1.AnchorPoint = Vector2.new(0.5, 0.5)
	shadowLayer1.Position = UDim2.new(0.5, 0, 0.5, 1)
	shadowLayer1.Size = UDim2.new(1, 8, 1, 8)
	shadowLayer1.BackgroundColor3 = shadowColor
	shadowLayer1.BackgroundTransparency = 0.88
	shadowLayer1.BorderSizePixel = 0
	shadowLayer1.ZIndex = 0
	shadowLayer1.Parent = container

	local shadowCorner1 = Instance.new("UICorner")
	shadowCorner1.CornerRadius = UDim.new(0, 999)
	shadowCorner1.Parent = shadowLayer1

	-- ShadowLayer2 (inner, tighter spread)
	local shadowLayer2 = Instance.new("Frame")
	shadowLayer2.Name = "ShadowLayer2"
	shadowLayer2.AnchorPoint = Vector2.new(0.5, 0.5)
	shadowLayer2.Position = UDim2.new(0.5, 0, 0.5, 1.5)
	shadowLayer2.Size = UDim2.new(1, 5, 1, 5)
	shadowLayer2.BackgroundColor3 = shadowColor
	shadowLayer2.BackgroundTransparency = 0.86
	shadowLayer2.BorderSizePixel = 0
	shadowLayer2.ZIndex = 0
	shadowLayer2.Parent = container

	local shadowCorner2 = Instance.new("UICorner")
	shadowCorner2.CornerRadius = UDim.new(0, 999)
	shadowCorner2.Parent = shadowLayer2

	-- GlassSurface (pill shape, clipping inner frame)
	local glassSurface = Instance.new("Frame")
	glassSurface.Name = "GlassSurface"
	glassSurface.Size = UDim2.new(1, 0, 1, 0)
	glassSurface.BackgroundColor3 = bgColor
	glassSurface.BackgroundTransparency = bgTransparency
	glassSurface.ClipsDescendants = true
	glassSurface.BorderSizePixel = 0
	glassSurface.ZIndex = 1
	glassSurface.Parent = container

	local glassCorner = Instance.new("UICorner")
	glassCorner.CornerRadius = UDim.new(0, 999)
	glassCorner.Parent = glassSurface

	-- InnerHighlight (subtle top glow inside GlassSurface)
	local innerHighlight = Instance.new("Frame")
	innerHighlight.Name = "InnerHighlight"
	innerHighlight.Size = UDim2.new(1, 0, 0.4, 0)
	innerHighlight.Position = UDim2.new(0, 0, 0, 0)
	innerHighlight.BackgroundColor3 = innerGlowColor
	innerHighlight.BackgroundTransparency = innerGlowTransparency
	innerHighlight.BorderSizePixel = 0
	innerHighlight.ZIndex = 2
	innerHighlight.Parent = glassSurface

	local highlightCorner = Instance.new("UICorner")
	highlightCorner.CornerRadius = UDim.new(0, 999)
	highlightCorner.Parent = innerHighlight

	local highlightGradient = Instance.new("UIGradient")
	highlightGradient.Name = "HighlightGradient"
	highlightGradient.Rotation = 90
	highlightGradient.Transparency = NumberSequence.new({
		NumberSequenceKeypoint.new(0, 0),
		NumberSequenceKeypoint.new(1, 1),
	})
	highlightGradient.Parent = innerHighlight

	-- InnerEdgeHighlight (full-perimeter inner stroke inside GlassSurface)
	local innerEdgeFrame = Instance.new("Frame")
	innerEdgeFrame.Name = "InnerEdgeHighlight"
	innerEdgeFrame.Size = UDim2.new(1, 0, 1, 0)
	innerEdgeFrame.BackgroundTransparency = 1
	innerEdgeFrame.BorderSizePixel = 0
	innerEdgeFrame.ZIndex = 3
	innerEdgeFrame.Parent = glassSurface

	local innerEdgeCorner = Instance.new("UICorner")
	innerEdgeCorner.CornerRadius = UDim.new(0, 999)
	innerEdgeCorner.Parent = innerEdgeFrame

	local innerEdgeStroke = Instance.new("UIStroke")
	innerEdgeStroke.Name = "InnerEdgeStroke"
	innerEdgeStroke.Color = innerEdgeColor
	innerEdgeStroke.Thickness = 1
	innerEdgeStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
	innerEdgeStroke.Parent = innerEdgeFrame

	local innerEdgeGradient = Instance.new("UIGradient")
	innerEdgeGradient.Name = "InnerEdgeGradient"
	innerEdgeGradient.Rotation = 90
	innerEdgeGradient.Transparency = NumberSequence.new({
		NumberSequenceKeypoint.new(0, math.min(1, innerEdgeTop + 0.05)),
		NumberSequenceKeypoint.new(0.5, math.min(1, innerEdgeMid + 0.03)),
		NumberSequenceKeypoint.new(1, innerEdgeBottom),
	})
	innerEdgeGradient.Parent = innerEdgeStroke

	-- LabelText (centered text inside GlassSurface)
	local textLabel = Instance.new("TextLabel")
	textLabel.Name = "LabelText"
	textLabel.Text = text
	textLabel.Font = font
	textLabel.TextSize = textSize
	textLabel.TextColor3 = textColor
	textLabel.BackgroundTransparency = 1
	textLabel.Size = UDim2.new(1, 0, 1, 0)
	textLabel.TextXAlignment = Enum.TextXAlignment.Center
	textLabel.TextYAlignment = Enum.TextYAlignment.Center
	textLabel.BorderSizePixel = 0
	textLabel.ZIndex = 10
	textLabel.Parent = glassSurface

	-- SpecularFrame (outside clip boundary, child of Container)
	local specularFrame = Instance.new("Frame")
	specularFrame.Name = "SpecularFrame"
	specularFrame.Size = UDim2.new(1, 0, 1, 0)
	specularFrame.BackgroundTransparency = 1
	specularFrame.BorderSizePixel = 0
	specularFrame.ZIndex = 2
	specularFrame.Parent = container

	local specularCorner = Instance.new("UICorner")
	specularCorner.CornerRadius = UDim.new(0, 999)
	specularCorner.Parent = specularFrame

	local specularStroke = Instance.new("UIStroke")
	specularStroke.Name = "SpecularStroke"
	specularStroke.Color = strokeColor
	specularStroke.Thickness = 1
	specularStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
	specularStroke.Parent = specularFrame

	local specularGradient = Instance.new("UIGradient")
	specularGradient.Name = "SpecularGradient"
	specularGradient.Rotation = 90
	specularGradient.Transparency = NumberSequence.new({
		NumberSequenceKeypoint.new(0, math.min(1, fresnelStart + 0.03)),
		NumberSequenceKeypoint.new(fresnelMidPoint, math.min(1, fresnelMid + 0.02)),
		NumberSequenceKeypoint.new(1, fresnelEnd),
	})
	specularGradient.Parent = specularStroke

	-- Parent assignment
	if config.Parent then
		billboardGui.Parent = config.Parent
	elseif targetPart then
		billboardGui.Parent = targetPart
	end

	-- Return typed table
	local self: Types.MangoBillboardLabel = {
		BillboardGui = billboardGui,
		GlassSurface = glassSurface,
		TextLabel = textLabel,
		SetText = function(self: Types.MangoBillboardLabel, newText: string)
			textLabel.Text = newText
			local newBounds = TextService:GetTextSize(newText, textSize, font, Vector2.new(500, 100))
			local newWidth = newBounds.X + 28
			local newHeight = newBounds.Y + 14
			billboardGui.Size = UDim2.new(0, newWidth, 0, newHeight)
		end,
		Destroy = function(self: Types.MangoBillboardLabel)
			billboardGui:Destroy()
		end,
	}

	return self
end

return module

end

_modules["MangoNotificationStack"] = function()


local Types = _require("Types")
local Themes = _require("Themes")
local MangoNotification = _require("MangoNotification")
local resolve = Themes.resolve
local Players = game:GetService("Players")

local module = {}

function module.new(config: Types.MangoNotificationStackConfig): Types.MangoNotificationStack
	local theme = config.Theme

	local maxVisible = resolve(config.MaxVisible, theme and theme.NotificationMaxVisible, 3) :: number
	local stackGap = resolve(config.StackGap, theme and theme.NotificationStackGap, 8) :: number

	-- State
	local isDestroyed = false
	local activeNotifications: {Types.MangoNotification} = {}

	-- Determine parent container
	local screenGui: ScreenGui? = nil
	local parentInstance: Instance
	if config.Parent then
		parentInstance = config.Parent
	else
		local player = Players.LocalPlayer
		local playerGui = player:WaitForChild("PlayerGui")
		local gui = Instance.new("ScreenGui")
		gui.Name = "MangoNotificationStackGui"
		gui.ResetOnSpawn = false
		gui.IgnoreGuiInset = true
		gui.DisplayOrder = 100
		gui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
		gui.Parent = playerGui
		screenGui = gui
		parentInstance = gui
	end

	-- Compute Y position for a notification at the given index (1-based)
	local function computeYForIndex(index: number): number
		local y = 16
		for i = 1, index - 1 do
			local notif = activeNotifications[i]
			if notif then
				y = y + notif:GetHeight() + stackGap
			end
		end
		return y
	end

	-- Reflow all active notifications to fill gaps
	local function reflowNotifications()
		for i, notif in activeNotifications do
			local y = computeYForIndex(i)
			notif:SetPosition(UDim2.new(0.5, 0, 0, y))
		end
	end

	-- Remove a notification from the active array and reflow
	local function removeFromArray(notification: Types.MangoNotification)
		local idx: number? = nil
		for i, notif in activeNotifications do
			if notif == notification then
				idx = i
				break
			end
		end
		if idx then
			table.remove(activeNotifications, idx)
			reflowNotifications()
		end
	end

	local self: Types.MangoNotificationStack = {
		Push = function(self: Types.MangoNotificationStack, notifConfig: Types.MangoNotificationConfig): Types.MangoNotification
			if isDestroyed then
				-- Return a dummy; won't happen in practice
				error("Cannot push to a destroyed MangoNotificationStack")
			end

			-- Auto-dismiss oldest if at max capacity
			if #activeNotifications >= maxVisible then
				local oldest = activeNotifications[1]
				if oldest then
					oldest:Dismiss()
				end
			end

			-- Wrap the OnDismissed callback to also clean up the stack
			local originalOnDismissed = notifConfig.OnDismissed

			-- Create a modified config with overridden Parent and OnDismissed
			local stackNotifConfig: Types.MangoNotificationConfig = {
				Title = notifConfig.Title,
				Body = notifConfig.Body,
				Icon = notifConfig.Icon,
				Duration = notifConfig.Duration,
				Theme = notifConfig.Theme or theme,
				Parent = parentInstance,
				OnDismissed = nil, -- set below
			}

			-- We need a forward reference to the notification for the dismiss callback
			local notificationRef: Types.MangoNotification? = nil

			stackNotifConfig.OnDismissed = function()
				if notificationRef then
					removeFromArray(notificationRef :: Types.MangoNotification)
				end
				if originalOnDismissed then
					originalOnDismissed()
				end
			end

			local notification = MangoNotification.new(stackNotifConfig)
			notificationRef = notification

			-- Position the new notification
			table.insert(activeNotifications, notification)
			local y = computeYForIndex(#activeNotifications)
			notification.Container.Position = UDim2.new(0.5, 0, 0, -80) -- start offscreen
			notification:Show()
			notification:SetPosition(UDim2.new(0.5, 0, 0, y))

			return notification
		end,
		DismissAll = function(self: Types.MangoNotificationStack)
			-- Copy array since Dismiss triggers removal
			local copy = table.clone(activeNotifications)
			for _, notif in copy do
				notif:Dismiss()
			end
		end,
		GetCount = function(self: Types.MangoNotificationStack): number
			return #activeNotifications
		end,
		Destroy = function(self: Types.MangoNotificationStack)
			if isDestroyed then
				return
			end
			isDestroyed = true

			-- Dismiss all active notifications
			local copy = table.clone(activeNotifications)
			for _, notif in copy do
				notif:Destroy()
			end
			table.clear(activeNotifications)

			if screenGui then
				screenGui:Destroy()
			end
		end,
	}

	return self
end

return module

end

-- Build library table
local Themes = _require("Themes")
local MangoLiquidUI = {
    MangoGlassFrame = _require("MangoGlassFrame"),
    RefractionProxy = _require("RefractionProxy"),
    LiquidFusion = _require("LiquidFusion"),
    MangoToggle = _require("MangoToggle"),
    MangoSlider = _require("MangoSlider"),
    MangoButton = _require("MangoButton"),
    MangoBillboardLabel = _require("MangoBillboardLabel"),
    MangoNotification = _require("MangoNotification"),
    MangoNotificationStack = _require("MangoNotificationStack"),
    MangoSegmentedControl = _require("MangoSegmentedControl"),
    MangoDropdown = _require("MangoDropdown"),
    MangoTabBar = _require("MangoTabBar"),
    MangoSearchBar = _require("MangoSearchBar"),
    MangoTextField = _require("MangoTextField"),
    MangoCheckbox = _require("MangoCheckbox"),
    MangoProgressBar = _require("MangoProgressBar"),
    MangoDialog = _require("MangoDialog"),
    MangoActionSheet = _require("MangoActionSheet"),
    MangoEnvironmentLight = _require("MangoEnvironmentLight"),
    Themes = Themes,
    Light = Themes.Light,
    Dark = Themes.Dark,
    Mango = Themes.Mango,
    Mint = Themes.Mint,
    resolve = Themes.resolve,
}

return MangoLiquidUI
